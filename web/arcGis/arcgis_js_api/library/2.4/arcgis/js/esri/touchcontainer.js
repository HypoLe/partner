/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */

if(!dojo._hasResource["esri.touchcontainer"]){dojo._hasResource["esri.touchcontainer"]=true;dojo.provide("esri.touchcontainer");dojo.declare("esri._MapContainer",esri._CoreMap,(function(){var dc=dojo.connect,_1=dojo.disconnect,dh=dojo.hitch,_2=esri.geometry.Point;var _3=300;return {constructor:function(_4,_5){this._onTouchMoveHandler_connect=this._onTouchEndHandler_connect=this._onTouchCancelHandler_connect=null;this._onTouchStart_connect=dc(this.__container,"ontouchstart",this,this._onTouchStartHandler);this._connects.push(dc(this.__container,"ongesturestart",this,this._onGestureStartHandler));this._connects.push(dc(this.__container,"onmouseover",this,this._onMouseOverHandler));this._connects.push(dc(this.__container,"onmouseout",this,this._onMouseOutHandler));this._connects.push(dc(this.__container,"onmousedown",this,this._onMouseDownHandler));this._connects.push(dc(this.__container,"onmouseup",this,this._onMouseUpHandler));this._connects.push(dc(this.__container,"onclick",this,this._onClickHandler));this.downCoords={};this._firstTapOn=false;this._processDoubleTap=false;this._processMultiTouchTap=false;this._doubleTapTimeoutObject=false;this._doubleTapTimeout=dh(this,this._doubleTapTimeout);this._lastTouchEvent="";},_doubleTapTimeout:function(){this._firstTapOn=false;},_cleanUp:function(){for(var i=this._connects.length;i>=0;i--){_1(this._connects[i]);delete this._connects[i];}_1(this._onTouchMoveHandler_connect);_1(this._onTouchEndHandler_connect);_1(this._onTouchCancelHandler_connect);this.inherited("_cleanUp",arguments);},__setClickDuration:function(_6){this._clickDuration=_6;},__resetClickDuration:function(){this._clickDuration=_3;},_processEvent:function(_7,_8){if(_7.type.indexOf("touch")!=-1){if(_7.touches.length===2){return this._processGestureEvent(_7);}else{return this._processTouchEvent(_7);}}_7.screenPoint=new _2(_7.pageX-this.position.x,_7.pageY-this.position.y);_7.mapPoint=this.extent?this.toMap(_7.screenPoint):new _2();return _7;},_processTouchEvent:function(_9){if(_9.type==="touchstart"){_9.screenPoint=new _2(_9.targetTouches.item(0).pageX-this.position.x,_9.targetTouches.item(0).pageY-this.position.y);}else{_9.screenPoint=new _2(_9.changedTouches.item(0).pageX-this.position.x,_9.changedTouches.item(0).pageY-this.position.y);}_9.mapPoint=this.extent?this.toMap(_9.screenPoint):new _2();return _9;},_processGestureEvent:function(_a){_a.screenPoints=[new _2(_a.touches.item(0).pageX-this.position.x,_a.touches.item(0).pageY-this.position.y),new _2(_a.touches.item(1).pageX-this.position.x,_a.touches.item(1).pageY-this.position.y)];return _a;},_onClickHandler:function(_b){_b=this._processEvent(_b);var dx=Math.abs(this.downCoords.x-_b.screenPoint.x);var dy=Math.abs(this.downCoords.y-_b.screenPoint.y);if(esri.isBlackBerry){clearTimeout(this._doubleTapTimeoutObject);this._firstTapOn=false;if(!this._tmoved){this.onClick(_b);}}else{if(dx<=1&&dy<=1){clearTimeout(this._doubleTapTimeoutObject);this._firstTapOn=false;this.onClick(_b);}}},_onMouseOverHandler:function(_c){_c=this._processEvent(_c);this.onMouseOver(_c);},_onMouseOutHandler:function(_d){_d=this._processEvent(_d);this.onMouseOut(_d);},_onMouseDownHandler:function(_e){_e=this._processEvent(_e);this.onMouseDown(_e);},_onMouseUpHandler:function(_f){_f=this._processEvent(_f);this.onMouseUp(_f);},_onTouchStartHandler:function(evt){if(this._firstTapOn){if(esri.isBlackBerry){if(this._lastTouchEvent=="touchend"){this._processDoubleTap=true;clearTimeout(this._doubleTapTimeoutObject);this._firstTapOn=false;this._onTouchEndHandler(evt);}}else{this._processDoubleTap=true;clearTimeout(this._doubleTapTimeoutObject);this._firstTapOn=false;}}else{this._firstTapOn=true;this._doubleTapTimeoutObject=setTimeout(this._doubleTapTimeout,400);}this._lastTouchEvent="touchstart";evt=this._processEvent(evt);this._tmoved=false;_1(this._onTouchMoveHandler_connect);_1(this._onTouchEndHandler_connect);_1(this._onTouchCancelHandler_connect);this._onTouchMoveHandler_connect=dc(this.__container,"ontouchmove",this,this._onTouchMoveHandler);this._onTouchEndHandler_connect=dc(this.__container,"ontouchend",this,this._onTouchEndHandler);this._onTouchCancelHandler_connect=dc(this.__container,"ontouchcancel",this,this._onTouchEndHandler);this.onTouchStart(evt);},_onTouchMoveHandler:function(evt){this._tmoved=true;this.onTouchMove(this._processEvent(evt));},_onTouchEndHandler:function(evt){_1(this._onTouchMoveHandler_connect);_1(this._onTouchEndHandler_connect);_1(this._onTouchCancelHandler_connect);this._lastTouchEvent="touchend";evt=this._processEvent(evt);this.downCoords.x=evt.screenPoint.x;this.downCoords.y=evt.screenPoint.y;this.onTouchEnd(evt);if(this._processDoubleTap){this.onDblClick(evt);this._processDoubleTap=false;}},_onGestureStartHandler:function(evt){_1(this._onTouchStart_connect);_1(this._onTouchMoveHandler_connect);_1(this._onTouchEndHandler_connect);_1(this._onTouchCancelHandler_connect);this._processMultiTouchTap=true;this._onTouchMoveHandler_connect=dc(this.__container,"ontouchmove",this,this._onGestureTouchMoveHandler);this._onTouchEndHandler_connect=dc(this.__container,"ontouchend",this,this._onGestureTouchEndHandler);this._onTouchCancelHandler_connect=dc(this.__container,"ontouchcancel",this,this._onGestureTouchEndHandler);this.onGestureStart(this._processEvent(evt));},_onGestureTouchMoveHandler:function(evt){this._processMultiTouchTap=false;this.onGestureChange(this._processEvent(evt));},_onGestureTouchEndHandler:function(evt){_1(this._onTouchMoveHandler_connect);_1(this._onTouchEndHandler_connect);_1(this._onTouchCancelHandler_connect);this._onTouchStart_connect=dc(this.__container,"ontouchstart",this,this._onTouchStartHandler);if(this._processMultiTouchTap){evt.processMultiTouchTap=true;this._processMultiTouchTap=false;}this.onGestureEnd(this._processEvent(evt));},onClick:function(evt){},onMouseOver:function(evt){},onMouseOut:function(evt){},onMouseDown:function(evt){},onMouseUp:function(evt){},onTouchStart:function(evt){},onTouchMove:function(evt){},onTouchEnd:function(evt){},onGestureStart:function(evt){},onGestureChange:function(evt){},onGestureEnd:function(evt){}};})());}