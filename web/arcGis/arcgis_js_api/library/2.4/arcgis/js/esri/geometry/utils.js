/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */

if(!dojo._hasResource["esri.geometry.utils"]){dojo._hasResource["esri.geometry.utils"]=true;dojo.provide("esri.geometry.utils");(function(){var EG=esri.geometry;EG.normalizeCentralMeridian=function(_1,_2,_3,_4){var _5=new dojo.Deferred();_5.addCallbacks(_3,_4);var _6=[];var _7=[];var _8=_1[0].spatialReference,_9=_8._getInfo();var _a=180;var _b=-180;var _c=false;if(_8._isWebMercator()){_a=20037508.342788905;_b=-20037508.342788905;_c=true;}var _d=new esri.geometry.Polyline({"paths":[[[_a,_b],[_a,_a]]]});var _e=new esri.geometry.Polyline({"paths":[[[_b,_b],[_b,_a]]]});var _f=0;dojo.forEach(_1,function(_10){var _11=esri.geometry.fromJson(dojo.fromJson(dojo.toJson(_10.toJson())));var _12=_10.getExtent();if(_10.type==="point"){_6.push(EG._pointNormalization(_11,_a,_b));}else{if(_10.type==="multipoint"){_11.points=dojo.map(_11.points,function(_13){return EG._pointNormalization(_13,_a,_b);});_6.push(_11);}else{if(_10.type==="extent"){_6.push(_12._normalize(null,null,_9));}else{var _14=EG._offsetMagnitude(_12.xmin,_b);var _15=_14*(2*_a);_11=(_15===0)?_11:EG._updatePolyGeometry(_11,_15);_12=_12.offset(_15,0);if(_12.intersects(_d)){_f=(_12.xmax>_f)?_12.xmax:_f;_11=EG._prepareGeometryForCut(_11,_c);_7.push(_11);_6.push("cut");}else{if(_12.intersects(_e)){_f=(_12.xmax*(2*_a)>_f)?_12.xmax*(2*_a):_f;_11=EG._prepareGeometryForCut(_11,_c,360);_7.push(_11);_6.push("cut");}else{_6.push(_11);}}}}}});var _16=new esri.geometry.Polyline();var _17=EG._offsetMagnitude(_f,_a);var _18=-90,_19=_17;while(_17>0){var _1a=-180+(360*_17);_16.addPath([[_1a,_18],[_1a,_18*-1]]);_18=_18*-1;_17--;}if(_7.length>0&&_19>0){if(_2){_2.cut(_7,_16,function(_1b){_7=EG._foldCutResults(_7,_1b);var _1c=[];dojo.forEach(_6,function(_1d,i){if(_1d==="cut"){var _1e=_7.shift();if((_1[i].rings)&&(_1[i].rings.length>1)&&(_1e.rings.length>=_1[i].rings.length)){_6[i]="simplify";_1c.push(_1e);}else{_6[i]=(_c===true)?EG.geographicToWebMercator(_1e):_1e;}}});if(_1c.length>0){_2.simplify(_1c,function(_1f){dojo.forEach(_6,function(_20,i){if(_20==="simplify"){_6[i]=(_c===true)?EG.geographicToWebMercator(_1f.shift()):_1f.shift();}});_5.callback(_6);},function(_21){_5.errback(_21);});}else{_5.callback(_6);}},function(_22){_5.errback(_22);});}else{_5.errback(new Error("esri.geometry.normalizeCentralMeridian: 'geometryService' argument is missing."));}}else{dojo.forEach(_6,function(_23,i){if(_23==="cut"){var _24=_7.shift();_6[i]=(_c===true)?EG.geographicToWebMercator(_24):_24;}});_5.callback(_6);}return _5;};EG.geodesicDensify=function(_25,_26){var _27=Math.PI/180;var _28=6371008.771515059;if(_26<_28/10000){_26=_28/10000;}if(!(_25 instanceof esri.geometry.Polyline||_25 instanceof esri.geometry.Polygon)){var msg="_geodesicDensify: the input geometry is neither polyline nor polygon";console.error(msg);throw new Error(msg);}var _29=_25 instanceof esri.geometry.Polyline,_2a=_29?_25.paths:_25.rings,_2b=[],_2c;dojo.forEach(_2a,function(_2d){_2b.push(_2c=[]);_2c.push([_2d[0][0],_2d[0][1]]);var _2e,_2f,_30,_31;_2e=_2d[0][0]*_27;_2f=_2d[0][1]*_27;for(var i=0;i<_2d.length-1;i++){_30=_2d[i+1][0]*_27;_31=_2d[i+1][1]*_27;var _32=EG._inverseGeodeticSolver(_2f,_2e,_31,_30);var _33=_32.azimuth;var _34=_32.geodesicDistance;var _35=_34/_26;if(_35>1){for(var j=1;j<=_35-1;j++){var _36=j*_26;var pt=EG._directGeodeticSolver(_2f,_2e,_33,_36);_2c.push([pt.x,pt.y]);}var _37=(_34+Math.floor(_35-1)*_26)/2;var _38=EG._directGeodeticSolver(_2f,_2e,_33,_37);_2c.push([_38.x,_38.y]);}var _39=EG._directGeodeticSolver(_2f,_2e,_33,_34);_2c.push([_39.x,_39.y]);_2e=_39.x*_27;_2f=_39.y*_27;}});if(_29){return new esri.geometry.Polyline({paths:_2b,spatialReference:_25.spatialReference});}else{return new esri.geometry.Polygon({rings:_2b,spatialReference:_25.spatialReference});}};EG.geodesicLengths=function(_3a,_3b){var _3c=Math.PI/180;var _3d=[];dojo.forEach(_3a,function(_3e,idx){var _3f=0;dojo.forEach(_3e.paths,function(_40,idx){var _41=0;var _42,_43,_44,_45,_46;for(var i=1;i<_40.length;i++){_42=_40[i-1][0]*_3c;_43=_40[i][0]*_3c;_44=_40[i-1][1]*_3c;_45=_40[i][1]*_3c;_46=EG._inverseGeodeticSolver(_44,_42,_45,_43);_41+=_46.geodesicDistance/1609.344;}_3f+=_41;});_3f*=EG._unitsDictionary[_3b];_3d.push(_3f);});return _3d;};EG.geodesicAreas=function(_47,_48){var _49=[];dojo.forEach(_47,function(_4a,idx){var _4b=EG.geodesicDensify(_4a,10000);_49.push(_4b);});var _4c=[];var _4d,_4e;dojo.forEach(_49,function(_4f,idx){var _50=0;dojo.forEach(_4f.rings,function(_51,idx){_4d=EG._toEqualAreaPoint(new esri.geometry.Point(_51[0][0],_51[0][1]));_4e=EG._toEqualAreaPoint(new esri.geometry.Point(_51[_51.length-1][0],_51[_51.length-1][1]));var _52=_4e.x*_4d.y-_4d.x*_4e.y;var i;for(i=0;i<_51.length-1;i++){_4d=EG._toEqualAreaPoint(new esri.geometry.Point(_51[i+1][0],_51[i+1][1]));_4e=EG._toEqualAreaPoint(new esri.geometry.Point(_51[i][0],_51[i][1]));_52+=_4e.x*_4d.y-_4d.x*_4e.y;}_52/=4046.87;_50+=_52;});_50*=EG._unitsDictionary[_48];_4c.push(_50/(-2));});return _4c;};EG.polygonSelfIntersecting=function(_53){var _54=_53.rings.length;for(var k=0;k<_54;k++){for(var i=0;i<_53.rings[k].length-1;i++){var _55=[[_53.rings[k][i][0],_53.rings[k][i][1]],[_53.rings[k][i+1][0],_53.rings[k][i+1][1]]];for(var j=k+1;j<_54;j++){for(var m=0;m<_53.rings[j].length-1;m++){var _56=[[_53.rings[j][m][0],_53.rings[j][m][1]],[_53.rings[j][m+1][0],_53.rings[j][m+1][1]]];var _57=esri.geometry._getLineIntersection2(_55,_56);if(_57){if(!((_57[0]===_55[0][0]&&_57[1]===_55[0][1])||(_57[0]===_56[0][0]&&_57[1]===_56[0][1])||(_57[0]===_55[1][0]&&_57[1]===_55[1][1])||(_57[0]===_56[1][0]&&_57[1]===_56[1][1]))){return true;}}}}}var _58=_53.rings[k].length;if(_58<=4){continue;}for(var i=0;i<_58-3;i++){var _59=_58-1;if(i===0){_59=_58-2;}var _55=[[_53.rings[k][i][0],_53.rings[k][i][1]],[_53.rings[k][i+1][0],_53.rings[k][i+1][1]]];for(var j=i+2;j<_59;j++){var _56=[[_53.rings[k][j][0],_53.rings[k][j][1]],[_53.rings[k][j+1][0],_53.rings[k][j+1][1]]];var _57=esri.geometry._getLineIntersection2(_55,_56);if(_57){if(!((_57[0]===_55[0][0]&&_57[1]===_55[0][1])||(_57[0]===_56[0][0]&&_57[1]===_56[0][1])||(_57[0]===_55[1][0]&&_57[1]===_55[1][1])||(_57[0]===_56[1][0]&&_57[1]===_56[1][1]))){return true;}}}}}return false;};EG._foldCutResults=function(_5a,_5b){var _5c=-1;dojo.forEach(_5b.cutIndexes,function(_5d,i){var _5e=_5b.geometries[i];var _5f=_5e.rings||_5e.paths;dojo.forEach(_5f,function(_60,_61){dojo.some(_60,function(_62){if(_62[0]<180){return true;}else{var _63=0,j,jl=_60.length,ptX;for(j=0;j<jl;j++){ptX=_60[j][0];_63=ptX>_63?ptX:_63;}var _64=EG._offsetMagnitude(_63,180);var _65=_64*-360;for(var _66=0,_67=_60.length;_66<_67;_66++){var _68=_5e.getPoint(_61,_66);_5e.setPoint(_61,_66,_68.offset(_65,0));}return true;}});});if(_5d===_5c){if(_5e.rings){dojo.forEach(_5e.rings,function(_69,j){_5a[_5d]=_5a[_5d].addRing(_69);});}else{dojo.forEach(_5e.paths,function(_6a,j){_5a[_5d]=_5a[_5d].addPath(_6a);});}}else{_5c=_5d;_5a[_5d]=_5e;}});return _5a;};EG._prepareGeometryForCut=function(_6b,_6c,_6d){var _6e=1000000;if(_6c){var _6f=EG._straightLineDensify(_6b,_6e);_6b=EG.webMercatorToGeographic(_6f,true);}if(_6d){_6b=EG._updatePolyGeometry(_6b,_6d);}return _6b;};EG._offsetMagnitude=function(_70,_71){return Math.ceil((_70-_71)/(_71*2));};EG._pointNormalization=function(_72,_73,_74){var _75=_72.x||_72[0];var _76;if(_75>_73){_76=EG._offsetMagnitude(_75,_73);if(_72.x){_72=_72.offset(_76*(-2*_73),0);}else{_72[0]=_75+(_76*(-2*_73));}}else{if(_75<_74){_76=EG._offsetMagnitude(_75,_74);if(_72.x){_72=_72.offset(_76*(-2*_74),0);}else{_72[0]=_75+(_76*(-2*_74));}}}return _72;};EG._updatePolyGeometry=function(_77,_78){var _79=_77.paths||_77.rings;for(var i=0,il=_79.length;i<il;i++){var _7a=_79[i];for(var j=0,jl=_7a.length;j<jl;j++){var _7b=_77.getPoint(i,j);_77.setPoint(i,j,_7b.offset(_78,0));}}return _77;};EG._straightLineDensify=function(_7c,_7d){if(!(_7c instanceof esri.geometry.Polyline||_7c instanceof esri.geometry.Polygon)){var msg="_straightLineDensify: the input geometry is neither polyline nor polygon";console.error(msg);throw new Error(msg);}var _7e=_7c instanceof esri.geometry.Polyline,_7f=_7e?_7c.paths:_7c.rings,_80=[],_81;dojo.forEach(_7f,function(_82){_80.push(_81=[]);_81.push([_82[0][0],_82[0][1]]);var x1,y1,x2,y2;var _83,_84,_85,_86,xj,yj;for(var i=0;i<_82.length-1;i++){x1=_82[i][0];y1=_82[i][1];x2=_82[i+1][0];y2=_82[i+1][1];_83=Math.sqrt((x2-x1)*(x2-x1)+(y2-y1)*(y2-y1));_84=(y2-y1)/_83;_85=(x2-x1)/_83;_86=_83/_7d;if(_86>1){for(var j=1;j<=_86-1;j++){var _87=j*_7d;xj=_85*_87+x1;yj=_84*_87+y1;_81.push([xj,yj]);}var _88=(_83+Math.floor(_86-1)*_7d)/2;xj=_85*_88+x1;yj=_84*_88+y1;_81.push([xj,yj]);}_81.push([x2,y2]);}});if(_7e){return new esri.geometry.Polyline({paths:_80,spatialReference:_7c.spatialReference});}else{return new esri.geometry.Polygon({rings:_80,spatialReference:_7c.spatialReference});}};EG._unitsDictionary={"esriMiles":1,"esriKilometers":1.609344,"esriFeet":5280,"esriMeters":1609.34,"esriYards":1760,"esriNauticalMiles":0.869,"esriCentimeters":160934,"esriDecimeters":16093.4,"esriInches":63360,"esriMillimeters":1609340,"esriAcres":1,"esriAres":40.4685642,"esriSquareKilometers":0.00404685642,"esriSquareMiles":0.0015625,"esriSquareFeet":43560,"esriSquareMeters":4046.85642,"esriHectares":0.404685642,"esriSquareYards":4840,"esriSquareInches":6272640,"esriSquareMillimeters":4046856420,"esriSquareCentimeters":40468564.2,"esriSquareDecimeters":404685.642};EG._toEqualAreaPoint=function(pt){var _89=Math.PI/180;var a=6378137;var eSq=0.006694379990197414,e=0.0818191908429643;var _8a=Math.sin(pt.y*_89);var q=(1-eSq)*((_8a/(1-eSq*(_8a*_8a))-(1/(2*e))*Math.log((1-e*_8a)/(1+e*_8a))));var x=a*pt.x*_89;var y=a*q*0.5;var _8b=new esri.geometry.Point(x,y);return _8b;};EG._directGeodeticSolver=function(_8c,_8d,_8e,s){var a=6378137,b=6356752.31424518,f=1/298.257223563;var _8f=Math.sin(_8e);var _90=Math.cos(_8e);var _91=(1-f)*Math.tan(_8c);var _92=1/Math.sqrt((1+_91*_91)),_93=_91*_92;var _94=Math.atan2(_91,_90);var _95=_92*_8f;var _96=1-_95*_95;var uSq=_96*(a*a-b*b)/(b*b);var A=1+uSq/16384*(4096+uSq*(-768+uSq*(320-175*uSq)));var B=uSq/1024*(256+uSq*(-128+uSq*(74-47*uSq)));var _97=s/(b*A),_98=2*Math.PI;var _99,_9a,_9b;while(Math.abs(_97-_98)>1e-12){_9b=Math.cos(2*_94+_97);_99=Math.sin(_97);_9a=Math.cos(_97);var _9c=B*_99*(_9b+B/4*(_9a*(-1+2*_9b*_9b)-B/6*_9b*(-3+4*_99*_99)*(-3+4*_9b*_9b)));_98=_97;_97=s/(b*A)+_9c;}var tmp=_93*_99-_92*_9a*_90;var _9d=Math.atan2(_93*_9a+_92*_99*_90,(1-f)*Math.sqrt(_95*_95+tmp*tmp));var _9e=Math.atan2(_99*_8f,_92*_9a-_93*_99*_90);var C=f/16*_96*(4+f*(4-3*_96));var L=_9e-(1-C)*f*_95*(_97+C*_99*(_9b+C*_9a*(-1+2*_9b*_9b)));var _9f=_9d/(Math.PI/180);var _a0=(_8d+L)/(Math.PI/180);var pt=new esri.geometry.Point(_a0,_9f,new esri.SpatialReference({wkid:4326}));return pt;};EG._inverseGeodeticSolver=function(_a1,_a2,_a3,_a4){var a=6378137,b=6356752.31424518,f=1/298.257223563;var L=(_a4-_a2);var U1=Math.atan((1-f)*Math.tan(_a1));var U2=Math.atan((1-f)*Math.tan(_a3));var _a5=Math.sin(U1),_a6=Math.cos(U1);var _a7=Math.sin(U2),_a8=Math.cos(U2);var _a9=L,_aa,_ab=1000;var _ac,_ad,_ae,_af,_b0;do{var _b1=Math.sin(_a9),_b2=Math.cos(_a9);_ad=Math.sqrt((_a8*_b1)*(_a8*_b1)+(_a6*_a7-_a5*_a8*_b2)*(_a6*_a7-_a5*_a8*_b2));if(_ad===0){return 0;}_af=_a5*_a7+_a6*_a8*_b2;_b0=Math.atan2(_ad,_af);var _b3=_a6*_a8*_b1/_ad;_ac=1-_b3*_b3;_ae=_af-2*_a5*_a7/_ac;if(isNaN(_ae)){_ae=0;}var C=f/16*_ac*(4+f*(4-3*_ac));_aa=_a9;_a9=L+(1-C)*f*_b3*(_b0+C*_ad*(_ae+C*_af*(-1+2*_ae*_ae)));}while(Math.abs(_a9-_aa)>1e-12&&--_ab>0);if(_ab===0){var _b4=6371009;var _b5=Math.acos(Math.sin(_a1)*Math.sin(_a3)+Math.cos(_a1)*Math.cos(_a3)*Math.cos(_a4-_a2))*_b4;var _b6=_a4-_a2;var y=Math.sin(_b6)*Math.cos(_a3);var x=Math.cos(_a1)*Math.sin(_a3)-Math.sin(_a1)*Math.cos(_a3)*Math.cos(_b6);var _b7=Math.atan2(y,x);return {"azimuth":_b7,"geodesicDistance":_b5};}var uSq=_ac*(a*a-b*b)/(b*b);var A=1+uSq/16384*(4096+uSq*(-768+uSq*(320-175*uSq)));var B=uSq/1024*(256+uSq*(-128+uSq*(74-47*uSq)));var _b8=B*_ad*(_ae+B/4*(_af*(-1+2*_ae*_ae)-B/6*_ae*(-3+4*_ad*_ad)*(-3+4*_ae*_ae)));var s=b*A*(_b0-_b8);var _b9=Math.atan2(_a8*Math.sin(_a9),_a6*_a7-_a5*_a8*Math.cos(_a9));var _ba=Math.atan2(_a6*Math.sin(_a9),_a6*_a7*Math.cos(_a9)-_a5*_a8);var _bb={azimuth:_b9,geodesicDistance:s,reverseAzimuth:_ba};return _bb;};}());}