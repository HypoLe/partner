/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */

if(!dojo._hasResource["esri.layers.graphics"]){dojo._hasResource["esri.layers.graphics"]=true;dojo.provide("esri.layers.graphics");dojo.require("esri.layers.layer");dojo.require("dojox.gfx");dojo.require("esri.graphic");dojo.require("esri.renderer");if(dojox.gfx.renderer==="vml"){esri.vml=true;dojo.addOnLoad(function(){dojo.declare("esri.gfx.Path",dojox.gfx.Path,{setShape:function(_1){this.rawNode.path.v=(this.vmlPath=_1);return this;}});esri.gfx.Path.nodeType="shape";var _2=dojox.gfx.Shape||dojox.gfx.vml.Shape,_3=_2.prototype.setStroke;_2.prototype.setStroke=function(){var _4=_3.apply(this,arguments);var _5=this.rawNode,_6=_5&&_5.stroke,_7=this.getParent();if(_6&&_7){var op=esri._isDefined(_7._esriIeOpacity)?_7._esriIeOpacity:1;_6.opacity*=op;}return _4;};var _8=_2.prototype.setFill;_2.prototype.setFill=function(){var _9=_8.apply(this,arguments);var _a=this.rawNode,_b=_a&&_a.fill,_c=this.getParent();if(_b&&_c){var op=esri._isDefined(_c._esriIeOpacity)?_c._esriIeOpacity:1;if(_b.type==="tile"){dojo.style(_a,"opacity",op);}else{_b.opacity*=op;}}return _9;};});}dojo.declare("esri.layers._GraphicsContainer",null,{_setMap:function(_d,_e){var es,_f=(this._connects=[]);if(dojox.gfx.renderer==="canvas"){es=dojo.create("div",{style:"overflow: visible; position: absolute;"},_e);this._surface={getEventSource:function(){return es;}};this._map=_d;_f.push(dojo.connect(es,"onmousedown",this,this._canvasDownHandler));_f.push(dojo.connect(es,"onmouseup",this,this._canvasUpHandler));_f.push(dojo.connect(es,"onclick",this,this._canvasClickHandler));}else{var _10=(this._surface=dojox.gfx.createSurface(_e,_d.width,_d.height));es=_10.getEventSource();dojo.style((es=esri.vml?es.parentNode:es),{overflow:"visible",position:"absolute"});}_f.push(dojo.connect(_d,"onResize",this,"_onResizeHandler"));return es;},_onResizeHandler:function(_11,_12,_13){var es=this._surface.getEventSource();if(esri.vml){dojo.style((es=es.parentNode),{width:_12+"px",height:_13+"px",clip:"rect(0px "+_12+"px "+_13+"px 0px)"});}dojo.attr(es,"width",_12);dojo.attr(es,"height",_13);if(!this._surface.declaredClass){dojo.forEach(es.childNodes,function(_14){dojo.attr(_14,"width",_12);dojo.attr(_14,"height",_13);});}},_cleanUp:function(){dojo.forEach(this._connects,dojo.disconnect,dojo);this._map=this._surface=null;},_processEvent:function(evt){var map=this._map;evt.screenPoint=new esri.geometry.Point(evt.pageX-map.position.x,evt.pageY-map.position.y);evt.mapPoint=map.toMap(evt.screenPoint);},_canvasDownHandler:function(evt){this._processEvent(evt);this._downPt=evt.screenPoint.x+","+evt.screenPoint.y;},_canvasUpHandler:function(evt){this._processEvent(evt);this._upPt=evt.screenPoint.x+","+evt.screenPoint.y;},_tolerance:15,_canvasClickHandler:function(evt){if(!this._downPt||!this._upPt||this._downPt!==this._upPt){return;}this._processEvent(evt);var map=this._map;var _15=dojo.map(map.graphicsLayerIds,function(id){return map.getLayer(id);});_15.push(map.graphics);_15.reverse();_15=dojo.filter(_15,function(_16){return _16.loaded&&_16._mouseEvents&&_16.visible&&(!esri._isDefined(_16.opacity)||_16.opacity>0);});var _17=evt.screenPoint,geo=esri.geometry,_18=this._tolerance;var _19=_17.x-_18,_1a=_17.y+_18;var _1b=_17.x+_18,_1c=_17.y-_18;var _1d=new geo.Extent(_19,_1c,_1b,_1a);var _1e=map.toMap(new geo.Point(_19,_1a));var _1f=map.toMap(new geo.Point(_1b,_1c));var _20=new geo.Extent(_1e.x,_1e.y,_1f.x,_1f.y);var _21,_22=esri.isTouchEnabled;dojo.some(_15,function(_23){var _24=dojo.filter(_23.graphics,function(_25){var _26=_25.getDojoShape();if(!_25.visible||!_26){return false;}var _27=_26.getTransformedBoundingBox();if(_27){var _28=new geo.Extent(_27[0].x,_27[0].y,_27[2].x,_27[2].y);return _22?_28.intersects(_1d):_28.contains(_17);}else{return dojo.some(_26.children||[],function(_29){_27=_29.getTransformedBoundingBox();var _2a=new geo.Extent(_27[0].x,_27[0].y,_27[2].x,_27[2].y);return _22?_2a.intersects(_1d):_2a.contains(_17);});}});if(_24.length>0){var _2b;dojo.some(_24,function(_2c){if(_2c.geometry&&_20.intersects(_2c.geometry)){_2b=_2c;return true;}return false;});if(_2b){_21=_2b;return true;}}return false;});if(_21){var _2d=_21.getLayer();if(_2d){evt.graphic=_21;_2d.onClick(evt);}}}});dojo.declare("esri.layers._GraphicsLayer",esri.layers.Layer,{constructor:function(_2e){if(_2e&&(dojo.isString(_2e)||(dojo.isObject(_2e)&&_2e.layerDefinition))){_2e=arguments[1];}this._params=dojo.mixin({displayOnPan:true,drawMode:true},_2e||{});this.infoTemplate=_2e&&_2e.infoTemplate;this.graphics=[];this._init=false;this._suspended=false;this._draw=dojo.hitch(this,this._draw);this._refresh=dojo.hitch(this,this._refresh);},setDrawMode:function(_2f){this._params.drawMode=_2f;},renderer:null,_setMap:function(map,_30){this._map=map;var _31=map.spatialReference;this._wrap=map.wrapAround180;this._srInfo=_31._getInfo();if(_30.declaredClass){this._div=_30.createGroup();}else{_30=dojox.gfx.createSurface(_30.getEventSource(),map.width,map.height);dojo.style(_30.rawNode,"position","absolute");this._div=_30.createGroup();this._div.getEventSource=function(){return _30.rawNode;};this._renderProto=this._div.constructor.prototype._render;this._div._render=dojo.hitch(this,this._canvasRender);}this._div.getEventSource().id=this.id+"_layer";this._enableAllConnectors();this._updateStatus();if(!this._suspended&&map.extent&&map.loaded===true){this._onExtentChangeHandler(map.extent,null,null,null);}var op=this.opacity;if(esri._isDefined(op)&&op<1){this.setOpacity(op,true);}return this._div;},_unsetMap:function(map,_32){dojo.forEach(this.graphics,function(g){g._shape=null;});if(_32.declaredClass){this._div.clear();_32.remove(this._div);dojo.destroy(this._div.getEventSource());}else{_32=this._div.getParent();_32._parent={};dojo.destroy(_32.rawNode);_32.destroy();}this._map=this._div=null;this._init=false;this._disableAllConnectors();},_onZoomStartHandler:function(_33,_34,_35){esri.hide(this._div.getEventSource());},_onExtentChangeHandler:function(_36,_37,_38,lod){if(_38||!this._init){var _39=this._map.__visibleRect,_3a=this._div;this._init=true;this._refresh(true);_3a.setTransform(dojox.gfx.matrix.translate({x:_39.x,y:_39.y}));if(this._renderProto&&_3a.surface.pendingRender){this._dirty=true;}else{if(this.visible){esri.show(_3a.getEventSource());}}if(this.graphics.length>0){this.onUpdate();}}},_canvasRender:function(){var _3b=this._div;if(this._dirty){delete this._dirty;if(this.visible){esri.show(_3b.getEventSource());}}return this._renderProto.apply(_3b,arguments);},_refresh:function(_3c){var gs=this.graphics,il=gs.length,i,_3d=this._draw;for(i=0;i<il;i++){_3d(gs[i],_3c);}},refresh:function(){this._refresh(true);},_onPanHandler:function(_3e,_3f){this._panDx=_3f.x;this._panDy=_3f.y;var _40=this._map.__visibleRect;this._div.setTransform(dojox.gfx.matrix.translate({x:_40.x+_3f.x,y:_40.y+_3f.y}));},_onPanStartHandler:function(_41,_42){esri.hide(this._div.getEventSource());},_onPanEndUpdateHandler:function(_43,_44){if(_44.x!==this._panDx||_44.y!==this._panDy){var _45=this._map.__visibleRect;this._div.setTransform(dojox.gfx.matrix.translate({x:_45.x,y:_45.y}));}this._refresh(false);if(this.graphics.length){this.onUpdate();}},_onPanEndHandler:function(_46,_47){var _48=this._map.__visibleRect,_49=this._div;_49.setTransform(dojox.gfx.matrix.translate({x:_48.x,y:_48.y}));this._refresh(false);if(this._renderProto&&_49.surface.pendingRender){this._dirty=true;}else{esri.show(_49.getEventSource());}if(this.graphics.length){this.onUpdate();}},_getDesiredStatus:function(){return this.visible;},_updateStatus:function(){if(this._getDesiredStatus()){if(this._suspended){this._resume();}}else{if(!this._suspended){this._suspend();}}},_suspend:function(){this._suspended=true;esri.hide(this._div.getEventSource());this._disableDrawConnectors();},_resume:function(){var _4a=this._div;this._suspended=false;this._enableDrawConnectors();var _4b=this._map.__visibleRect;_4a.setTransform(dojox.gfx.matrix.translate({x:_4b.x,y:_4b.y}));this._refresh(true);if(this._renderProto&&_4a.surface.pendingRender){this._dirty=true;}else{esri.show(_4a.getEventSource());}},_enableAllConnectors:function(){this._disableAllConnectors();this._onVisibilityChangeHandler_connect=dojo.connect(this,"onVisibilityChange",this,this._updateStatus);this._enableDrawConnectors();},_disableAllConnectors:function(){this._disableDrawConnectors();dojo.disconnect(this._onVisibilityChangeHandler_connect);},_enableDrawConnectors:function(){var map=this._map,dc=dojo.connect;this._disableDrawConnectors();if(this._params.displayOnPan){this._onPanHandler_connect=dc(map,"onPan",this,"_onPanHandler");this._onPanEndHandler_connect=dc(map,"onPanEnd",this,"_onPanEndUpdateHandler");}else{this._onPanStartHandler_connect=dc(map,"onPanStart",this,"_onPanStartHandler");this._onPanEndHandler_connect=dc(map,"onPanEnd",this,"_onPanEndHandler");}this._onZoomStartHandler_connect=dc(map,"onZoomStart",this,"_onZoomStartHandler");this._onExtentChangeHandler_connect=dc(map,"onExtentChange",this,"_onExtentChangeHandler");},_disableDrawConnectors:function(){var dd=dojo.disconnect;dd(this._onExtentChangeHandler_connect);dd(this._onZoomStartHandler_connect);dd(this._onPanHandler_connect);dd(this._onPanStartHandler_connect);dd(this._onPanEndHandler_connect);},_updateExtent:function(_4c){var _4d=_4c.geometry,eg=esri.geometry;if(!_4d){_4c._extent=null;return;}var _4e=(_4c._extent=_4d.getExtent());if(!_4e){var x,y;if(_4d instanceof eg.Point){x=_4d.x;y=_4d.y;}else{if(_4d instanceof eg.Multipoint){x=_4d.points[0][0];y=_4d.points[0][1];}else{_4c._extent=null;return;}}_4c._extent=new eg.Extent(x,y,x,y,_4d.spatialReference);}},_intersects:function(map,_4f,_50){if(this._wrap&&!_50){var _51=[],_52=map._getFrameWidth(),_53=this._srInfo,_54,_55=map._clip?map._getAvailExtent():map.extent,_56=_55._getParts(_53),g,m,f,gl,ml,fl,_57,_58,_59=[],_5a=_4f._partwise;if(_5a&&_5a.length){_54=[];for(g=0,gl=_5a.length;g<gl;g++){_54=_54.concat(_5a[g]._getParts(_53));}}else{_54=_4f._getParts(_53);}for(g=0,gl=_54.length;g<gl;g++){_57=_54[g];for(m=0,ml=_56.length;m<ml;m++){_58=_56[m];if(_58.extent.intersects(_57.extent)){for(f=0,fl=_57.frameIds.length;f<fl;f++){_51.push((_58.frameIds[0]-_57.frameIds[f])*_52);}}}}for(g=0,gl=_51.length;g<gl;g++){f=_51[g];if(dojo.indexOf(_51,f)===g){_59.push(f);}}return (_59.length)?_59:null;}else{return map.extent.intersects(_4f)?[0]:null;}},_draw:function(_5b,_5c){if(!this._params.drawMode||!this._map){return;}try{var _5d=_5b._extent,_5e;if(_5b.visible&&_5d&&(_5e=this._intersects(this._map,_5d,_5b.geometry._originOnly))){if(!_5b.getDojoShape()||_5c||_5e){var _5f=_5b.geometry.type;if(_5f==="point"){this._drawMarker(_5b,_5e);this._symbolizeMarker(_5b);}else{if(_5f==="multipoint"){this._drawMarkers(_5b,_5e);this._symbolizeMarkers(_5b);}else{this._drawShape(_5b,_5e);this._symbolizeShape(_5b);}}}}else{if(_5b.getDojoShape()){this._removeShape(_5b);}}}catch(err){this._errorHandler(err,_5b);}},_removeShape:function(_60){var _61=_60.getDojoShape();_61.removeShape();_60._shape=null;},_drawShape:function(_62,_63){var _64=_62.geometry,_65=_64.type,map=this._map,me=map.extent,mw=map.width,mh=map.height,eg=esri.geometry,_66=map.__visibleRect,_67=[],i,il;if(_65==="rect"||_65==="extent"){var _68;if(_65==="extent"){_68=eg.toScreenGeometry(me,mw,mh,_64);_68={x:_68.xmin-_66.x+_63[0],y:_68.ymax-_66.y,width:_68.getWidth(),height:_68.getHeight()};}else{var xy=eg.toScreenPoint(me,mw,mh,_64),wh=eg.toScreenPoint(me,mw,mh,{x:_64.x+_64.width,y:_64.y+_64.height});_68={x:xy.x-_66.x+_63[0],y:xy.y-_66.y,width:wh.x-xy.x,height:xy.y-wh.y};}if(_68.width===0){_68.width=1;}if(_68.height===0){_68.height=1;}_62._shape=this._drawRect(this._div,_62.getDojoShape(),_68);}else{if(_65==="polyline"||_65==="polygon"){for(i=0,il=_63.length;i<il;i++){_67=_67.concat(eg._toScreenPath(me,mw,mh,_64,-_66.x+_63[i],-_66.y));}_62._shape=this._drawPath(this._div,_62.getDojoShape(),_67);if(this._rendererLimits){if(_65==="polyline"){this._clipPolyline(_62._shape,_64);}else{this._clipPolygon(_62._shape,_64);}}}}},_drawRect:function(_69,_6a,_6b){return _6a?_6a.setShape(_6b):_69.createRect(_6b);},_drawImage:function(_6c,_6d,_6e){return _6d?_6d.setShape(_6e):_6c.createImage(_6e);},_drawCircle:function(_6f,_70,_71){return _70?_70.setShape(_71):_6f.createCircle(_71);},_drawPath:(function(){if(esri.vml){return function(_72,_73,_74){if(_73){return _73.setShape(_74.join(" "));}else{var p=_72.createObject(esri.gfx.Path,_74.join(" "));_72._overrideSize(p.getEventSource());return p;}};}else{return function(_75,_76,_77){return _76?_76.setShape(_77.join(" ")):_75.createPath(_77.join(" "));};}}()),_drawText:function(_78,_79,_7a){return _79?_79.setShape(_7a):_78.createText(_7a);},_getSymbol:function(_7b){return _7b.symbol||(this.renderer?this.renderer.getSymbol(_7b):null)||null;},_symbolizeShape:function(_7c){var _7d=this._getSymbol(_7c);var _7e=_7d._stroke,_7f=_7d._fill;if(_7e===null||_7f===null){_7e=_7d.getStroke();_7f=_7d.getFill();}_7c.getDojoShape().setStroke(_7e).setFill(_7f);_7d._stroke=_7e;_7d._fill=_7f;},_smsToPath:(function(){if(esri.vml){return function(SMS,_80,x,y,xMh,xPh,yMh,yPh,_81){switch(_80){case SMS.STYLE_SQUARE:return ["M",xMh+","+yMh,"L",xPh+","+yMh,xPh+","+yPh,xMh+","+yPh,"X","E"];case SMS.STYLE_CROSS:return ["M",x+","+yMh,"L",x+","+yPh,"M",xMh+","+y,"L",xPh+","+y,"E"];case SMS.STYLE_X:return ["M",xMh+","+yMh,"L",xPh+","+yPh,"M",xMh+","+yPh,"L",xPh+","+yMh,"E"];case SMS.STYLE_DIAMOND:return ["M",x+","+yMh,"L",xPh+","+y,x+","+yPh,xMh+","+y,"X","E"];case SMS.STYLE_TARGET:return ["M",xMh+","+yMh,"L",xPh+","+yMh,xPh+","+yPh,xMh+","+yPh,xMh+","+yMh,"M",(xMh-_81)+","+y,"L",xMh+","+y,"M",x+","+(yMh-_81),"L",x+","+yMh,"M",(xPh+_81)+","+y,"L",xPh+","+y,"M",x+","+(yPh+_81),"L",x+","+yPh,"E"];}};}else{return function(SMS,_82,x,y,xMh,xPh,yMh,yPh,_83){switch(_82){case SMS.STYLE_SQUARE:return ["M",xMh+","+yMh,xPh+","+yMh,xPh+","+yPh,xMh+","+yPh,"Z"];case SMS.STYLE_CROSS:return ["M",x+","+yMh,x+","+yPh,"M",xMh+","+y,xPh+","+y];case SMS.STYLE_X:return ["M",xMh+","+yMh,xPh+","+yPh,"M",xMh+","+yPh,xPh+","+yMh];case SMS.STYLE_DIAMOND:return ["M",x+","+yMh,xPh+","+y,x+","+yPh,xMh+","+y,"Z"];case SMS.STYLE_TARGET:return ["M",xMh+","+yMh,xPh+","+yMh,xPh+","+yPh,xMh+","+yPh,xMh+","+yMh,"M",(xMh-_83)+","+y,xMh+","+y,"M",x+","+(yMh-_83),x+","+yMh,"M",(xPh+_83)+","+y,xPh+","+y,"M",x+","+(yPh+_83),x+","+yPh];}};}}()),_drawPoint:function(_84,_85,_86,_87,_88){var _89=_86.type,map=this._map,_8a=map.__visibleRect,_8b=esri.geometry.toScreenPoint(map.extent,map.width,map.height,_85).offset(-_8a.x+_88[0],-_8a.y),px=_8b.x,py=_8b.y,_8c;if(_89==="simplemarkersymbol"){var _8d=_86.style,_8e=_86.size/2,_8f=Math.round,SMS=esri.symbol.SimpleMarkerSymbol;switch(_8d){case SMS.STYLE_SQUARE:case SMS.STYLE_CROSS:case SMS.STYLE_X:case SMS.STYLE_DIAMOND:_8c=this._drawPath(_84,_87,this._smsToPath(SMS,_8d,px,py,_8f(px-_8e),_8f(px+_8e),_8f(py-_8e),_8f(py+_8e)));break;case SMS.STYLE_TARGET:var _90=_86._targetWidth/2,_91=_86._targetHeight/2;_8c=this._drawPath(_84,_87,this._smsToPath(SMS,_8d,px,py,_8f(px-_90),_8f(px+_90),_8f(py-_91),_8f(py+_91),_86._spikeSize));break;default:_8c=this._drawCircle(_84,_87,{cx:px,cy:py,r:_8e});}}else{if(_89==="picturemarkersymbol"){var w=_86.width,h=_86.height;_8c=this._drawImage(_84,_87,{x:px-(w/2),y:py-(h/2),width:w,height:h,src:_86.url});}else{if(_89==="textsymbol"){_8c=this._drawText(_84,_87,{type:"text",text:_86.text,x:px,y:py,align:_86.align,decoration:_86.decoration,rotated:_86.rotated,kerning:_86.kerning});}}}_8c.setTransform(dojox.gfx.matrix.multiply(dojox.gfx.matrix.translate(_86.xoffset,-_86.yoffset),dojox.gfx.matrix.rotategAt(_86.angle,_8b)));_8c._wrapOffsets=_88;return _8c;},_symbolizePoint:function(_92,_93){var _94=_93.type;if(_94==="picturemarkersymbol"){return;}var _95=_93._stroke,_96=_93._fill;if(_94==="textsymbol"){_92.setFont(_93.font).setFill(_93.getFill());}else{if(_95===null||_96===null){_95=_93.getStroke();_96=_93.getFill();}if(_94==="simplemarkersymbol"){_92.setFill(_96).setStroke(_95);}_93._stroke=_95;_93._fill=_96;}},_drawMarker:function(_97,_98){_97._shape=this._drawPoint(this._div,_97.geometry,this._getSymbol(_97),_97.getDojoShape(),_98);},_symbolizeMarker:function(_99){this._symbolizePoint(_99.getDojoShape(),this._getSymbol(_99));},_drawMarkers:function(_9a,_9b){var _9c=_9a.geometry,_9d=_9c.points,_9e=this._getSymbol(_9a),_9f=_9a.getDojoShape()||this._div.createGroup(),_a0,i,il=_9d.length,_a1=[],idx=0;for(i=0;i<il;i++){_a0=_9d[i];dojo.forEach(_9b,function(_a2){_a1[0]=_a2;this._drawPoint(_9f,{x:_a0[0],y:_a0[1]},_9e,_9f.children[idx++],_a1);},this);}var _a3=_9f.children.length;if(il*_9b.length<_a3){for(i=_a3-1;i>=il*_9b.length;i--){_9f.children[i].removeShape();}}_9a._shape=_9f;},_symbolizeMarkers:function(_a4){var _a5=this._getSymbol(_a4),_a6=_a4.getDojoShape(),_a7=_a6.children,i,il=_a7.length;for(i=0;i<il;i++){this._symbolizePoint(_a7[i],_a5);}},_errorHandler:function(err,_a8){var msg=esri.bundle.layers.graphics.drawingError;if(_a8){err.message=msg+"(geometry:"+(_a8.geometry?_a8.geometry.declaredClass:null)+", symbol:"+(_a8.symbol?_a8.symbol.declaredClass:null)+"): "+err.message;}else{err.message=msg+"(null): "+err.message;}this.inherited(arguments);},_rendererLimits:(function(){var _a9,_aa,_ab;if(dojo.isFF){_a9=16125;_aa=-32250;_ab=32250;}else{if(dojo.isIE<9){_a9=100000;_aa=-100000;_ab=100000;}else{if(dojo.isChrome&&dojo.isChrome<6){_a9=8150;_aa=-10000;_ab=10000;}}}if(_a9){var _ac,_ad;_ac=[-_a9,-_a9,_a9,_a9];_ad=[[[-_a9,-_a9],[_a9,-_a9]],[[_a9,-_a9],[_a9,_a9]],[[_a9,_a9],[-_a9,_a9]],[[-_a9,_a9],[-_a9,-_a9]]];return {clipLimit:_a9,rangeMin:_aa,rangeMax:_ab,clipBBox:_ac,clipSegments:_ad};}}()),_clipPolyline:function(_ae,_af){var _b0=this._getCorners(_ae,_af);var _b1=_b0.tl,_b2=_b0.br;var _b3=this._rendererLimits;var _b4=_b3.rangeMin,_b5=_b3.rangeMax,_b6=_b3.clipBBox,_b7=_b3.clipSegments;var _b8=this._isPointWithinRange,_b9=this._isPointWithinBBox,_ba=this._getClipperIntersection,_bb=this._getPlaneIndex;if(!_b8(_b1,_b4,_b5)||!_b8(_b2,_b4,_b5)){if(esri.vml){this._createSegments(_ae);}var _bc=[];dojo.forEach(_ae.segments,function(_bd){var _be=_bd.args,len=_be.length,_bf=[],i;for(i=0;i<len;i+=2){var pt1=[_be[i],_be[i+1]];var pt2=[_be[i+2],_be[i+3]];var _c0=_b9(pt1,_b6);var _c1=_b9(pt2,_b6);if(_c0^_c1){var _c2=_ba([pt1,pt2],_b7);if(_c2){if(!_c0){_bf.push(_c2[1],pt2);}else{if(i){_bf.push(_c2[1]);}else{_bf.push(pt1,_c2[1]);}_bc.push(_bf);_bf=[];}}}else{if(_c0){if(i){_bf.push(pt2);}else{_bf.push(pt1,pt2);}}else{var _c3=_bb(pt1,_b6);var _c4=_bb(pt2,_b6);if(_c3===-1||_c4===-1||_c3===_c4){continue;}var _c5=_ba([pt1,pt2],_b7,true);if(_c5.length>0){if(!_c5[_c3]){_c3=_c5[_c3[0]]?_c3[0]:_c3[1];}if(!_c5[_c4]){_c4=_c5[_c4[0]]?_c4[0]:_c4[1];}var _c6=_c5[_c3],_c7=_c5[_c4];if(_c6){_bf.push(_c6);}if(_c7){_bf.push(_c7);_bc.push(_bf);_bf=[];}}}}}_bc.push(_bf);});_ae.setShape(this._getPathStringFromPaths(_bc));}},_clipPolygon:function(_c8,_c9){var _ca=this._getCorners(_c8,_c9);var _cb=_ca.tl,_cc=_ca.br;var _cd=this._rendererLimits;var _ce=_cd.clipLimit,_cf=_cd.rangeMin,_d0=_cd.rangeMax,_d1=_cd.clipBBox,_d2=_cd.clipSegments;var _d3=this._isPointWithinRange,_d4=this._isPointWithinBBox,_d5=this._getClipperIntersection,_d6=this._getPlaneIndex,_d7=esri.geometry._pointLineDistance;if(!_d3(_cb,_cf,_d0)||!_d3(_cc,_cf,_d0)){if(esri.vml){this._createSegments(_c8);}var _d8=dojo.map(_c8.segments,function(_d9){var _da=_d9.args,len=_da.length,_db=[],_dc=[],i;for(i=0;i<len;i+=2){var pt1=[_da[i],_da[i+1]];var pt2=[_da[i+2],_da[i+3]];if(i===(len-2)){_db.push(pt1);break;}var _dd=_d4(pt1,_d1);var _de=_d4(pt2,_d1);_db.push(pt1);if(_dd^_de){var _df=_d5([pt1,pt2],_d2);if(_df){var _e0=_df[1];_e0[_dd?"inOut":"outIn"]=true;_db.push(_e0);_dc.push([_dd?"INOUT":"OUTIN",_db.length-1,_df[0]]);}}else{if(!_dd){var _e1=_d6(pt1,_d1);var _e2=_d6(pt2,_d1);if(_e1===-1||_e2===-1||_e1===_e2){continue;}var _df=_d5([pt1,pt2],_d2,true);if(_df.length>0){if(!_df[_e1]){_e1=_df[_e1[0]]?_e1[0]:_e1[1];}if(!_df[_e2]){_e2=_df[_e2[0]]?_e2[0]:_e2[1];}var _e3=_df[_e1],_e4=_df[_e2];if(_e3){_e3.outIn=true;_db.push(_e3);_dc.push(["OUTIN",_db.length-1,_e1]);}if(_e4){_e4.inOut=true;_db.push(_e4);_dc.push(["INOUT",_db.length-1,_e2]);}}else{if(dojo.isArray(_e1)&&dojo.isArray(_e2)){var _e5=_e1.concat(_e2);_e5.sort();if(_e5.join("")==="0123"){var _e6=[];if((_e1[0]+_e1[1])===3){_e6.push([_ce,-_ce],[-_ce,_ce]);}else{_e6.push([-_ce,-_ce],[_ce,_ce]);}var d1=_d7(_e6[0],[pt1,pt2]);var d2=_d7(_e6[1],[pt1,pt2]);_db.push((d1<d2)?_e6[0]:_e6[1]);}}}}}}var _e7=_d1[0],_e8=_d1[1],_e9=_d1[2],_ea=_d1[3];dojo.forEach(_db,function(_eb){if(_eb[0]<_e7){if(_eb[1]>=_e8&&_eb[1]<=_ea){_eb[0]=_e7;}else{_eb[0]=_e7;_eb[1]=_eb[1]<_e8?_e8:_ea;}}});dojo.forEach(_db,function(_ec){if(_ec[1]<_e8){if(_ec[0]>=_e7&&_ec[0]<=_e9){_ec[1]=_e8;}else{_ec[1]=_e8;_ec[0]=_ec[0]<_e7?_e7:_e9;}}});dojo.forEach(_db,function(_ed){if(_ed[0]>_e9){if(_ed[1]>=_e8&&_ed[1]<=_ea){_ed[0]=_e9;}else{_ed[0]=_e9;_ed[1]=_ed[1]<_e8?_e8:_ea;}}});dojo.forEach(_db,function(_ee){if(_ee[1]>_ea){if(_ee[0]>=_e7&&_ee[0]<=_e9){_ee[1]=_ea;}else{_ee[1]=_ea;_ee[0]=_ee[0]<_e7?_e7:_e9;}}});var k=0,len=_dc.length;if(len>0){do{var _ef=_dc[k];var _f0=_dc[(k+1)%len];if(_ef[2]===_f0[2]&&_ef[0]==="INOUT"&&_f0[0]==="OUTIN"){var _f1=_ef[1],end=_f0[1],u;if(_f1<end){for(u=_f1+1;u<end;u++){_db[u][2]=true;}}else{if(_f1>end){for(u=_f1+1;u<_db.length;u++){_db[u][2]=true;}for(u=0;u<end;u++){_db[u][2]=true;}}}}k=(k+1)%len;}while(k!==0);}var _f2=_db[0],_f3=_db[_db.length-1];if(_f2[2]){_f3[2]=true;dojo.some(_dc,function(_f4){if(_f4[1]===1){_db.splice(_db.length-1,0,dojo.clone(_db[1]));return true;}return false;});}_db=dojo.filter(_db,function(_f5){return _f5[2]?false:true;});for(k=0;k<_db.length-1;k++){var now=_db[k];var _f0=_db[k+1];if(!_f0||(now[0]!==_f0[0])||(now[1]!==_f0[1])){continue;}if(_f0.outIn){now.outIn=true;}else{if(_f0.inOut){now.inOut=true;}}_db.splice(k+1,1);}var abs=Math.abs,_f6=[];for(k=0;k<_db.length-1;k++){var _ef=_db[k],cx=_ef[0],cy=_ef[1];var x1=(abs(cx)===_ce);var y1=(abs(cy)===_ce);var _f0=_db[k+1],nx=_f0[0],ny=_f0[1];var x2=(abs(nx)===_ce);var y2=(abs(ny)===_ce);if(x1&&y2){_f6.push([k+1,[cx,ny]]);}else{if(y1&&x2){_f6.push([k+1,[nx,cy]]);}}}for(k=_f6.length-1;k>=0;k--){var _f7=_f6[k];var _f8=_db[_f7[0]-1];var now=_db[_f7[0]];if(_f8.outIn||_f8.inOut||now.outIn||now.inOut){continue;}_db.splice(_f7[0],0,_f7[1]);}var _f2=_db[0],_f3=_db[_db.length-1];if(_f2[0]!==_f3[0]||_f2[1]!==_f3[1]){_db.push(_f2);}return _db;});_c8.setShape(this._getPathStringFromPaths(_d8));}},_getCorners:function(_f9,_fa){if(esri.vml){var map=this._map;var _fb=_fa.getExtent();var _fc=map.toScreen(new esri.geometry.Point(_fb.xmin,_fb.ymax));var _fd=map.toScreen(new esri.geometry.Point(_fb.xmax,_fb.ymin));return {tl:_fc,br:_fd};}else{var _fe=_f9.getTransformedBoundingBox();return {tl:_fe[0],br:_fe[2]};}},_createSegments:function(_ff){_ff.shape.path=_ff.vmlPath;_ff.segmented=false;_ff._confirmSegmented();var _100=_ff.segments;if(_100.length>1){_ff.segments=dojo.filter(_100,function(_101,idx,arr){var next=arr[idx+1];if(_101.action==="M"&&next&&next.action==="L"){_101.args=_101.args.concat(next.args);return true;}return false;});}},_getPathStringFromPaths:function(_102){if(esri.vml){_102=dojo.map(_102,function(path){var _103=dojo.map(path,function(_104,idx){return (idx===1?"l ":"")+_104.join(",");});return "m "+_103.join(" ");});_102.push("e");}else{_102=dojo.map(_102,function(path){var _105=dojo.map(path,function(_106){return _106.join(",");});return "M "+_105.join(" ");});}return _102.join(" ");},_isPointWithinBBox:function(_107,bbox){var left=bbox[0],top=bbox[1];var _108=bbox[2],_109=bbox[3];var x=_107[0],y=_107[1];if(x>left&&x<_108&&y>top&&y<_109){return true;}else{return false;}},_isPointWithinRange:function(_10a,_10b,_10c){var x=_10a.x,y=_10a.y;if(x<_10b||y<_10b||x>_10c||y>_10c){return false;}else{return true;}},_getClipperIntersection:function(line,_10d,_10e){var i,_10f=esri.geometry._getLineIntersection2,_110=Math.round,data={length:0};for(i=0;i<4;i++){var _111=_10f(line,_10d[i]);if(_111){_111[0]=_110(_111[0]);_111[1]=_110(_111[1]);if(!_10e){return [i,_111];}else{data[i]=_111;data.length++;}}}return _10e?data:null;},_getPlaneIndex:function(_112,_113){var px=_112[0],py=_112[1],xmin=_113[0],ymin=_113[1],xmax=_113[2],ymax=_113[3];if(px<=xmin){if((py>=ymin)&&(py<=ymax)){return 3;}else{return (py<ymin)?[0,3]:[2,3];}}if(py<=ymin){if((px>=xmin)&&(px<=xmax)){return 0;}else{return (px<xmin)?[3,0]:[1,0];}}if(px>=xmax){if((py>=ymin)&&(py<=ymax)){return 1;}else{return (py<ymin)?[0,1]:[2,1];}}if(py>=ymax){if((px>=xmin)&&(px<=xmax)){return 2;}else{return (px<xmin)?[3,2]:[1,2];}}return -1;},onGraphicAdd:function(){},onGraphicRemove:function(){},onGraphicsClear:function(){},onOpacityChange:function(){},setInfoTemplate:function(_114){this.infoTemplate=_114;},add:function(_115){var _116=arguments[1],i;if((i=dojo.indexOf(this.graphics,_115))!==-1){return this.graphics[i];}if(!_116){this.graphics.push(_115);}_115._graphicsLayer=this;this._updateExtent(_115);this._draw(_115);if(!_116){this.onGraphicAdd(_115);}return _115;},remove:function(_117){if(!arguments[1]){var _118=this.graphics,i;if((i=dojo.indexOf(_118,_117))===-1){return null;}_117=this.graphics.splice(i,1)[0];}if(_117.getDojoShape()){this._removeShape(_117);}_117._shape=_117._graphicsLayer=null;this.onGraphicRemove(_117);return _117;},clear:function(){var _119=arguments[1],g=this.graphics;while(g.length>0){this.remove(g[0]);}if(!_119){this.onGraphicsClear();}},setOpacity:function(op,_11a){if(_11a||this.opacity!=op){var div=this._div;if(div){if(esri.vml){dojo.forEach(this.graphics,function(_11b){var _11c=_11b._shape;var node=_11c&&_11c.getNode();if(node){var _11d=_11c.strokeStyle,_11e=node.stroke;if(_11d&&_11e){_11e.opacity=_11d.color.a*op;}var _11f=_11c.fillStyle,fill=node.fill;if(_11f&&fill){if(fill.type==="tile"){dojo.style(node,"opacity",op);}else{fill.opacity=_11f.a*op;}}}});div._esriIeOpacity=op;}else{if(this._renderProto){dojo.style(div.getEventSource(),"opacity",op);}else{div.getEventSource().setAttribute("opacity",op);}}}this.opacity=op;if(!_11a){this.onOpacityChange(op);}}},setRenderer:function(ren){this.renderer=ren;}});dojo.declare("esri.layers.GraphicsLayer",esri.layers._GraphicsLayer,{constructor:function(){this.enableMouseEvents=dojo.hitch(this,this.enableMouseEvents);this.disableMouseEvents=dojo.hitch(this,this.disableMouseEvents);this._processEvent=dojo.hitch(this,this._processEvent);this._initLayer();},_initLayer:function(){this.loaded=true;this.onLoad(this);},_setMap:function(map,_120){var d=this.inherited("_setMap",arguments);this.enableMouseEvents();return d;},_unsetMap:function(map,_121){this.disableMouseEvents();this.inherited("_unsetMap",arguments);},_processEvent:function(evt){var _122=this._map,g=this.graphics,gl=g.length;evt.screenPoint=new esri.geometry.Point(evt.pageX-_122.position.x,evt.pageY-_122.position.y);evt.mapPoint=_122.toMap(evt.screenPoint);var i,es,gr,ds,_123=evt.target,_124=_123.parentNode;for(i=0;i<gl;i++){gr=g[i];ds=gr.getDojoShape();if(ds){es=ds.getEventSource();if(es===_123||es===_124){evt.graphic=gr;return evt;}}}},_onMouseOverHandler:function(evt){if(this._processEvent(evt)){this.onMouseOver(evt);}},_onMouseMoveHandler:function(evt){if(this._processEvent(evt)){this.onMouseMove(evt);}},_onMouseDragHandler:function(evt){if(this._processEvent(evt)){this.onMouseDrag(evt);}},_onMouseOutHandler:function(evt){if(this._processEvent(evt)){this.onMouseOut(evt);}},_onMouseDownHandler:function(evt){this._downGr=this._downPt=null;if(this._processEvent(evt)){dojo.disconnect(this._onmousemove_connect);dojo.disconnect(this._onmousedrag_connect);this._onmousedrag_connect=dojo.connect(this._div.getEventSource(),"onmousemove",this,"_onMouseDragHandler");this._downGr=evt.graphic;this._downPt=evt.screenPoint.x+","+evt.screenPoint.y;this.onMouseDown(evt);}},_onMouseUpHandler:function(evt){this._upGr=this._upPt=null;if(this._processEvent(evt)){dojo.disconnect(this._onmousedrag_connect);dojo.disconnect(this._onmousemove_connect);this._onmousemove_connect=dojo.connect(this._div.getEventSource(),"onmousemove",this,"_onMouseMoveHandler");this._upGr=evt.graphic;this._upPt=evt.screenPoint.x+","+evt.screenPoint.y;this.onMouseUp(evt);}},_onClickHandler:function(evt){if(this._processEvent(evt)){var _125=this._downGr,upGr=this._upGr;if(_125&&upGr&&_125===upGr&&this._downPt===this._upPt){if(dojo.isIE<9){esri.layers.GraphicsLayer._clicked=evt.graphic;}this.onClick(evt);}}},_onDblClickHandler:function(evt){if(this._processEvent(evt)){this.onDblClick(evt);}},onMouseOver:function(){},onMouseMove:function(){},onMouseDrag:function(){},onMouseOut:function(){},onMouseDown:function(){},onMouseUp:function(){},onClick:function(){},onDblClick:function(){},enableMouseEvents:function(){if(this._mouseEvents){return;}var dc=dojo.connect,gc=this._div.getEventSource();if(dojox.gfx.renderer!=="canvas"){this._onmouseover_connect=dc(gc,"onmouseover",this,"_onMouseOverHandler");this._onmousemove_connect=dc(gc,"onmousemove",this,"_onMouseMoveHandler");this._onmouseout_connect=dc(gc,"onmouseout",this,"_onMouseOutHandler");this._onmousedown_connect=dc(gc,"onmousedown",this,"_onMouseDownHandler");this._onmouseup_connect=dc(gc,"onmouseup",this,"_onMouseUpHandler");this._onclick_connect=dc(gc,"onclick",this,"_onClickHandler");this._ondblclick_connect=dc(gc,"ondblclick",this,"_onDblClickHandler");}this._mouseEvents=true;},disableMouseEvents:function(){if(!this._mouseEvents){return;}var ddc=dojo.disconnect;ddc(this._onmouseover_connect);ddc(this._onmousemove_connect);ddc(this._onmousedrag_connect);ddc(this._onmouseout_connect);ddc(this._onmousedown_connect);ddc(this._onmouseup_connect);ddc(this._onclick_connect);ddc(this._ondblclick_connect);this._mouseEvents=false;}});}