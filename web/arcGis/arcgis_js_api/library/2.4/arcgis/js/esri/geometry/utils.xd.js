/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */

window[esri._dojoScopeName||"dojo"]._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","esri.geometry.utils"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["esri.geometry.utils"]){_4._hasResource["esri.geometry.utils"]=true;_4.provide("esri.geometry.utils");(function(){var EG=esri.geometry;EG.normalizeCentralMeridian=function(_7,_8,_9,_a){var _b=new _4.Deferred();_b.addCallbacks(_9,_a);var _c=[];var _d=[];var _e=_7[0].spatialReference,_f=_e._getInfo();var _10=180;var _11=-180;var _12=false;if(_e._isWebMercator()){_10=20037508.342788905;_11=-20037508.342788905;_12=true;}var _13=new esri.geometry.Polyline({"paths":[[[_10,_11],[_10,_10]]]});var _14=new esri.geometry.Polyline({"paths":[[[_11,_11],[_11,_10]]]});var _15=0;_4.forEach(_7,function(_16){var _17=esri.geometry.fromJson(_4.fromJson(_4.toJson(_16.toJson())));var _18=_16.getExtent();if(_16.type==="point"){_c.push(EG._pointNormalization(_17,_10,_11));}else{if(_16.type==="multipoint"){_17.points=_4.map(_17.points,function(_19){return EG._pointNormalization(_19,_10,_11);});_c.push(_17);}else{if(_16.type==="extent"){_c.push(_18._normalize(null,null,_f));}else{var _1a=EG._offsetMagnitude(_18.xmin,_11);var _1b=_1a*(2*_10);_17=(_1b===0)?_17:EG._updatePolyGeometry(_17,_1b);_18=_18.offset(_1b,0);if(_18.intersects(_13)){_15=(_18.xmax>_15)?_18.xmax:_15;_17=EG._prepareGeometryForCut(_17,_12);_d.push(_17);_c.push("cut");}else{if(_18.intersects(_14)){_15=(_18.xmax*(2*_10)>_15)?_18.xmax*(2*_10):_15;_17=EG._prepareGeometryForCut(_17,_12,360);_d.push(_17);_c.push("cut");}else{_c.push(_17);}}}}}});var _1c=new esri.geometry.Polyline();var _1d=EG._offsetMagnitude(_15,_10);var _1e=-90,_1f=_1d;while(_1d>0){var _20=-180+(360*_1d);_1c.addPath([[_20,_1e],[_20,_1e*-1]]);_1e=_1e*-1;_1d--;}if(_d.length>0&&_1f>0){if(_8){_8.cut(_d,_1c,function(_21){_d=EG._foldCutResults(_d,_21);var _22=[];_4.forEach(_c,function(_23,i){if(_23==="cut"){var _24=_d.shift();if((_7[i].rings)&&(_7[i].rings.length>1)&&(_24.rings.length>=_7[i].rings.length)){_c[i]="simplify";_22.push(_24);}else{_c[i]=(_12===true)?EG.geographicToWebMercator(_24):_24;}}});if(_22.length>0){_8.simplify(_22,function(_25){_4.forEach(_c,function(_26,i){if(_26==="simplify"){_c[i]=(_12===true)?EG.geographicToWebMercator(_25.shift()):_25.shift();}});_b.callback(_c);},function(_27){_b.errback(_27);});}else{_b.callback(_c);}},function(_28){_b.errback(_28);});}else{_b.errback(new Error("esri.geometry.normalizeCentralMeridian: 'geometryService' argument is missing."));}}else{_4.forEach(_c,function(_29,i){if(_29==="cut"){var _2a=_d.shift();_c[i]=(_12===true)?EG.geographicToWebMercator(_2a):_2a;}});_b.callback(_c);}return _b;};EG.geodesicDensify=function(_2b,_2c){var _2d=Math.PI/180;var _2e=6371008.771515059;if(_2c<_2e/10000){_2c=_2e/10000;}if(!(_2b instanceof esri.geometry.Polyline||_2b instanceof esri.geometry.Polygon)){var msg="_geodesicDensify: the input geometry is neither polyline nor polygon";console.error(msg);throw new Error(msg);}var _2f=_2b instanceof esri.geometry.Polyline,_30=_2f?_2b.paths:_2b.rings,_31=[],_32;_4.forEach(_30,function(_33){_31.push(_32=[]);_32.push([_33[0][0],_33[0][1]]);var _34,_35,_36,_37;_34=_33[0][0]*_2d;_35=_33[0][1]*_2d;for(var i=0;i<_33.length-1;i++){_36=_33[i+1][0]*_2d;_37=_33[i+1][1]*_2d;var _38=EG._inverseGeodeticSolver(_35,_34,_37,_36);var _39=_38.azimuth;var _3a=_38.geodesicDistance;var _3b=_3a/_2c;if(_3b>1){for(var j=1;j<=_3b-1;j++){var _3c=j*_2c;var pt=EG._directGeodeticSolver(_35,_34,_39,_3c);_32.push([pt.x,pt.y]);}var _3d=(_3a+Math.floor(_3b-1)*_2c)/2;var _3e=EG._directGeodeticSolver(_35,_34,_39,_3d);_32.push([_3e.x,_3e.y]);}var _3f=EG._directGeodeticSolver(_35,_34,_39,_3a);_32.push([_3f.x,_3f.y]);_34=_3f.x*_2d;_35=_3f.y*_2d;}});if(_2f){return new esri.geometry.Polyline({paths:_31,spatialReference:_2b.spatialReference});}else{return new esri.geometry.Polygon({rings:_31,spatialReference:_2b.spatialReference});}};EG.geodesicLengths=function(_40,_41){var _42=Math.PI/180;var _43=[];_4.forEach(_40,function(_44,idx){var _45=0;_4.forEach(_44.paths,function(_46,idx){var _47=0;var _48,_49,_4a,_4b,_4c;for(var i=1;i<_46.length;i++){_48=_46[i-1][0]*_42;_49=_46[i][0]*_42;_4a=_46[i-1][1]*_42;_4b=_46[i][1]*_42;_4c=EG._inverseGeodeticSolver(_4a,_48,_4b,_49);_47+=_4c.geodesicDistance/1609.344;}_45+=_47;});_45*=EG._unitsDictionary[_41];_43.push(_45);});return _43;};EG.geodesicAreas=function(_4d,_4e){var _4f=[];_4.forEach(_4d,function(_50,idx){var _51=EG.geodesicDensify(_50,10000);_4f.push(_51);});var _52=[];var _53,_54;_4.forEach(_4f,function(_55,idx){var _56=0;_4.forEach(_55.rings,function(_57,idx){_53=EG._toEqualAreaPoint(new esri.geometry.Point(_57[0][0],_57[0][1]));_54=EG._toEqualAreaPoint(new esri.geometry.Point(_57[_57.length-1][0],_57[_57.length-1][1]));var _58=_54.x*_53.y-_53.x*_54.y;var i;for(i=0;i<_57.length-1;i++){_53=EG._toEqualAreaPoint(new esri.geometry.Point(_57[i+1][0],_57[i+1][1]));_54=EG._toEqualAreaPoint(new esri.geometry.Point(_57[i][0],_57[i][1]));_58+=_54.x*_53.y-_53.x*_54.y;}_58/=4046.87;_56+=_58;});_56*=EG._unitsDictionary[_4e];_52.push(_56/(-2));});return _52;};EG.polygonSelfIntersecting=function(_59){var _5a=_59.rings.length;for(var k=0;k<_5a;k++){for(var i=0;i<_59.rings[k].length-1;i++){var _5b=[[_59.rings[k][i][0],_59.rings[k][i][1]],[_59.rings[k][i+1][0],_59.rings[k][i+1][1]]];for(var j=k+1;j<_5a;j++){for(var m=0;m<_59.rings[j].length-1;m++){var _5c=[[_59.rings[j][m][0],_59.rings[j][m][1]],[_59.rings[j][m+1][0],_59.rings[j][m+1][1]]];var _5d=esri.geometry._getLineIntersection2(_5b,_5c);if(_5d){if(!((_5d[0]===_5b[0][0]&&_5d[1]===_5b[0][1])||(_5d[0]===_5c[0][0]&&_5d[1]===_5c[0][1])||(_5d[0]===_5b[1][0]&&_5d[1]===_5b[1][1])||(_5d[0]===_5c[1][0]&&_5d[1]===_5c[1][1]))){return true;}}}}}var _5e=_59.rings[k].length;if(_5e<=4){continue;}for(var i=0;i<_5e-3;i++){var _5f=_5e-1;if(i===0){_5f=_5e-2;}var _5b=[[_59.rings[k][i][0],_59.rings[k][i][1]],[_59.rings[k][i+1][0],_59.rings[k][i+1][1]]];for(var j=i+2;j<_5f;j++){var _5c=[[_59.rings[k][j][0],_59.rings[k][j][1]],[_59.rings[k][j+1][0],_59.rings[k][j+1][1]]];var _5d=esri.geometry._getLineIntersection2(_5b,_5c);if(_5d){if(!((_5d[0]===_5b[0][0]&&_5d[1]===_5b[0][1])||(_5d[0]===_5c[0][0]&&_5d[1]===_5c[0][1])||(_5d[0]===_5b[1][0]&&_5d[1]===_5b[1][1])||(_5d[0]===_5c[1][0]&&_5d[1]===_5c[1][1]))){return true;}}}}}return false;};EG._foldCutResults=function(_60,_61){var _62=-1;_4.forEach(_61.cutIndexes,function(_63,i){var _64=_61.geometries[i];var _65=_64.rings||_64.paths;_4.forEach(_65,function(_66,_67){_4.some(_66,function(_68){if(_68[0]<180){return true;}else{var _69=0,j,jl=_66.length,ptX;for(j=0;j<jl;j++){ptX=_66[j][0];_69=ptX>_69?ptX:_69;}var _6a=EG._offsetMagnitude(_69,180);var _6b=_6a*-360;for(var _6c=0,_6d=_66.length;_6c<_6d;_6c++){var _6e=_64.getPoint(_67,_6c);_64.setPoint(_67,_6c,_6e.offset(_6b,0));}return true;}});});if(_63===_62){if(_64.rings){_4.forEach(_64.rings,function(_6f,j){_60[_63]=_60[_63].addRing(_6f);});}else{_4.forEach(_64.paths,function(_70,j){_60[_63]=_60[_63].addPath(_70);});}}else{_62=_63;_60[_63]=_64;}});return _60;};EG._prepareGeometryForCut=function(_71,_72,_73){var _74=1000000;if(_72){var _75=EG._straightLineDensify(_71,_74);_71=EG.webMercatorToGeographic(_75,true);}if(_73){_71=EG._updatePolyGeometry(_71,_73);}return _71;};EG._offsetMagnitude=function(_76,_77){return Math.ceil((_76-_77)/(_77*2));};EG._pointNormalization=function(_78,_79,_7a){var _7b=_78.x||_78[0];var _7c;if(_7b>_79){_7c=EG._offsetMagnitude(_7b,_79);if(_78.x){_78=_78.offset(_7c*(-2*_79),0);}else{_78[0]=_7b+(_7c*(-2*_79));}}else{if(_7b<_7a){_7c=EG._offsetMagnitude(_7b,_7a);if(_78.x){_78=_78.offset(_7c*(-2*_7a),0);}else{_78[0]=_7b+(_7c*(-2*_7a));}}}return _78;};EG._updatePolyGeometry=function(_7d,_7e){var _7f=_7d.paths||_7d.rings;for(var i=0,il=_7f.length;i<il;i++){var _80=_7f[i];for(var j=0,jl=_80.length;j<jl;j++){var _81=_7d.getPoint(i,j);_7d.setPoint(i,j,_81.offset(_7e,0));}}return _7d;};EG._straightLineDensify=function(_82,_83){if(!(_82 instanceof esri.geometry.Polyline||_82 instanceof esri.geometry.Polygon)){var msg="_straightLineDensify: the input geometry is neither polyline nor polygon";console.error(msg);throw new Error(msg);}var _84=_82 instanceof esri.geometry.Polyline,_85=_84?_82.paths:_82.rings,_86=[],_87;_4.forEach(_85,function(_88){_86.push(_87=[]);_87.push([_88[0][0],_88[0][1]]);var x1,y1,x2,y2;var _89,_8a,_8b,_8c,xj,yj;for(var i=0;i<_88.length-1;i++){x1=_88[i][0];y1=_88[i][1];x2=_88[i+1][0];y2=_88[i+1][1];_89=Math.sqrt((x2-x1)*(x2-x1)+(y2-y1)*(y2-y1));_8a=(y2-y1)/_89;_8b=(x2-x1)/_89;_8c=_89/_83;if(_8c>1){for(var j=1;j<=_8c-1;j++){var _8d=j*_83;xj=_8b*_8d+x1;yj=_8a*_8d+y1;_87.push([xj,yj]);}var _8e=(_89+Math.floor(_8c-1)*_83)/2;xj=_8b*_8e+x1;yj=_8a*_8e+y1;_87.push([xj,yj]);}_87.push([x2,y2]);}});if(_84){return new esri.geometry.Polyline({paths:_86,spatialReference:_82.spatialReference});}else{return new esri.geometry.Polygon({rings:_86,spatialReference:_82.spatialReference});}};EG._unitsDictionary={"esriMiles":1,"esriKilometers":1.609344,"esriFeet":5280,"esriMeters":1609.34,"esriYards":1760,"esriNauticalMiles":0.869,"esriCentimeters":160934,"esriDecimeters":16093.4,"esriInches":63360,"esriMillimeters":1609340,"esriAcres":1,"esriAres":40.4685642,"esriSquareKilometers":0.00404685642,"esriSquareMiles":0.0015625,"esriSquareFeet":43560,"esriSquareMeters":4046.85642,"esriHectares":0.404685642,"esriSquareYards":4840,"esriSquareInches":6272640,"esriSquareMillimeters":4046856420,"esriSquareCentimeters":40468564.2,"esriSquareDecimeters":404685.642};EG._toEqualAreaPoint=function(pt){var _8f=Math.PI/180;var a=6378137;var eSq=0.006694379990197414,e=0.0818191908429643;var _90=Math.sin(pt.y*_8f);var q=(1-eSq)*((_90/(1-eSq*(_90*_90))-(1/(2*e))*Math.log((1-e*_90)/(1+e*_90))));var x=a*pt.x*_8f;var y=a*q*0.5;var _91=new esri.geometry.Point(x,y);return _91;};EG._directGeodeticSolver=function(_92,_93,_94,s){var a=6378137,b=6356752.31424518,f=1/298.257223563;var _95=Math.sin(_94);var _96=Math.cos(_94);var _97=(1-f)*Math.tan(_92);var _98=1/Math.sqrt((1+_97*_97)),_99=_97*_98;var _9a=Math.atan2(_97,_96);var _9b=_98*_95;var _9c=1-_9b*_9b;var uSq=_9c*(a*a-b*b)/(b*b);var A=1+uSq/16384*(4096+uSq*(-768+uSq*(320-175*uSq)));var B=uSq/1024*(256+uSq*(-128+uSq*(74-47*uSq)));var _9d=s/(b*A),_9e=2*Math.PI;var _9f,_a0,_a1;while(Math.abs(_9d-_9e)>1e-12){_a1=Math.cos(2*_9a+_9d);_9f=Math.sin(_9d);_a0=Math.cos(_9d);var _a2=B*_9f*(_a1+B/4*(_a0*(-1+2*_a1*_a1)-B/6*_a1*(-3+4*_9f*_9f)*(-3+4*_a1*_a1)));_9e=_9d;_9d=s/(b*A)+_a2;}var tmp=_99*_9f-_98*_a0*_96;var _a3=Math.atan2(_99*_a0+_98*_9f*_96,(1-f)*Math.sqrt(_9b*_9b+tmp*tmp));var _a4=Math.atan2(_9f*_95,_98*_a0-_99*_9f*_96);var C=f/16*_9c*(4+f*(4-3*_9c));var L=_a4-(1-C)*f*_9b*(_9d+C*_9f*(_a1+C*_a0*(-1+2*_a1*_a1)));var _a5=_a3/(Math.PI/180);var _a6=(_93+L)/(Math.PI/180);var pt=new esri.geometry.Point(_a6,_a5,new esri.SpatialReference({wkid:4326}));return pt;};EG._inverseGeodeticSolver=function(_a7,_a8,_a9,_aa){var a=6378137,b=6356752.31424518,f=1/298.257223563;var L=(_aa-_a8);var U1=Math.atan((1-f)*Math.tan(_a7));var U2=Math.atan((1-f)*Math.tan(_a9));var _ab=Math.sin(U1),_ac=Math.cos(U1);var _ad=Math.sin(U2),_ae=Math.cos(U2);var _af=L,_b0,_b1=1000;var _b2,_b3,_b4,_b5,_b6;do{var _b7=Math.sin(_af),_b8=Math.cos(_af);_b3=Math.sqrt((_ae*_b7)*(_ae*_b7)+(_ac*_ad-_ab*_ae*_b8)*(_ac*_ad-_ab*_ae*_b8));if(_b3===0){return 0;}_b5=_ab*_ad+_ac*_ae*_b8;_b6=Math.atan2(_b3,_b5);var _b9=_ac*_ae*_b7/_b3;_b2=1-_b9*_b9;_b4=_b5-2*_ab*_ad/_b2;if(isNaN(_b4)){_b4=0;}var C=f/16*_b2*(4+f*(4-3*_b2));_b0=_af;_af=L+(1-C)*f*_b9*(_b6+C*_b3*(_b4+C*_b5*(-1+2*_b4*_b4)));}while(Math.abs(_af-_b0)>1e-12&&--_b1>0);if(_b1===0){var _ba=6371009;var _bb=Math.acos(Math.sin(_a7)*Math.sin(_a9)+Math.cos(_a7)*Math.cos(_a9)*Math.cos(_aa-_a8))*_ba;var _bc=_aa-_a8;var y=Math.sin(_bc)*Math.cos(_a9);var x=Math.cos(_a7)*Math.sin(_a9)-Math.sin(_a7)*Math.cos(_a9)*Math.cos(_bc);var _bd=Math.atan2(y,x);return {"azimuth":_bd,"geodesicDistance":_bb};}var uSq=_b2*(a*a-b*b)/(b*b);var A=1+uSq/16384*(4096+uSq*(-768+uSq*(320-175*uSq)));var B=uSq/1024*(256+uSq*(-128+uSq*(74-47*uSq)));var _be=B*_b3*(_b4+B/4*(_b5*(-1+2*_b4*_b4)-B/6*_b4*(-3+4*_b3*_b3)*(-3+4*_b4*_b4)));var s=b*A*(_b6-_be);var _bf=Math.atan2(_ae*Math.sin(_af),_ac*_ad-_ab*_ae*Math.cos(_af));var _c0=Math.atan2(_ac*Math.sin(_af),_ac*_ad*Math.cos(_af)-_ab*_ae);var _c1={azimuth:_bf,geodesicDistance:s,reverseAzimuth:_c0};return _c1;};}());}}};});