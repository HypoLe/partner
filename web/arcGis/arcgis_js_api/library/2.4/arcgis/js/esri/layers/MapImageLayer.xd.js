/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */

window[esri._dojoScopeName||"dojo"]._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","esri.layers.MapImageLayer"],["require","esri.utils"],["require","esri.layers.layer"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["esri.layers.MapImageLayer"]){_4._hasResource["esri.layers.MapImageLayer"]=true;_4.provide("esri.layers.MapImageLayer");_4.require("esri.utils");_4.require("esri.layers.layer");_4.declare("esri.layers.MapImageLayer",[esri.layers.Layer],{"-chains-":{constructor:"manual"},constructor:function(_7){this.inherited(arguments,[null,_7]);this._mapImages=[];var _8=_4.hitch;this._panStart=_8(this,this._panStart);this._pan=_8(this,this._pan);this._extentChange=_8(this,this._extentChange);this._zoom=_8(this,this._zoom);this.loaded=true;this.onLoad(this);},opacity:1,setOpacity:function(_9){if(this.opacity!=_9){this.onOpacityChange(this.opacity=_9);}},onOpacityChange:function(_a){if(this._div){_4.style(this._div,"opacity",_a);}},_transform:esri._getDOMAccessor("transform"),addImage:function(_b){var _c=this._mapImages.push(_b);_c=_c-1;_b._idx=_c;_b._layer=this;if(this._div){this._createImage(_b,_c);}},removeImage:function(_d){if(_d){var _e=_d._idx,_f=this._mapImages;if(_f[_e]===_d){delete _f[_e];var _10=_d._node;if(_10){this._clearEvents(_10);_10.e_idx=_10.e_bl=_10.e_tr=_10.e_l=_10.e_t=_10.e_w=_10.e_h=null;var div=this._div;if(div){div.removeChild(_10);_4.destroy(_10);}}_d._node=_d._idx=_d._layer=null;}}},removeAllImages:function(){var _11=this._mapImages,i,len=_11.length;for(i=0;i<len;i++){var _12=_11[i];if(_12){this.removeImage(_12);}}this._mapImages=[];},getImages:function(){var _13=this._mapImages,_14=[],i,len=_13.length;for(i=0;i<len;i++){if(_13[i]){_14.push(_13[i]);}}return _14;},_createImage:function(_15,idx){var _16=_4.create("img");_4.style(_16,{position:"absolute",left:"0px",top:"0px"});if(_15.rotation){var _17="rotate("+(360-_15.rotation)+"deg)";if(_4.isIE<9){}else{_4.style(_16,this._transform,_17);_4.style(_16,"transform",_17);}}_15._node=_16;_16.e_idx=idx;_16.e_layer=this;_16.e_load=_4.connect(_16,"onload",esri.layers.MapImageLayer.prototype._imageLoaded);_16.e_error=_4.connect(_16,"onerror",esri.layers.MapImageLayer.prototype._imageError);_16.e_abort=_4.connect(_16,"onabort",esri.layers.MapImageLayer.prototype._imageError);_16.src=_15.href;},_imageLoaded:function(evt){var _18=evt.target||evt.currentTarget,_19=_18.e_layer,_1a=_19._mapImages[_18.e_idx];_19._clearEvents(_18);if(!_1a||_1a._node!==_18){return;}if(_19._map){_19._attach(_1a);}},_imageError:function(evt){var _1b=evt.target||evt.currentTarget,_1c=_1b.e_layer,_1d=_1c._mapImages[_1b.e_idx];_1c._clearEvents(_1b);if(_1d){_1d._node=null;}},_clearEvents:function(_1e){var _1f=_4.disconnect;_1f(_1e.e_load);_1f(_1e.e_error);_1f(_1e.e_abort);_1e.e_load=_1e.e_error=_1e.e_abort=_1e.e_layer=null;},_attach:function(_20){var _21=_20.extent,_22=_21.spatialReference,_23=this._sr,_24=_22.wkid||4326,div=this._div,_25=_20._node,_26=new esri.geometry.Point({x:_21.xmin,y:_21.ymin}),_27=new esri.geometry.Point({x:_21.xmax,y:_21.ymax});if(_22&&(_24!==_23.wkid)){if(_24===4326&&_23._isWebMercator()){_25.e_bl=esri.geometry.geographicToWebMercator(_26);_25.e_tr=esri.geometry.geographicToWebMercator(_27);}else{if(_22._isWebMercator()&&_23.wkid===4326){_25.e_bl=esri.geometry.webMercatorToGeographic(_26);_25.e_tr=esri.geometry.webMercatorToGeographic(_27);}}}else{_25.e_bl=_26;_25.e_tr=_27;}if(_20.visible){this._setPos(_25,_4.style(div,"left"),_4.style(div,"top"));div.appendChild(_25);}},_setPos:function(_28,_29,_2a){var _2b=_28.e_bl,_2c=_28.e_tr,map=this._map;_2b=map.toScreen(_2b);_2c=map.toScreen(_2c);var _2d=_2b.x-_29,top=_2c.y-_2a,_2e=Math.abs(_2c.x-_2b.x),_2f=Math.abs(_2b.y-_2c.y);_4.style(_28,{left:_2d+"px",top:top+"px",width:_2e+"px",height:_2f+"px"});_28.e_l=_2d;_28.e_t=top;_28.e_w=_2e;_28.e_h=_2f;},_setMap:function(map,_30){this._map=map;this._sr=map.spatialReference;var div=this._div=_4.create("div",null,_30);_4.style(div,"position","absolute");_4.style(div,"opacity",this.opacity);var _31=this._mapImages,i,len=_31.length;for(i=0;i<len;i++){var _32=_31[i],_33=_32._node;if(!_33){this._createImage(_32,_32._idx);}}this.onVisibilityChange(this.visible);return div;},_unsetMap:function(map,_34){this._disconnect();var div=this._div;if(div){var _35=this._mapImages,i,len=_35.length;for(i=0;i<len;i++){var _36=_35[i];if(_36){var _37=_36._node;if(_37){this._clearEvents(_37);_37.e_idx=_37.e_bl=_37.e_tr=_37.e_l=_37.e_t=_37.e_w=_37.e_h=null;}_36._node=null;}}_34.removeChild(div);_4.destroy(div);}this._map=this._div=this._sr=null;},onVisibilityChange:function(_38){var div=this._div;if(div){if(_38){this._redraw();this._connect(this._map);esri.show(div);}else{this._disconnect();esri.hide(div);}}},_connect:function(map){if(!this._connections){var _39=_4.connect;this._connections=[_39(map,"onPanStart",this._panStart),_39(map,"onPan",this._pan),_39(map,"onExtentChange",this._extentChange),_39(map,"onZoom",this._zoom)];}},_disconnect:function(){if(this._connections){_4.forEach(this._connections,_4.disconnect);this._connections=null;}},_panStart:function(){this._panL=_4.style(this._div,"left");this._panT=_4.style(this._div,"top");},_pan:function(_3a,_3b){_4.style(this._div,{left:this._panL+_3b.x+"px",top:this._panT+_3b.y+"px"});},_extentChange:function(_3c,_3d,_3e){if(_3e){this._redraw();}else{if(_3d){_4.style(this._div,{left:this._panL+_3d.x+"px",top:this._panT+_3d.y+"px"});}}},_redraw:function(){var div=this._div,_3f=_4.style(div,"left"),_40=_4.style(div,"top"),i,len=div.childNodes.length,_41;for(i=0;i<len;i++){_41=div.childNodes[i];this._setPos(_41,_3f,_40);}},_zoom:function(_42,_43,_44){var div=this._div,_45=_4.style(div,"left"),_46=_4.style(div,"top"),i,len=div.childNodes.length,_47;for(i=0;i<len;i++){_47=div.childNodes[i];var _48=_47.e_w*_43,_49=_47.e_h*_43,_4a=(_44.x-_45-_47.e_l)*(_48-_47.e_w)/_47.e_w,_4b=(_44.y-_46-_47.e_t)*(_49-_47.e_h)/_47.e_h;_4a=isNaN(_4a)?0:_4a;_4b=isNaN(_4b)?0:_4b;_4.style(_47,{left:(_47.e_l-_4a)+"px",top:(_47.e_t-_4b)+"px",width:_48+"px",height:_49+"px"});}}});_4.extend(esri.layers.MapImage,{visible:true,getLayer:function(){return this._layer;},getNode:function(){return this._node;},show:function(){if(!this.visible){this.visible=true;var _4c=this._node,_4d=this._layer;if(_4c){if(_4d&&_4d._div){_4d._setPos(_4c,_4.style(_4d._div,"left"),_4.style(_4d._div,"top"));_4d._div.appendChild(_4c);}esri.show(_4c);}}},hide:function(){if(this.visible){this.visible=false;var _4e=this._node,_4f=this._layer;if(_4e){esri.hide(_4e);_4f&&_4f._div&&_4f._div.removeChild(_4e);}}}});}}};});