/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */

if(!dojo._hasResource["esri.map"]){dojo._hasResource["esri.map"]=true;dojo.provide("esri.map");dojo.require("esri._coremap");if(esri.isTouchEnabled){dojo.require("esri.touchcontainer");}else{dojo.declare("esri._MapContainer",esri._CoreMap,(function(){var dc=dojo.connect,_1=dojo.disconnect,dh=dojo.hitch,_2=dojo.mixin,_3=dojo.isMozilla,_4=dojo.stopEvent,_5=dojo.fixEvent,_6=esri.geometry.Point;var _7=navigator.userAgent.indexOf("Macintosh")!==-1?1:3,_8=dojo.isChrome<2?360:120,_9=1,_a=2,_b=300,_c=300;return {constructor:function(_d){_2(this,{_dragEnd:false,_clickDuration:_c,_mouseWheelEvent:{},_downCoords:null,_clickTimer:null,_mouseWheelTimer:null,_onKeyDown_connect:null,_onKeyUp_connect:null,_onMouseDragHandler_connect:null});var _e=this.__container,_f=this._connects;_f.push(dc(_e,"onselectstart",function(evt){_4(evt);return false;}),dc(_e,"ondragstart",function(evt){_4(evt);return false;}));if(_3){dojo.style(_e,"MozUserSelect","none");}_f.push(dc(_e,"onmouseenter",this,"_onMouseEnterHandler"),dc(_e,"onmouseleave",this,"_onMouseLeaveHandler"),dc(_e,"onmousedown",this,"_onMouseDownHandler"),dc(_e,"onclick",this,"_onClickHandler"),dc(_e,"ondblclick",this,"_onDblClickHandler"),dc(_e,dojo.isFF||_3?"DOMMouseScroll":"onmousewheel",this,"_onMouseWheelHandler"));this._onMouseMoveHandler_connect=dc(_e,"onmousemove",this,"_onMouseMoveHandler");this._onMouseUpHandler_connect=dc(_e,"onmouseup",this,"_onMouseUpHandler");this._processEvent=dh(this,this._processEvent);this._fireClickEvent=dh(this,this._fireClickEvent);this._fireMouseWheel=dh(this,this._fireMouseWheel);},_cleanUp:function(){_1(this._onMouseMoveHandler_connect);_1(this._onMouseUpHandler_connect);_1(this._onMouseDragHandler_connect);var _10=this._connects,i;for(i=_10.length;i>=0;i--){_1(_10[i]);delete _10[i];}this.inherited("_cleanUp",arguments);},_processEvent:function(evt){evt=_5(evt,evt.target);if(evt.type==="DOMMouseScroll"&&dojo.isFF<3){evt.screenPoint=new _6(window.scrollX+evt.screenX-this.position.x,window.scrollY+evt.screenY-this.position.y);}else{evt.screenPoint=new _6(evt.pageX-this.position.x,evt.pageY-this.position.y);}evt.mapPoint=this.extent?this.toMap(evt.screenPoint):new _6();return evt;},_onMouseEnterHandler:function(evt){_1(this._onKeyDown_connect);_1(this._onKeyUp_connect);this._onKeyDown_connect=dc(document,"onkeydown",this,"_onKeyDownHandler");this._onKeyUp_connect=dc(document,"onkeyup",this,"_onKeyUpHandler");this.onMouseOver(this._processEvent(evt));},_onMouseLeaveHandler:function(evt){_1(this._onKeyDown_connect);_1(this._onKeyUp_connect);this.onMouseOut(this._processEvent(evt));},_onMouseMoveHandler:function(evt){if(this._dragEnd){this._dragEnd=false;return;}this.onMouseMove(this._processEvent(evt));},_onMouseDownHandler:function(evt){_1(this._onMouseMoveHandler_connect);var _11=this.__container;if(_11.setCapture){_11.setCapture(false);}this._onMouseDragHandler_connect=dc(document,"onmousemove",this,"_onMouseDragHandler");evt=this._processEvent(evt);this._downCoords=evt.screenPoint.x+","+evt.screenPoint.y;this.onMouseDown(evt);},_onMouseUpHandler:function(evt){var _12=this.__container;if(_12.releaseCapture){_12.releaseCapture();}evt=this._processEvent(evt);_1(this._onMouseDragHandler_connect);_1(this._onMouseMoveHandler_connect);this._onMouseMoveHandler_connect=dc(_12,"onmousemove",this,"_onMouseMoveHandler");this.onMouseUp(evt);},_onMouseDragHandler:function(evt){_1(this._onMouseDragHandler_connect);this._onMouseDragHandler_connect=dc(document,"onmousemove",this,"_onMouseDraggingHandler");_1(this._onMouseUpHandler_connect);this._onMouseUpHandler_connect=dc(document,"onmouseup",this,"_onDragMouseUpHandler");this._docLeaveConnect=dc(document,"onmouseout",this,"_onDocMouseOut");this.onMouseDragStart(this._processEvent(evt));},_onDocMouseOut:function(evt){var _13=evt.relatedTarget;if(!_13){this._onDragMouseUpHandler(evt);}},_onMouseDraggingHandler:function(evt){this.onMouseDrag(this._processEvent(evt));dojo.stopEvent(evt);},_onDragMouseUpHandler:function(evt){var _14=this.__container;if(_14.releaseCapture){_14.releaseCapture();}this._dragEnd=true;evt=this._processEvent(evt);this.onMouseDragEnd(evt);_1(this._docLeaveConnect);_1(this._onMouseDragHandler_connect);_1(this._onMouseUpHandler_connect);this._onMouseMoveHandler_connect=dc(_14,"onmousemove",this,"_onMouseMoveHandler");this._onMouseUpHandler_connect=dc(_14,"onmouseup",this,"_onMouseUpHandler");this.onMouseUp(evt);},_onClickHandler:function(evt){evt=this._processEvent(evt);if(this._downCoords!==(evt.screenPoint.x+","+evt.screenPoint.y)){return;}clearTimeout(this._clickTimer);this._clickEvent=_2({},evt);this._clickTimer=setTimeout(this._fireClickEvent,this._clickDuration);},_fireClickEvent:function(){clearTimeout(this._clickTimer);if(dojo.isIE<9){var GL=esri.layers.GraphicsLayer;this._clickEvent.graphic=GL._clicked;delete GL["_clicked"];}this.onClick(this._clickEvent);},_onDblClickHandler:function(evt){clearTimeout(this._clickTimer);this.onDblClick(this._processEvent(evt));},_onMouseWheelHandler:function(evt){clearTimeout(this._mouseWheelTimer);evt=this._processEvent(evt);var _15=dojo.isIE||dojo.isWebKit?evt.wheelDelta/_8:-evt.detail/_7,_16=Math.abs(_15);if(_16<=_9){_16=_9;}else{_16=_a;}evt.value=_15<0?-_16:_16;_2(this._mouseWheelEvent,evt);clearTimeout(this._mouseWheelTimer);this._mouseWheelTimer=setTimeout(this._fireMouseWheel,_b);if(this.__canStopSWEvt()){dojo.stopEvent(evt);}},__canStopSWEvt:function(){},_fireMouseWheel:function(){this.onMouseWheel(this._mouseWheelEvent);this._mouseWheelEvent={};this._mouseWheelTimer=null;},_onKeyDownHandler:function(evt){this.onKeyDown(evt);},_onKeyUpHandler:function(evt){this.onKeyUp(evt);},__setClickDuration:function(dur){this._clickDuration=dur;},__resetClickDuration:function(){this._clickDuration=_c;},onMouseOver:function(){},onMouseMove:function(){},onMouseOut:function(){},onMouseDown:function(){},onMouseDragStart:function(){},onMouseDrag:function(){},onMouseDragEnd:function(){},onMouseUp:function(){},onClick:function(){},onDblClick:function(){},onMouseWheel:function(){},onKeyDown:function(){},onKeyUp:function(){}};}()));}dojo.declare("esri.Map",esri._MapContainer,(function(){var _17=30,_18=30,_19=10,_1a=1,_1b=-1,_1c=dojo.mouseButtons.LEFT,_1d={up:"panUp",right:"panRight",down:"panDown",left:"panLeft"},_1e={upperRight:"panUpperRight",lowerRight:"panLowerRight",lowerLeft:"panLowerLeft",upperLeft:"panUpperLeft"};var dc=dojo.connect,ddc=dojo.disconnect,dcr=dojo.create,ds=dojo.style,dh=dojo.hitch,abs=Math.abs,_1f=dojo.coords,_20=dojo.deprecated,dk=dojo.keys,_21=dojo.mixin,_22=esri.geometry.Rect,_23=esri.geometry.Point,_24=esri.geometry.Extent;var _25=[dk.NUMPAD_PLUS,61,dk.NUMPAD_MINUS,dk.UP_ARROW,dk.NUMPAD_8,dk.RIGHT_ARROW,dk.NUMPAD_6,dk.DOWN_ARROW,dk.NUMPAD_2,dk.LEFT_ARROW,dk.NUMPAD_4,dk.PAGE_UP,dk.NUMPAD_9,dk.PAGE_DOWN,dk.NUMPAD_3,dk.END,dk.NUMPAD_1,dk.HOME,dk.NUMPAD_7];return {constructor:function(_26,_27){_21(this,{_dragOrigin:null,_slider:null,_navDiv:null,_zoomRect:null,_mapParams:_21({slider:true,nav:false,logo:true,sliderStyle:"default"},_27||{}),_sliderChangeAnchor:null,_zoom:0,_keyboardPanDx:0,_keyboardPanDy:0});_21(this,{_onLoadHandler_connect:null,_panHandler_connect:null,_panStartHandler_connect:null,_upPanHandler_connect:null,_dblClickZoomHandler_connect:null,_recenterZoomHandler_connect:null,_recenterHandler_connect:null,_downPanHandler_connect:null,_downZoomHandler_connect:null,_keyNavigatingHandler_connect:null,_keyNavigationEndHandler_connect:null,_scrollZoomHandler_connect:null,_zoomHandler_connect:null,_upZoomHandler_connect:null,_slider_connect:null,_slidermovestop_connect:null});_21(this,{isDoubleClickZoom:false,isShiftDoubleClickZoom:false,isClickRecenter:false,isScrollWheelZoom:false,isPan:false,isRubberBandZoom:false,isKeyboardNavigation:false,isPanArrows:false,isZoomSlider:false});this._zoomRect=new esri.Graphic(null,new esri.symbol.SimpleFillSymbol(esri.config.defaults.map.zoomSymbol));this.setMapCursor("default");this._normalizeRect=dh(this,this._normalizeRect);this._isPanningOrZooming=dh(this,this._isPanningOrZooming);this._canZoom=dh(this,this._canZoom);this._onLoadHandler_connect=dc(this,"onLoad",this,"_onLoadInitNavsHandler");if(this._mapParams.logo){var _28={right:(this._mapParams.nav?"25px":"")};if(dojo.isIE===6){_28["filter"]="progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled='true', sizingMethod='crop', src='"+dojo.moduleUrl("esri","../../images/map/logo-med.png")+"')";}var _29=this._ogol=dcr("div",{style:_28},this.root);if((this.root.clientWidth*this.root.clientHeight)<250000){dojo.addClass(_29,"logo-sm");}else{dojo.addClass(_29,"logo-med");}if(!esri.isTouchEnabled){this._ogol_connect=dc(_29,"onclick",this,"_openLogoLink");}}if(esri.isTouchEnabled){this._panInitEvent="onTouchStart";this._zoomInitEvent="onGestureStart";}else{this._panInitEvent="onMouseDown";this._zoomInitEvent="onMouseDown";}},_cleanUp:function(){this.disableMapNavigation();var i;for(i=this._connects.length;i>=0;i--){ddc(this._connects[i]);delete this._connects[i];}ddc(this._slider_connect);ddc(this._ogol_connect);var _2a=this._slider;if(_2a&&_2a.destroy){_2a.destroy();}var _2b=this._navDiv;if(_2b){dojo.destroy(_2b);}this.inherited("_cleanUp",arguments);},_normalizeRect:function(evt){var xy=evt.screenPoint,dx=this._dragOrigin.x,dy=this._dragOrigin.y,_2c=new _22((xy.x<dx?xy.x:dx)-this.__visibleRect.x,(xy.y<dy?xy.y:dy)-this.__visibleRect.y,abs(xy.x-dx),abs(xy.y-dy));if(_2c.width===0){_2c.width=1;}if(_2c.height===0){_2c.height=1;}return _2c;},_downZoomHandler:function(evt){if(evt.button==_1c&&evt.shiftKey&&this.isRubberBandZoom){this._dragOrigin=_21({},evt.screenPoint);this.setCursor("crosshair");this._zoomHandler_connect=dc(this,"onMouseDrag",this,"_zoomHandler");this._upZoomHandler_connect=dc(this,"onMouseUp",this,"_upZoomHandler");if(evt.ctrlKey){this._zoom=_1b;}else{this._zoom=_1a;}}},_zoomHandler:function(evt){var _2d=this._normalizeRect(evt).offset(this.__visibleRect.x,this.__visibleRect.y),g=this.graphics,_2e=this._zoomRect;if(!_2e.geometry){this.setCursor("crosshair");}if(_2e.geometry){g.remove(_2e,true);}var tl=this.toMap(new _23(_2d.x,_2d.y)),br=this.toMap(new _23(_2d.x+_2d.width,_2d.y+_2d.height));_2d=new _22(tl.x,tl.y,br.x-tl.x,tl.y-br.y);_2d._originOnly=true;_2e.setGeometry(_2d);g.add(_2e,true);},_upZoomHandler:function(evt){var _2f=this._zoomRect;ddc(this._zoomHandler_connect);ddc(this._upZoomHandler_connect);if(this._canZoom(this._zoom)&&_2f.getDojoShape()){this.graphics.remove(_2f);_2f.geometry=null;var _30=this._normalizeRect(evt);_30.x+=this.__visibleRect.x;_30.y+=this.__visibleRect.y;var _31;if(this._zoom===_1b){var _32=this.extent.getWidth(),_33=(_32*this.width)/_30.width,_34=(_33-_32)/2,ext=this.extent;_31=new _24(ext.xmin-_34,ext.ymin-_34,ext.xmax+_34,ext.ymax+_34,this.spatialReference);}else{var min=this.toMap({x:_30.x,y:(_30.y+_30.height)}),max=this.toMap({x:(_30.x+_30.width),y:_30.y});_31=new _24(min.x,min.y,max.x,max.y,this.spatialReference);}this.__setExtent(_31);}if(_2f.getDojoShape()){this.graphics.remove(_2f,true);}this._zoom=0;this.resetMapCursor();},_downPanHandler:function(evt){if(evt.button==_1c&&!evt.shiftKey&&this.isPan){this._dragOrigin=new _23(0,0);_21(this._dragOrigin,evt.screenPoint);this._panHandler_connect=dc(this,"onMouseDrag",this,"_panHandler");this._panStartHandler_connect=dc(this,"onMouseDragStart",this,"_panStartHandler");this._upPanHandler_connect=dc(this,"onMouseUp",this,"_upPanHandler");}},_panStartHandler:function(evt){this.setCursor("move");this.__panStart(evt.screenPoint.x,evt.screenPoint.y);},_panHandler:function(evt){this.__pan(evt.screenPoint.x-this._dragOrigin.x,evt.screenPoint.y-this._dragOrigin.y);},_upPanHandler:function(evt){ddc(this._panHandler_connect);ddc(this._panStartHandler_connect);ddc(this._upPanHandler_connect);if(this.__panning){this.__panEnd(evt.screenPoint.x-this._dragOrigin.x,evt.screenPoint.y-this._dragOrigin.y);this.resetMapCursor();}},_isPanningOrZooming:function(){return this.__panning||this.__zooming;},_recenterHandler:function(evt){if(evt.shiftKey&&!this._isPanningOrZooming()){this.centerAt(evt.mapPoint);}},_recenterZoomHandler:function(evt){if(evt.shiftKey&&!this._isPanningOrZooming()){evt.value=evt.ctrlKey?-1:1;this._scrollZoomHandler(evt);}},_dblClickZoomHandler:function(evt){if(!this._isPanningOrZooming()){evt.value=1;this._scrollZoomHandler(evt);}},_canZoom:function(_35){if(!this.__tileInfo){return true;}var _36=this.getLevel(),_37=this.getNumLevels();if((_36===0&&_35<0)||(_36===_37-1&&_35>0)){return false;}return true;},_scrollZoomHandler:function(evt){if(!this._canZoom(evt.value)){return;}var _38=this.extent,_39;if(this.__tileInfo){_39=this.__getExtentForLevel(this.getLevel()+evt.value).extent;}else{_39=_38.expand(evt.value>0?0.5*evt.value:2*-evt.value);}var _3a=evt.mapPoint,_3b=_38.xmin-((_39.getWidth()-_38.getWidth())*(_3a.x-_38.xmin)/_38.getWidth()),_3c=_38.ymax-((_39.getHeight()-_38.getHeight())*(_3a.y-_38.ymax)/_38.getHeight());this.__setExtent(new _24(_3b,_3c-_39.getHeight(),_3b+_39.getWidth(),_3c,this.spatialReference),null,evt.screenPoint);},_keyNavigatingHandler:function(evt){var kc=evt.keyCode;if(dojo.indexOf(_25,kc)!==-1){var ti=this.__tileInfo;if(kc===dk.NUMPAD_PLUS||kc===61){if(ti){this.setLevel(this.getLevel()+1);}else{this.__setExtent(this.extent.expand(0.5));}}else{if(kc===dk.NUMPAD_MINUS){if(ti){this.setLevel(this.getLevel()-1);}else{this.__setExtent(this.extent.expand(2));}}else{if(!this.__panning){this.__panStart(0,0);}switch(kc){case dk.UP_ARROW:case dk.NUMPAD_8:this._keyboardPanDy+=_19;break;case dk.RIGHT_ARROW:case dk.NUMPAD_6:this._keyboardPanDx-=_19;break;case dk.DOWN_ARROW:case dk.NUMPAD_2:this._keyboardPanDy-=_19;break;case dk.LEFT_ARROW:case dk.NUMPAD_4:this._keyboardPanDx+=_19;break;case dk.PAGE_UP:case dk.NUMPAD_9:this._keyboardPanDx-=_19;this._keyboardPanDy+=_19;break;case dk.PAGE_DOWN:case dk.NUMPAD_3:this._keyboardPanDx-=_19;this._keyboardPanDy-=_19;break;case dk.END:case dk.NUMPAD_1:this._keyboardPanDx+=_19;this._keyboardPanDy-=_19;break;case dk.HOME:case dk.NUMPAD_7:this._keyboardPanDx+=_19;this._keyboardPanDy+=_19;break;default:return;}this.__pan(this._keyboardPanDx,this._keyboardPanDy);}}dojo.stopEvent(evt);}},_keyNavigationEndHandler:function(evt){if(this.__panning){this.__panEnd(this._keyboardPanDx,this._keyboardPanDy);this._keyboardPanDx=this._keyboardPanDy=0;}},_onLoadInitNavsHandler:function(){this.enableMapNavigation();this._createNav();if(this._mapParams.sliderStyle==="small"||!this._createSlider){this._createSimpleSlider();}else{this._createSlider();}ddc(this._onLoadHandler_connect);},_createNav:function(){if(this._mapParams.nav){var div,v,i,_3d=dojo.addClass,id=this.id;this._navDiv=dcr("div",{id:id+"_navdiv"},this.root);_3d(this._navDiv,"navDiv");var w2=this.width/2,h2=this.height/2,wh;for(i in _1d){v=_1d[i];div=dcr("div",{id:id+"_pan_"+i},this._navDiv);_3d(div,"fixedPan "+v);if(i==="up"||i==="down"){wh=parseInt(_1f(div).w,10)/2;ds(div,{left:(w2-wh)+"px",zIndex:_17});}else{wh=parseInt(_1f(div).h,10)/2;ds(div,{top:(h2-wh)+"px",zIndex:_17});}this._connects.push(dc(div,"onclick",dh(this,this[v])));}this._onMapResizeNavHandler_connect=dc(this,"onResize",this,"_onMapResizeNavHandler");for(i in _1e){v=_1e[i];div=dcr("div",{id:id+"_pan_"+i,style:{zIndex:_17}},this._navDiv);_3d(div,"fixedPan "+v);this._connects.push(dc(div,"onclick",dh(this,this[v])));}this.isPanArrows=true;}},_onMapResizeNavHandler:function(_3e,wd,ht){var id=this.id,w2=wd/2,h2=ht/2,_3f=dojo.byId,i,div,wh;for(i in _1d){div=_3f(id+"_pan_"+i);if(i==="up"||i==="down"){wh=parseInt(_1f(div).w,10)/2;ds(div,"left",(w2-wh)+"px");}else{wh=parseInt(_1f(div).h,10)/2;ds(div,"top",(h2-wh)+"px");}}},_createSimpleSlider:function(){if(this._mapParams.slider){var _40=(this._slider=dcr("div",{id:this.id+"_zoom_slider","class":"esriSimpleSlider",style:"z-index: "+_18+";"}));dojo.addClass(_40,esri.config.defaults.map.slider.width?"esriSimpleSliderHorizontal":"esriSimpleSliderVertical");var _41=dcr("div",{"class":"esriSimpleSliderIncrementButton"},_40);_41.innerHTML="+";var _42=dcr("div",{"class":"esriSimpleSliderDecrementButton"},_40);_42.innerHTML="-";if(dojo.isIE<8){dojo.addClass(_42,"dj_ie67Fix");}this._connects.push(dc(_41,"onclick",this,this._simpleSliderChangeHandler));this._connects.push(dc(_42,"onclick",this,this._simpleSliderChangeHandler));this.root.appendChild(_40);this.isZoomSlider=true;}},_simpleSliderChangeHandler:function(evt){var _43=(evt.currentTarget.className.indexOf("IncrementButton")!==-1)?true:false;var _44=this.getLevel();if(_44!==-1){var _45=_43?(_44+1):(_44-1);this.setLevel(_45);}else{var _46=_43?0.5:2;this.__setExtent(this.extent.expand(_46));}},_openLogoLink:function(evt){window.open(esri.config.defaults.map.logoLink,"_blank");dojo.stopEvent(evt);},enableMapNavigation:function(){this.enableDoubleClickZoom();this.enableClickRecenter();this.enablePan();this.enableRubberBandZoom();this.enableKeyboardNavigation();this.enableScrollWheelZoom();},disableMapNavigation:function(){this.disableDoubleClickZoom();this.disableClickRecenter();this.disablePan();this.disableRubberBandZoom();this.disableKeyboardNavigation();this.disableScrollWheelZoom();},enableDoubleClickZoom:function(){if(!this.isDoubleClickZoom){this._dblClickZoomHandler_connect=dc(this,"onDblClick",this,"_dblClickZoomHandler");this.isDoubleClickZoom=true;}},disableDoubleClickZoom:function(){if(this.isDoubleClickZoom){ddc(this._dblClickZoomHandler_connect);this.isDoubleClickZoom=false;}},enableShiftDoubleClickZoom:function(){if(!this.isShiftDoubleClickZoom){_20(this.declaredClass+": "+esri.bundle.map.deprecateShiftDblClickZoom,null,"v2.0");this._recenterZoomHandler_connect=dc(this,"onDblClick",this,"_recenterZoomHandler");this.isShiftDoubleClickZoom=true;}},disableShiftDoubleClickZoom:function(){if(this.isShiftDoubleClickZoom){_20(this.declaredClass+": "+esri.bundle.map.deprecateShiftDblClickZoom,null,"v2.0");ddc(this._recenterZoomHandler_connect);this.isShiftDoubleClickZoom=false;}},enableClickRecenter:function(){if(!this.isClickRecenter){this._recenterHandler_connect=dc(this,"onClick",this,"_recenterHandler");this.isClickRecenter=true;}},disableClickRecenter:function(){if(this.isClickRecenter){ddc(this._recenterHandler_connect);this.isClickRecenter=false;}},enablePan:function(){if(!this.isPan){this._downPanHandler_connect=dc(this,this._panInitEvent,this,"_downPanHandler");this.isPan=true;}},disablePan:function(){if(this.isPan){ddc(this._downPanHandler_connect);this.isPan=false;}},enableRubberBandZoom:function(){if(!this.isRubberBandZoom){this._downZoomHandler_connect=dc(this,this._zoomInitEvent,this,"_downZoomHandler");this.isRubberBandZoom=true;}},disableRubberBandZoom:function(){if(this.isRubberBandZoom){ddc(this._downZoomHandler_connect);this.isRubberBandZoom=false;}},enableKeyboardNavigation:function(){if(!this.isKeyboardNavigation){this._keyNavigatingHandler_connect=dc(this,"onKeyDown",this,"_keyNavigatingHandler");this._keyNavigationEndHandler_connect=dc(this,"onKeyUp",this,"_keyNavigationEndHandler");this.isKeyboardNavigation=true;}},disableKeyboardNavigation:function(){if(this.isKeyboardNavigation){ddc(this._keyNavigatingHandler_connect);ddc(this._keyNavigationEndHandler_connect);this.isKeyboardNavigation=false;}},enableScrollWheelZoom:function(){if(!this.isScrollWheelZoom){this._scrollZoomHandler_connect=dc(this,"onMouseWheel",this,"_scrollZoomHandler");this.isScrollWheelZoom=true;}},__canStopSWEvt:function(){return this.isScrollWheelZoom;},disableScrollWheelZoom:function(){if(this.isScrollWheelZoom){ddc(this._scrollZoomHandler_connect);this.isScrollWheelZoom=false;}},showPanArrows:function(){if(this._navDiv){esri.show(this._navDiv);this.isPanArrows=true;}},hidePanArrows:function(){if(this._navDiv){esri.hide(this._navDiv);this.isPanArrows=false;}},showZoomSlider:function(){if(this._slider){ds(this._slider.domNode||this._slider,"visibility","visible");this.isZoomSlider=true;}},hideZoomSlider:function(){if(this._slider){ds(this._slider.domNode||this._slider,"visibility","hidden");this.isZoomSlider=false;}}};}()));dojo.require("esri.layers.agsdynamic");dojo.require("esri.layers.agstiled");if(esri.isTouchEnabled){dojo.extend(esri.Map,(function(){var dc=dojo.connect,ddc=dojo.disconnect,_47=esri.geometry.Point,_48=esri.geometry.getLength,_49=esri.TileUtils.getCandidateTileInfo;return {_multiTouchTapZoomHandler:function(evt){if(!this._isPanningOrZooming()){evt.value=-1;this._scrollZoomHandler(evt);}},_downPanHandler:function(evt){this._dragOrigin=new _47(0,0);dojo.mixin(this._dragOrigin,evt.screenPoint);this._panHandler_connect=dc(this,"onTouchMove",this,this._panHandler);this._upPanHandler_connect=dc(this,"onTouchEnd",this,this._upPanHandler);},_panHandler:function(evt){if(this.__panning){this.__pan(evt.screenPoint.x-this._dragOrigin.x,evt.screenPoint.y-this._dragOrigin.y);}else{this.setCursor("move");this.__panStart(evt.screenPoint.x,evt.screenPoint.y);}evt.preventDefault();},_upPanHandler:function(evt){ddc(this._panHandler_connect);ddc(this._upPanHandler_connect);if(this.__panning){this.__panEnd(evt.screenPoint.x-this._dragOrigin.x,evt.screenPoint.y-this._dragOrigin.y);this.resetMapCursor();}},_downZoomHandler:function(evt){this._zoomHandler_connect=dc(this,"onGestureChange",this,this._zoomHandler);this._upZoomHandler_connect=dc(this,"onGestureEnd",this,this._upZoomHandler);},_zoomHandler:function(evt){if(evt.screenPoints){this.currLength=_48(evt.screenPoints[0],evt.screenPoints[1]);if(this.__zooming){var _4a=this.currLength/this._length;this._zoomStartExtent=this.__scaleExtent(this.extent,_4a,this._dragOrigin);this.__zoom(this._zoomStartExtent,_4a,this._dragOrigin);}else{this._dragOrigin=new _47((evt.screenPoints[0].x+evt.screenPoints[1].x)/2,(evt.screenPoints[0].y+evt.screenPoints[1].y)/2);this._length=this.currLength;this.__zoomStart(this.extent,this._dragOrigin);}evt.preventDefault();}},_upZoomHandler:function(evt){ddc(this._zoomHandler_connect);ddc(this._upZoomHandler_connect);if(evt.processMultiTouchTap){this._multiTouchTapZoomHandler(evt);evt.preventDefault();}else{if(this.__zooming&&this._zoomAnim===null){var _4b=this.currLength/this._length,_4c=this.extent.getWidth();this._zoomAnimAnchor=this.toMap(this._dragOrigin);this._zoomStartExtent=this.__scaleExtent(this.extent,1/_4b,this._zoomAnimAnchor);if(this.__tileInfo){var ct=_49(this,this.__tileInfo,this._zoomStartExtent),_4d=this.__getExtentForLevel(ct.lod.level,this._zoomAnimAnchor);this._zoomEndExtent=_4d.extent;this._zoomEndLod=_4d.lod;this._zoomAnim=esri.fx.animateRange({range:{start:(_4c/this._zoomStartExtent.getWidth()),end:(_4c/this._zoomEndExtent.getWidth())},duration:200,rate:50,onAnimate:dojo.hitch(this,"_adjustZoomHandler"),onEnd:dojo.hitch(this,"_adjustZoomEndHandler")}).play();}else{this._zoomEndExtent=this._zoomStartExtent;this._adjustZoomEndHandler();}}}},_adjustZoomHandler:function(_4e){var _4f=this.__scaleExtent(this.extent,_4e,this._zoomAnimAnchor);this.__zoom(_4f,_4e,this._dragOrigin);},_adjustZoomEndHandler:function(){var _50=this.extent.getWidth()/this._zoomEndExtent.getWidth(),_51=this.__scaleExtent(this.extent,1/_50,this._zoomAnimAnchor);this.__zoomEnd(_51,_50,this._dragOrigin,this._zoomEndLod,this.__LOD?(this.__LOD.level!=this._zoomEndLod.level):true);this._zoomStartExtent=this._zoomEndExtent=this._zoomEndLod=this._dragOrigin=this._zoomAnim=this._zoomAnimAnchor=null;}};}()));}}