/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */

window[esri._dojoScopeName||"dojo"]._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","esri._coremap"],["require","dijit._base.manager"],["require","esri.geometry"],["require","esri.utils"],["require","esri.fx"],["require","esri.layers.graphics"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["esri._coremap"]){_4._hasResource["esri._coremap"]=true;_4.provide("esri._coremap");_4.require("dijit._base.manager");_4.require("esri.geometry");_4.require("esri.utils");_4.require("esri.fx");_4.require("esri.layers.graphics");_4.declare("esri._CoreMap",null,(function(){var _7=esri.geometry.toMapPoint,_8=esri.geometry.toScreenPoint,dc=_4.connect,_9=_4.disconnect,dh=_4.hitch,ds=_4.style,_a=_4.indexOf,_b=_4.mixin,_c=esri.geometry.Point,_d=esri.geometry.Extent,_e=esri.layers.GraphicsLayer,_f=esri.geometry.Rect,uid=0,_10=esri.config.defaults.map;var _11=1000000,_12=0.75,_13=0.25,_14=3,_15=20,_16=40;function _17(_18,_19){var _1a=_18.lods;_1a.sort(function(l1,l2){if(l1.scale>l2.scale){return -1;}else{if(l1.scale<l2.scale){return 1;}}return 0;});var _1b=[];_1a=_4.filter(_1a,function(l){if(_a(_1b,l.scale)===-1){_1b.push(l.scale);return true;}});var pl=(_19.lods=[]),l;_4.forEach(_1a,function(lod,_1c){l=(pl[_1c]=new esri.layers.LOD(lod));l.level=_1c;});_19.tileInfo=new esri.layers.TileInfo(_b(_18,{lods:pl}));};return {constructor:function(_1d,_1e){_b(this,{_internalLayerIds:[],_layers:[],_layerDivs:[],_layerSize:0,_clickHandles:[],_connects:[]});_b(this,{_zoomAnimDiv:null,_zoomAnim:null,_layersDiv:null,_firstLayerId:null,_delta:null,_gc:null,_cursor:null,_ratioW:1,_ratioH:1,_params:null});_b(this,{cursor:null,layerIds:[],graphicsLayerIds:[],graphics:null,loaded:false});_b(this,{__panning:false,__zooming:false,__container:null,root:null,__LOD:null,__tileInfo:null,__visibleRect:null,__visibleDelta:null});var _1f=(this.container=_4.byId(_1d));var id=(this.id=_4.attr(_1f,"id")||_5.getUniqueId(this.declaredClass));_4.addClass(_1f,"map");var box=_4.contentBox(_1f),dac=_4.addClass,dcr=_4.create;this.position=new _c(0,0);this._reposition();var _20=(this.width=(box.w||_10.width));var _21=(this.height=box.h||_10.height);if(box.w===0){ds(_1f,"width",_20+"px");}if(box.h===0){ds(_1f,"height",_21+"px");}var _22=(this.root=dcr("div",{id:_1d+"_root",style:{width:_20+"px",height:_21+"px"}}));dac(_22,"container");var _23=(this.__container=dcr("div",{id:_1d+"_container"},_22));ds(_23,"position","absolute");dac(_23,"container");_1f.appendChild(_22);var _24=(this._params=_b({slider:true,nav:false,extent:null,layer:null,scales:null,showInfoWindowOnClick:true,displayGraphicsOnPan:true,lods:null,tileInfo:null,wrapAround180:false,fitExtent:false},_1e||{}));this.wrapAround180=_24.wrapAround180;if(_24.lods){_17({rows:512,cols:512,dpi:96,format:"JPEG",compressionQuality:75,origin:{x:-180,y:90},spatialReference:{wkid:4326},lods:_24.lods},_24);this.__tileInfo=_24.tileInfo;}var ext=(this.extent=_24.extent);this.spatialReference=(ext&&ext.spatialReference)?ext.spatialReference:null;this.__visibleRect=new _f(0,0,_20,_21);this.__visibleDelta=new _f(0,0,_20,_21);var _25=(this._layersDiv=dcr("div",{id:id+"_layers"}));dac(_25,"layersDiv");_23.appendChild(_25);this._zoomAnimDiv=dcr("div",{style:{position:"absolute"}});if(_24.infoWindow){this.infoWindow=_24.infoWindow;}else{var iw=(this.infoWindow=new esri.dijit.InfoWindow({map:this,title:"",id:id+"_infowindow"},dcr("div",null,_22)));iw.startup();iw._ootb=true;ds(iw.domNode,"zIndex",_16);}this._zoomStartHandler=dh(this,this._zoomStartHandler);this._zoomingHandler=dh(this,this._zoomingHandler);this._zoomEndHandler=dh(this,this._zoomEndHandler);this._panningHandler=dh(this,this._panningHandler);this._panEndHandler=dh(this,this._panEndHandler);this._fixedPan=dh(this,this._fixedPan);_4.addOnWindowUnload(this,this.destroy);},_cleanUp:function(){var iw=this.infoWindow;if(iw){if(iw._ootb){iw.destroy();}else{iw.unsetMap(this);}delete this.infoWindow;}var _26=this._connects,i;for(i=_26.length-1;i>=0;i--){_9(_26[i]);delete _26[i];}_9(this._tsTimeExtentChange_connect);this.setInfoWindowOnClick(false);_4.destroy(this.root);this.root=null;},_addLayer:function(_27,_28,_29){var id=(_27.id=_27.id||(_27 instanceof _e?_10.graphicsLayerNamePrefix:_10.layerNamePrefix)+(uid++));this._layers[id]=_27;var i;if(_28===this.layerIds||_28===this.graphicsLayerIds){i=this._layerSize;this._layerSize++;}_29=(_29===undefined||_29<0||_29>_28.length)?_28.length:_29;if(i===0){this._firstLayerId=id;}_28.splice(_29,0,id);var _2a=dh(this,this._addLayerHandler),_2b=this,_2c=this._connects,_2d=function(){if(_27.loaded){_2a(_27);}else{_2b[id+"_addtoken_load"]=dc(_27,"onLoad",_2b,"_addLayerHandler");_2b[id+"_addtoken_err"]=dc(_27,"onError",_2b,function(_2e){_2a(_27,_2e,_28);});}};if(this.loaded||i===0||(_27.loaded&&_a(this.graphicsLayerIds,id)===-1)){_2d();}else{_2c.push(dc(this,"onLoad",_2d));}return _27;},_addLayerHandler:function(_2f,_30,_31){var id=this.id,_32=_2f.id,_33=_a(_2f instanceof _e?this.graphicsLayerIds:this.layerIds,_32),_34=_33,_35=false,_36=this._params;_9(this[_32+"_addtoken_load"]);_9(this[_32+"_addtoken_err"]);if(_30){delete this._layers[_32];if(_33!==-1){_31.splice(_33,1);this.onLayerAddResult(_2f,_30);}return;}if(_33===-1){_33=_a(this._internalLayerIds,_32);_34=_15+_33;_35=true;}if(_2f instanceof _e){var _37=_2f._setMap(this,this._gc._surface);_37.id=id+"_"+_32;this._layerDivs[_32]=_37;this._reorderLayers(this.graphicsLayerIds);if(_36.showInfoWindowOnClick){this._clickHandles.push(dc(_2f,"onClick",this,"_gClickHandler"));}}else{var _38=_2f._setMap(this,this._layersDiv,_34,this.__LOD);_38.id=id+"_"+_32;this._layerDivs[_32]=_38;this._reorderLayers(this.layerIds);if(!_35&&_2f.declaredClass.indexOf("VETiledLayer")!==-1){this._onBingLayerAdd(_2f);}}if(_32===this._firstLayerId){this.spatialReference=this.spatialReference||_2f.spatialReference;var _39=this.spatialReference;this.wrapAround180=(this.wrapAround180&&_39&&_39._isWrappable())?true:false;if(_2f.tileInfo){if(!this.__tileInfo){_17(_b({},_2f.tileInfo),_36);this.__tileInfo=_36.tileInfo;}else{var _3a=this.__tileInfo.lods;this.__tileInfo=_b({},_2f.tileInfo);this.__tileInfo.lods=_3a;}}if(this.wrapAround180){var _3b=this.__tileInfo,_3c=_39._getInfo();if(!_3b||Math.abs(_3c.origin[0]-_3b.origin.x)>_3c.dx){this.wrapAround180=false;}if(this.wrapAround180&&_3b){esri.TileUtils._addFrameInfo(_3b,_3c);}}_36.units=_2f.units;this._gc=new esri.layers._GraphicsContainer();var gc=this._gc._setMap(this,this._layersDiv);gc.id=id+"_gc";this.graphics=new _e({id:id+"_graphics",displayOnPan:_36.displayGraphicsOnPan});this._addLayer(this.graphics,this._internalLayerIds,_15);}if(_2f===this.graphics){if(this.extent){var x=this._fixExtent(this.extent,_36.fitExtent);this.extent=x.extent;this.__LOD=x.lod;}var fli=this._firstLayerId;this._firstLayerId=null;this.__setExtent(this.extent?this.extent:new _d(this._layers[fli].initialExtent),null,null,_36.fitExtent);this.loaded=true;this.infoWindow.setMap(this);this.onLoad(this);}if(!_35){this.onLayerAdd(_2f);this.onLayerAddResult(_2f);}_9(this[_32+"_addLayerHandler_connect"]);},_reorderLayers:function(_3d){var _3e=this.onLayerReorder,djp=_4.place,_3f=this._layerDivs,_40=this._layers,_41=this._gc?this._gc._surface.getEventSource():null;if(_3d===this.graphicsLayerIds){_4.forEach(_3d,function(id,i){var _42=_3f[id];if(_42){djp(_42.getEventSource(),_41,i);_3e(_40[id],i);}});}else{var g=this.graphics,gId=g?g.id:null,_43=this._layersDiv,_44;_4.forEach(_3d,function(id,i){_44=_3f[id];if(id!==gId&&_44){djp(_44,_43,i);_3e(_40[id],i);}});if(_41){_41=esri.vml?_41.parentNode:_41;djp(_41,_41.parentNode,_3d.length);}}this.onLayersReordered([].concat(_3d));},_zoomStartHandler:function(){this.__zoomStart(this._zoomAnimDiv.startingExtent,this._zoomAnimDiv.anchor);},_zoomingHandler:function(_45){var rl=parseFloat(_45.left),rt=parseFloat(_45.top),_46=new _d(rl,rt-parseFloat(_45.height),rl+parseFloat(_45.width),rt,this.spatialReference),_47=this.extent.getWidth()/_46.getWidth();this.__zoom(_46,_47,this._zoomAnimDiv.anchor);},_zoomEndHandler:function(){var _48=this._zoomAnimDiv,_49=_48.extent,_4a=this.extent.getWidth()/_49.getWidth();var _4b=_48.anchor,_4c=_48.newLod,_4d=_48.levelChange;_48.extent=_48.anchor=_48.levelChange=_48.startingExtent=_48.newLod=this._delta=this._zoomAnim=null;this.__zoomEnd(_49,_4a,_4b,_4c,_4d);},_panningHandler:function(_4e){var d=new _c(parseFloat(_4e.left),parseFloat(_4e.top)),dm=this.toMap(d);this.onPan(this.extent.offset(dm.x,dm.y),d);},_panEndHandler:function(){this.__panning=false;var _4f=Math.round,_50=this._delta.offset(-_4f(this.width/2),-_4f(this.height/2)),dx=_50.x,dy=_50.y,_51=this.__visibleRect,_52=this.__visibleDelta;_51.x+=-dx;_51.y+=-dy;_52.x+=-dx;_52.y+=-dy;ds(this._zoomAnimDiv,{left:"0px",top:"0px"});var _53=this.extent,rw=this._ratioW,rh=this._ratioH;_53=(this.extent=new _d(_53.xmin+(dx/rw),_53.ymin-(dy/rh),_53.xmax+(dx/rw),_53.ymax-(dy/rh),this.spatialReference));_50.setX(-_50.x);_50.setY(-_50.y);this._delta=null;this.onPanEnd(_53,_50);this.onExtentChange(_53,_50,false,this.__LOD);},_fixExtent:function(_54,fit){var _55=this._reshapeExtent(_54),_56=1+_13;while(fit===true&&(_55.extent.getWidth()<_54.getWidth()||_55.extent.getHeight()<_54.getHeight())&&_55.lod.level>0&&_56<=_14){_55=this._reshapeExtent(_54.expand(_56));_56+=_13;}return _55;},_getFrameWidth:function(){var _57=-1,_58=this.spatialReference._getInfo();if(this.__LOD){var _59=this.__LOD._frameInfo;if(_59){_57=_59[3];}}else{if(_58){_57=Math.round((2*_58.valid[1])/(this.extent.getWidth()/this.width));}}return _57;},_reshapeExtent:function(_5a){var w=_5a.getWidth(),h=_5a.getHeight(),r=w/h,_5b=this.width/this.height,dw=0,dh=0;if(this.width>this.height){if(w>h){if(_5b>r){dw=(h*_5b)-w;}else{dh=(w/_5b)-h;}}else{if(w<h){dw=(h*_5b)-w;}else{dw=(h*_5b)-w;}}}else{if(this.width<this.height){if(w>h){dh=(w/_5b)-h;}else{if(w<h){if(_5b>r){dw=(h*_5b)-w;}else{dh=(w/_5b)-h;}}else{dh=(w/_5b)-h;}}}else{if(w<h){dw=h-w;}else{if(w>h){dh=(w/_5b)-h;}}}}if(dw){_5a.xmin-=dw/2;_5a.xmax+=dw/2;}if(dh){_5a.ymin-=dh/2;_5a.ymax+=dh/2;}return this._getAdjustedExtent(_5a);},_getAdjustedExtent:function(_5c){if(this.__tileInfo){return esri.TileUtils.getCandidateTileInfo(this,this.__tileInfo,_5c);}else{return {extent:_5c};}},_panTo:function(_5d){var ewd=this.extent.getWidth(),eht=this.extent.getHeight(),_5e=_5d.x-(ewd/2),_5f=_5e+ewd,_60=_5d.y-(eht/2),_61=_60+eht;this.__setExtent(new _d(_5e,_60,_5f,_61));},_fixedPan:function(dx,dy){this._panTo(this.toMap(new _c((this.width/2)+dx,(this.height/2)+dy)));},_gClickHandler:function(evt){var _62=evt.graphic,iw=this.infoWindow;if(_62._getEffInfoTemplate()&&iw){_4.stopEvent(evt);var _63=_62.geometry,_64=(_63&&_63.type==="point")?_63:evt.mapPoint;iw.setTitle(_62.getTitle());iw.setContent(_62.getContent());iw.show(_64);}},_onBingLayerAdd:function(_65){this["__"+_65.id+"_vis_connect"]=_4.connect(_65,"onVisibilityChange",this,"_toggleBingLogo");this._toggleBingLogo(_65.visible);},_onBingLayerRemove:function(_66){_4.disconnect(this["__"+_66.id+"_vis_connect"]);delete this["__"+_66.id+"_vis_connect"];var _67=this.layerIds;var _68=_4.some(_67,function(_69){var _6a=this._layers[_69];return _6a&&_6a.visible&&_6a.declaredClass.indexOf("VETiledLayer")!==-1;},this);this._toggleBingLogo(_68);},_toggleBingLogo:function(_6b){if(_6b&&!this._bingLogo){var _6c={left:(this._mapParams&&this._mapParams.nav?"25px":"")};if(_4.isIE===6){_6c.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled='true', sizingMethod='crop', src='"+_4.moduleUrl("esri","../../images/map/logo-med.png")+"')";}var _6d=this._bingLogo=_4.create("div",{style:_6c},this.root);_4.addClass(_6d,"bingLogo-lg");}else{if(!_6b&&this._bingLogo){_4.destroy(this._bingLogo);delete this._bingLogo;}}},__panStart:function(x,y){this.__panning=true;this.onPanStart(this.extent,new _c(x,y));},__pan:function(dx,dy){var _6e=this.extent,rw=this._ratioW,rh=this._ratioH;this.onPan(new _d(_6e.xmin-(dx/rw),_6e.ymin+(dy/rh),_6e.xmax-(dx/rw),_6e.ymax+(dy/rh),this.spatialReference),new _c(dx,dy));},__panEnd:function(dx,dy){var _6f=this.__visibleRect,_70=this.__visibleDelta;_6f.x+=dx;_6f.y+=dy;_70.x+=dx;_70.y+=dy;var d=new _c(dx,dy),_71=this.extent,rw=this._ratioW,rh=this._ratioH;_71=(this.extent=new _d(_71.xmin-(dx/rw),_71.ymin+(dy/rh),_71.xmax-(dx/rw),_71.ymax+(dy/rh),this.spatialReference));this.__panning=false;this.onPanEnd(_71,d);this.onExtentChange(_71,d,false,this.__LOD);},__zoomStart:function(_72,_73){this.__zooming=true;this.onZoomStart(_72,1,_73,this.__LOD?this.__LOD.level:null);},__zoom:function(_74,_75,_76){this.onZoom(_74,_75,_76);},__zoomEnd:function(_77,_78,_79,lod,_7a){ds(this._layersDiv,{left:"0px",top:"0px"});this._delta=new _c(0,0);this.__visibleRect.x=(this.__visibleRect.y=0);_77=(this.extent=new _d(_77));this.__LOD=lod;this._ratioW=this.width/_77.getWidth();this._ratioH=this.height/_77.getHeight();var _7b=this._delta;this._delta=null;this.__zooming=false;this.onZoomEnd(_77,_78,_79,lod?lod.level:null);this.onExtentChange(_77,_7b,_7a,lod);},__setExtent:function(_7c,_7d,_7e,fit){try{if(this._zoomAnim){return;}if(this._firstLayerId){this.extent=_7c;return;}var _7f=true,ext=this.extent,_80=this._fixExtent(_7c,fit||false);_7c=_80.extent;var _81=_7c.getWidth(),_82=_7c.getHeight(),_83=Math.round;if(ext){var tw=_83(ext.getWidth()*_11),w=_83(_81*_11),th=_83(ext.getHeight()*_11),h=_83(_82*_11);_7f=(tw!==w)||(th!==h);}var _84,_85,end,_86,_87,_88;if(_10.zoomDuration&&_7f&&ext){_86=new _d(ext);_85={left:ext.xmin,top:ext.ymax,width:ext.getWidth(),height:ext.getHeight()};end={left:_7c.xmin,top:_7c.ymax,width:_81,height:_82};_87=_85.width/end.width;_88=_85.height/end.height;var mtl=new _c(_7c.xmin,_7c.ymax),mbl=new _c(_7c.xmin,_7c.ymin),etl=new _c(ext.xmin,ext.ymax),ebl=new _c(ext.xmin,ext.ymin);_84=esri.geometry.getLineIntersection(etl,mtl,ebl,mbl);if(!_84){_7f=false;}}this._ratioW=this.width/_81;this._ratioH=this.height/_82;var _89=this._zoomAnimDiv;if(_7f){ds(this._layersDiv,{left:"0px",top:"0px"});_7d=new _c(0,0);this.__visibleRect.x=(this.__visibleRect.y=0);if(_85&&end){this._delta=_7d;_89.id="_zAD";_89.startingExtent=_86;_89.extent=_7c;_89.levelChange=_7f;_89.newLod=_80.lod;this._zoomAnim=esri.fx.resize({node:_89,start:_85,end:end,duration:_10.zoomDuration,rate:_10.zoomRate,beforeBegin:this._zoomStartHandler,onAnimate:this._zoomingHandler,onEnd:this._zoomEndHandler});if(_7e){_89.anchor=_7e;}else{_89.anchor=_8(ext,this.width,this.height,_84);}this._zoomAnim.play();}else{this.extent=_7c;this.onExtentChange(this.extent,_7d,_7f,(this.__LOD=_80.lod));}}else{if(!this.__panning){if(this.loaded===false){this.extent=_7c;this.onExtentChange(this.extent,_7d,_7f,(this.__LOD=_80.lod));}else{this.__panning=true;_85=new _f(0,0,this.width,this.height,this.spatialReference).getCenter();_85.x=_83(_85.x);_85.y=_83(_85.y);this.onPanStart(this.extent,new _c(0,0));var _8a=(this._delta=this.toScreen(_7c.getCenter()));esri.fx.slideTo({node:_89,left:_85.x-_8a.x,top:_85.y-_8a.y,duration:_10.panDuration,rate:_10.panRate,onAnimate:this._panningHandler,onEnd:this._panEndHandler}).play();}}}}catch(e){console.log(e.stack);console.error(e);}},__getExtentForLevel:function(_8b,_8c,_8d){var ti=this.__tileInfo;_8d=_8d||this.extent;_8c=_8c||_8d.getCenter();if(ti){var _8e=ti.lods;if(_8b<0||_8b>=_8e.length){return {};}var lod=_8e[_8b],_8f=this.width*lod.resolution/2,_90=this.height*lod.resolution/2;return {extent:new _d(_8c.x-_8f,_8c.y-_90,_8c.x+_8f,_8c.y+_90,_8c.spatialReference),lod:lod};}else{return {extent:_8d.expand(_8b).centerAt(_8c)};}},__scaleExtent:function(_91,_92,_93){var _94=_93||_91.getCenter();var _95=_91.expand(_92),_96=_91.xmin-((_95.getWidth()-_91.getWidth())*(_94.x-_91.xmin)/_91.getWidth()),_97=_91.ymax-((_95.getHeight()-_91.getHeight())*(_94.y-_91.ymax)/_91.getHeight());return new _d(_96,_97-_95.getHeight(),_96+_95.getWidth(),_97,_91.spatialReference);},_jobs:0,_incr:function(){if((++this._jobs)===1){this.updating=true;this.onUpdateStart();}},_decr:function(){var _98=--this._jobs;if(!_98){this.updating=false;this.onUpdateEnd();}else{if(_98<0){this._jobs=0;}}},onUpdateStart:function(){},onUpdateEnd:function(){},onLoad:function(){this._setClipRect();},onUnload:function(){},onExtentChange:function(a,b,_99){if(_99){this._setClipRect();}},onTimeExtentChange:function(){},onLayerAdd:function(){},onLayerAddResult:function(){},onLayersAddResult:function(){},onLayerRemove:function(){},onLayersRemoved:function(){},onLayerReorder:function(){},onLayersReordered:function(){},onPanStart:function(){},onPan:function(){},onPanEnd:function(){},onZoomStart:function(){},onZoom:function(){},onZoomEnd:function(){},onResize:function(){this._setClipRect();},onReposition:function(){},destroy:function(){if(!this._destroyed){this.removeAllLayers();this._cleanUp();if(this._gc){this._gc._cleanUp();}this._destroyed=true;this.onUnload(this);}},setCursor:function(_9a){ds(this.__container,"cursor",(this.cursor=_9a));},setMapCursor:function(c){this.setCursor((this._cursor=c));},resetMapCursor:function(){this.setCursor(this._cursor);},setInfoWindow:function(_9b){var iw=this.infoWindow;if(iw){iw.unsetMap(this);}this.infoWindow=_9b;if(this.loaded&&_9b){_9b.setMap(this);}},setInfoWindowOnClick:function(_9c){var _9d=this._params;if(_9c){if(!_9d.showInfoWindowOnClick){var _9e=[this.graphics].concat(_4.map(this.graphicsLayerIds,this.getLayer,this));_4.map(_9e,function(_9f){if(_9f&&_9f.loaded){this._clickHandles.push(dc(_9f,"onClick",this,"_gClickHandler"));}},this);}}else{_4.forEach(this._clickHandles,_9);this._clickHandles=[];}_9d.showInfoWindowOnClick=_9c;},getInfoWindowAnchor:function(pt){var w2=this.width/2,h2=this.height/2,_a0;if(pt.y<h2){_a0="LOWER";}else{_a0="UPPER";}if(pt.x<w2){return esri.dijit.InfoWindow["ANCHOR_"+_a0+"RIGHT"];}else{return esri.dijit.InfoWindow["ANCHOR_"+_a0+"LEFT"];}},toScreen:function(pt,_a1){return _8(this.extent,this.width,this.height,pt,_a1);},toMap:function(pt){return _7(this.extent,this.width,this.height,pt);},addLayer:function(_a2,_a3){return this._addLayer(_a2,_a2 instanceof _e?this.graphicsLayerIds:this.layerIds,_a3);},addLayers:function(_a4){var _a5=[],_a6=_a4.length,_a7,i,len=_a4.length;var _a8=function(_a9,_aa){if(_4.indexOf(_a4,_a9)!==-1){_a6--;_a5.push({"layer":_a9,"success":!_aa,"error":_aa});if(!_a6){_4.disconnect(_a7);this.onLayersAddResult(_a5);}}};_a7=_4.connect(this,"onLayerAddResult",_a8);for(i=0;i<len;i++){this.addLayer(_a4[i]);}return this;},removeLayer:function(_ab){var id=_ab.id,ids=_ab instanceof _e?this.graphicsLayerIds:this.layerIds,i=_a(ids,id);if(i>=0){ids.splice(i,1);if(_ab instanceof _e){_9(this["_gl_"+_ab.id+"_click_connect"]);_ab._unsetMap(this,this._gc._surface);}else{_ab._unsetMap(this,this._layersDiv);if(_ab.declaredClass.indexOf("VETiledLayer")!==-1){this._onBingLayerRemove(_ab);}}delete this._layers[id];delete this._layerDivs[id];this._reorderLayers(ids);this.onLayerRemove(_ab);}},removeAllLayers:function(){var ids=this.layerIds,i;for(i=ids.length-1;i>=0;i--){this.removeLayer(this._layers[ids[i]]);}ids=this.graphicsLayerIds;for(i=ids.length-1;i>=0;i--){this.removeLayer(this._layers[ids[i]]);}this.onLayersRemoved();},reorderLayer:function(_ac,_ad){if(_4.isString(_ac)){_4.deprecated(this.declaredClass+": "+esri.bundle.map.deprecateReorderLayerString,null,"v2.0");_ac=this.getLayer(_ac);}var id=_ac.id,ids=_ac instanceof _e?this.graphicsLayerIds:this.layerIds;if(_ad<0){_ad=0;}else{if(_ad>=ids.length){_ad=ids.length-1;}}var i=_a(ids,id);if(i===-1||i===_ad){return;}ids.splice(i,1);ids.splice(_ad,0,id);this._reorderLayers(ids);},getLayer:function(id){return this._layers[id];},setExtent:function(_ae,fit){this.__setExtent(new esri.geometry.Extent(_ae.toJson()),null,null,fit);},centerAt:function(_af){this._panTo(_af);},centerAndZoom:function(_b0,_b1){var ext=this.__getExtentForLevel(_b1,_b0).extent;if(ext){this.__setExtent(ext);}else{this.centerAt(_b0);}},getNumLevels:function(){return this.__tileInfo?this.__tileInfo.lods.length:0;},getLevel:function(){return this.__LOD?this.__LOD.level:-1;},setLevel:function(_b2){var ext=this.__getExtentForLevel(_b2).extent;if(ext){this.setExtent(ext);}},setTimeExtent:function(_b3){this.timeExtent=_b3;var arg=_b3?new esri.TimeExtent(_b3.startTime,_b3.endTime):null;this.onTimeExtentChange(arg);},setTimeSlider:function(_b4){if(this.timeSlider){_9(this._tsTimeExtentChange_connect);this._tsTimeExtentChange_connect=null;this.timeSlider=null;}if(_b4){this.timeSlider=_b4;this.setTimeExtent(_b4.getCurrentTimeExtent());this._tsTimeExtentChange_connect=dc(_b4,"onTimeExtentChange",this,"setTimeExtent");}},resize:function(){var w=this.width,h=this.height,r=esri.geometry._extentToRect(this.extent);var _b5=_4.contentBox(this.container);ds(this.root,{width:(this.width=_b5.w)+"px",height:(this.height=_b5.h)+"px"});var wd=this.width,ht=this.height;this.__visibleRect.update(this.__visibleRect.x,this.__visibleRect.y,wd,ht);this.__visibleDelta.update(this.__visibleDelta.x,this.__visibleDelta.y,wd,ht);var ne=(this.extent=esri.geometry._rectToExtent(new _f(r.x,r.y,r.width*(wd/w),r.height*(ht/h),this.spatialReference)));this.onResize(ne,wd,ht);this.__setExtent(ne);},reposition:function(){this._reposition();this.onReposition(this.position.x,this.position.y);},_reposition:function(){var pos=_4.coords(this.container,true),_b6=_4._getPadBorderExtents(this.container);this.position.update(pos.x+_b6.l,pos.y+_b6.t);},_setClipRect:function(){delete this._clip;var _b7=_4.isIE?"rect(auto,auto,auto,auto)":null;if(this.wrapAround180){var _b8=this.width,_b9=this.height,_ba=this._getFrameWidth(),_bb=_b8-_ba;if(_bb>0){var _bc=_bb/2;_b7="rect(0px,"+(_bc+_ba)+"px,"+_b9+"px,"+_bc+"px)";var _bd=this.extent.getWidth(),_be=_bd*(_ba/_b8);this._clip=[(_bd-_be)/2,_be];}}ds(this.__container,"clip",_b7);},_getAvailExtent:function(){var _bf=this.extent,_c0=this._clip;if(_c0){if(!_bf._clip){var _c1=new esri.geometry._extentToRect(_bf);_c1.width=_c0[1];_c1.x=_c1.x+_c0[0];_bf._clip=_c1.getExtent();}return _bf._clip;}return _bf;},panUp:function(){this._fixedPan(0,this.height*-_12);},panUpperRight:function(){this._fixedPan(this.width*_12,this.height*-_12);},panRight:function(){this._fixedPan(this.width*_12,0);},panLowerRight:function(){this._fixedPan(this.width*_12,this.height*_12);},panDown:function(){this._fixedPan(0,this.height*_12);},panLowerLeft:function(){this._fixedPan(this.width*-_12,this.height*_12);},panLeft:function(){this._fixedPan(this.width*-_12,0);},panUpperLeft:function(){this._fixedPan(this.width*-_12,this.height*-_12);},enableSnapping:function(_c2){if(!_c2){_c2={};}if(_c2.declaredClass==="esri.SnappingManager"){this.snappingManager=_c2;}else{this.snappingManager=new esri.SnappingManager(_4.mixin({map:this},_c2));}return this.snappingManager;},disableSnapping:function(){if(this.snappingManager){this.snappingManager.destroy();}this.snappingManager=null;}};}()));}}};});