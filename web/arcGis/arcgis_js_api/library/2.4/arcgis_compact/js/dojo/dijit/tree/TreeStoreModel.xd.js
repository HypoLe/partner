/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


window[esri._dojoScopeName||"dojo"]._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dijit.tree.TreeStoreModel"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dijit.tree.TreeStoreModel"]){_4._hasResource["dijit.tree.TreeStoreModel"]=true;_4.provide("dijit.tree.TreeStoreModel");_4.declare("dijit.tree.TreeStoreModel",null,{store:null,childrenAttrs:["children"],newItemIdAttr:"id",labelAttr:"",root:null,query:null,deferItemLoadingUntilExpand:false,constructor:function(_7){_4.mixin(this,_7);this.connects=[];var _8=this.store;if(!_8.getFeatures()["dojo.data.api.Identity"]){throw new Error("dijit.Tree: store must support dojo.data.Identity");}if(_8.getFeatures()["dojo.data.api.Notification"]){this.connects=this.connects.concat([_4.connect(_8,"onNew",this,"onNewItem"),_4.connect(_8,"onDelete",this,"onDeleteItem"),_4.connect(_8,"onSet",this,"onSetItem")]);}},destroy:function(){_4.forEach(this.connects,_4.disconnect);},getRoot:function(_9,_a){if(this.root){_9(this.root);}else{this.store.fetch({query:this.query,onComplete:_4.hitch(this,function(_b){if(_b.length!=1){throw new Error(this.declaredClass+": query "+_4.toJson(this.query)+" returned "+_b.length+" items, but must return exactly one item");}this.root=_b[0];_9(this.root);}),onError:_a});}},mayHaveChildren:function(_c){return _4.some(this.childrenAttrs,function(_d){return this.store.hasAttribute(_c,_d);},this);},getChildren:function(_e,_f,_10){var _11=this.store;if(!_11.isItemLoaded(_e)){var _12=_4.hitch(this,arguments.callee);_11.loadItem({item:_e,onItem:function(_13){_12(_13,_f,_10);},onError:_10});return;}var _14=[];for(var i=0;i<this.childrenAttrs.length;i++){var _15=_11.getValues(_e,this.childrenAttrs[i]);_14=_14.concat(_15);}var _16=0;if(!this.deferItemLoadingUntilExpand){_4.forEach(_14,function(_17){if(!_11.isItemLoaded(_17)){_16++;}});}if(_16==0){_f(_14);}else{_4.forEach(_14,function(_18,idx){if(!_11.isItemLoaded(_18)){_11.loadItem({item:_18,onItem:function(_19){_14[idx]=_19;if(--_16==0){_f(_14);}},onError:_10});}});}},isItem:function(_1a){return this.store.isItem(_1a);},fetchItemByIdentity:function(_1b){this.store.fetchItemByIdentity(_1b);},getIdentity:function(_1c){return this.store.getIdentity(_1c);},getLabel:function(_1d){if(this.labelAttr){return this.store.getValue(_1d,this.labelAttr);}else{return this.store.getLabel(_1d);}},newItem:function(_1e,_1f,_20){var _21={parent:_1f,attribute:this.childrenAttrs[0]},_22;if(this.newItemIdAttr&&_1e[this.newItemIdAttr]){this.fetchItemByIdentity({identity:_1e[this.newItemIdAttr],scope:this,onItem:function(_23){if(_23){this.pasteItem(_23,null,_1f,true,_20);}else{_22=this.store.newItem(_1e,_21);if(_22&&(_20!=undefined)){this.pasteItem(_22,_1f,_1f,false,_20);}}}});}else{_22=this.store.newItem(_1e,_21);if(_22&&(_20!=undefined)){this.pasteItem(_22,_1f,_1f,false,_20);}}},pasteItem:function(_24,_25,_26,_27,_28){var _29=this.store,_2a=this.childrenAttrs[0];if(_25){_4.forEach(this.childrenAttrs,function(_2b){if(_29.containsValue(_25,_2b,_24)){if(!_27){var _2c=_4.filter(_29.getValues(_25,_2b),function(x){return x!=_24;});_29.setValues(_25,_2b,_2c);}_2a=_2b;}});}if(_26){if(typeof _28=="number"){var _2d=_29.getValues(_26,_2a).slice();_2d.splice(_28,0,_24);_29.setValues(_26,_2a,_2d);}else{_29.setValues(_26,_2a,_29.getValues(_26,_2a).concat(_24));}}},onChange:function(_2e){},onChildrenChange:function(_2f,_30){},onDelete:function(_31,_32){},onNewItem:function(_33,_34){if(!_34){return;}this.getChildren(_34.item,_4.hitch(this,function(_35){this.onChildrenChange(_34.item,_35);}));},onDeleteItem:function(_36){this.onDelete(_36);},onSetItem:function(_37,_38,_39,_3a){if(_4.indexOf(this.childrenAttrs,_38)!=-1){this.getChildren(_37,_4.hitch(this,function(_3b){this.onChildrenChange(_37,_3b);}));}else{this.onChange(_37);}}});}}};});