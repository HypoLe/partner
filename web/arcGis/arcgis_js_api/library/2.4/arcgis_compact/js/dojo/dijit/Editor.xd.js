/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


window[esri._dojoScopeName||"dojo"]._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dijit.Editor"],["require","dijit._editor.RichText"],["require","dijit.Toolbar"],["require","dijit.ToolbarSeparator"],["require","dijit._editor._Plugin"],["require","dijit._editor.plugins.EnterKeyHandling"],["require","dijit._editor.range"],["require","dijit._Container"],["require","dojo.i18n"],["require","dijit.layout._LayoutWidget"],["requireLocalization","dijit._editor","commands",null,"ROOT,ar,ca,cs,da,de,el,es,fi,fr,he,hu,it,ja,kk,ko,nb,nl,pl,pt,pt-pt,ro,ru,sk,sl,sv,th,tr,zh,zh-tw","ROOT,ar,ca,cs,da,de,el,es,fi,fr,he,hu,it,ja,kk,ko,nb,nl,pl,pt,pt-pt,ro,ru,sk,sl,sv,th,tr,zh,zh-tw"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dijit.Editor"]){_4._hasResource["dijit.Editor"]=true;_4.provide("dijit.Editor");_4.require("dijit._editor.RichText");_4.require("dijit.Toolbar");_4.require("dijit.ToolbarSeparator");_4.require("dijit._editor._Plugin");_4.require("dijit._editor.plugins.EnterKeyHandling");_4.require("dijit._editor.range");_4.require("dijit._Container");_4.require("dojo.i18n");_4.require("dijit.layout._LayoutWidget");_4.declare("dijit.Editor",_5._editor.RichText,{plugins:null,extraPlugins:null,constructor:function(){if(!_4.isArray(this.plugins)){this.plugins=["undo","redo","|","cut","copy","paste","|","bold","italic","underline","strikethrough","|","insertOrderedList","insertUnorderedList","indent","outdent","|","justifyLeft","justifyRight","justifyCenter","justifyFull","dijit._editor.plugins.EnterKeyHandling"];}this._plugins=[];this._editInterval=this.editActionInterval*1000;if(_4.isIE){this.events.push("onBeforeDeactivate");this.events.push("onBeforeActivate");}},postMixInProperties:function(){this.setValueDeferred=new _4.Deferred();this.inherited(arguments);},postCreate:function(){this._steps=this._steps.slice(0);this._undoedSteps=this._undoedSteps.slice(0);if(_4.isArray(this.extraPlugins)){this.plugins=this.plugins.concat(this.extraPlugins);}this.inherited(arguments);this.commands=_4.i18n.getLocalization("dijit._editor","commands",this.lang);if(!this.toolbar){this.toolbar=new _5.Toolbar({dir:this.dir,lang:this.lang});this.header.appendChild(this.toolbar.domNode);}_4.forEach(this.plugins,this.addPlugin,this);this.setValueDeferred.callback(true);_4.addClass(this.iframe.parentNode,"dijitEditorIFrameContainer");_4.addClass(this.iframe,"dijitEditorIFrame");_4.attr(this.iframe,"allowTransparency",true);if(_4.isWebKit){_4.style(this.domNode,"KhtmlUserSelect","none");}this.toolbar.startup();this.onNormalizedDisplayChanged();},destroy:function(){_4.forEach(this._plugins,function(p){if(p&&p.destroy){p.destroy();}});this._plugins=[];this.toolbar.destroyRecursive();delete this.toolbar;this.inherited(arguments);},addPlugin:function(_7,_8){var _9=_4.isString(_7)?{name:_7}:_7;if(!_9.setEditor){var o={"args":_9,"plugin":null,"editor":this};_4.publish(_5._scopeName+".Editor.getPlugin",[o]);if(!o.plugin){var pc=_4.getObject(_9.name);if(pc){o.plugin=new pc(_9);}}if(!o.plugin){console.warn("Cannot find plugin",_7);return;}_7=o.plugin;}if(arguments.length>1){this._plugins[_8]=_7;}else{this._plugins.push(_7);}_7.setEditor(this);if(_4.isFunction(_7.setToolbar)){_7.setToolbar(this.toolbar);}},startup:function(){},resize:function(_a){if(_a){_5.layout._LayoutWidget.prototype.resize.apply(this,arguments);}},layout:function(){var _b=(this._contentBox.h-(this.getHeaderHeight()+this.getFooterHeight()+_4._getPadBorderExtents(this.iframe.parentNode).h+_4._getMarginExtents(this.iframe.parentNode).h));this.editingArea.style.height=_b+"px";if(this.iframe){this.iframe.style.height="100%";}this._layoutMode=true;},_onIEMouseDown:function(e){var _c;var b=this.document.body;var _d=b.clientWidth;var _e=b.clientHeight;var _f=b.clientLeft;var _10=b.offsetWidth;var _11=b.offsetHeight;var _12=b.offsetLeft;bodyDir=b.dir?b.dir.toLowerCase():"";if(bodyDir!="rtl"){if(_d<_10&&e.x>_d&&e.x<_10){_c=true;}}else{if(e.x<_f&&e.x>_12){_c=true;}}if(!_c){if(_e<_11&&e.y>_e&&e.y<_11){_c=true;}}if(!_c){delete this._cursorToStart;delete this._savedSelection;if(e.target.tagName=="BODY"){setTimeout(_4.hitch(this,"placeCursorAtEnd"),0);}this.inherited(arguments);}},onBeforeActivate:function(e){this._restoreSelection();},onBeforeDeactivate:function(e){if(this.customUndo){this.endEditing(true);}if(e.target.tagName!="BODY"){this._saveSelection();}},customUndo:true,editActionInterval:3,beginEditing:function(cmd){if(!this._inEditing){this._inEditing=true;this._beginEditing(cmd);}if(this.editActionInterval>0){if(this._editTimer){clearTimeout(this._editTimer);}this._editTimer=setTimeout(_4.hitch(this,this.endEditing),this._editInterval);}},_steps:[],_undoedSteps:[],execCommand:function(cmd){if(this.customUndo&&(cmd=="undo"||cmd=="redo")){return this[cmd]();}else{if(this.customUndo){this.endEditing();this._beginEditing();}var r;var _13=/copy|cut|paste/.test(cmd);try{r=this.inherited(arguments);if(_4.isWebKit&&_13&&!r){throw {code:1011};}}catch(e){if(e.code==1011&&_13){var sub=_4.string.substitute,_14={cut:"X",copy:"C",paste:"V"};alert(sub(this.commands.systemShortcut,[this.commands[cmd],sub(this.commands[_4.isMac?"appleKey":"ctrlKey"],[_14[cmd]])]));}r=false;}if(this.customUndo){this._endEditing();}return r;}},queryCommandEnabled:function(cmd){if(this.customUndo&&(cmd=="undo"||cmd=="redo")){return cmd=="undo"?(this._steps.length>1):(this._undoedSteps.length>0);}else{return this.inherited(arguments);}},_moveToBookmark:function(b){var _15=b.mark;var _16=b.mark;var col=b.isCollapsed;var r,_17,_18,sel;if(_16){if(_4.isIE<9){if(_4.isArray(_16)){_15=[];_4.forEach(_16,function(n){_15.push(_5.range.getNode(n,this.editNode));},this);_4.withGlobal(this.window,"moveToBookmark",_5,[{mark:_15,isCollapsed:col}]);}else{if(_16.startContainer&&_16.endContainer){sel=_5.range.getSelection(this.window);if(sel&&sel.removeAllRanges){sel.removeAllRanges();r=_5.range.create(this.window);_17=_5.range.getNode(_16.startContainer,this.editNode);_18=_5.range.getNode(_16.endContainer,this.editNode);if(_17&&_18){r.setStart(_17,_16.startOffset);r.setEnd(_18,_16.endOffset);sel.addRange(r);}}}}}else{sel=_5.range.getSelection(this.window);if(sel&&sel.removeAllRanges){sel.removeAllRanges();r=_5.range.create(this.window);_17=_5.range.getNode(_16.startContainer,this.editNode);_18=_5.range.getNode(_16.endContainer,this.editNode);if(_17&&_18){r.setStart(_17,_16.startOffset);r.setEnd(_18,_16.endOffset);sel.addRange(r);}}}}},_changeToStep:function(_19,to){this.setValue(to.text);var b=to.bookmark;if(!b){return;}this._moveToBookmark(b);},undo:function(){var ret=false;if(!this._undoRedoActive){this._undoRedoActive=true;this.endEditing(true);var s=this._steps.pop();if(s&&this._steps.length>0){this.focus();this._changeToStep(s,this._steps[this._steps.length-1]);this._undoedSteps.push(s);this.onDisplayChanged();delete this._undoRedoActive;ret=true;}delete this._undoRedoActive;}return ret;},redo:function(){var ret=false;if(!this._undoRedoActive){this._undoRedoActive=true;this.endEditing(true);var s=this._undoedSteps.pop();if(s&&this._steps.length>0){this.focus();this._changeToStep(this._steps[this._steps.length-1],s);this._steps.push(s);this.onDisplayChanged();ret=true;}delete this._undoRedoActive;}return ret;},endEditing:function(_1a){if(this._editTimer){clearTimeout(this._editTimer);}if(this._inEditing){this._endEditing(_1a);this._inEditing=false;}},_getBookmark:function(){var b=_4.withGlobal(this.window,_5.getBookmark);var tmp=[];if(b&&b.mark){var _1b=b.mark;if(_4.isIE<9){var sel=_5.range.getSelection(this.window);if(!_4.isArray(_1b)){if(sel){var _1c;if(sel.rangeCount){_1c=sel.getRangeAt(0);}if(_1c){b.mark=_1c.cloneRange();}else{b.mark=_4.withGlobal(this.window,_5.getBookmark);}}}else{_4.forEach(b.mark,function(n){tmp.push(_5.range.getIndex(n,this.editNode).o);},this);b.mark=tmp;}}try{if(b.mark&&b.mark.startContainer){tmp=_5.range.getIndex(b.mark.startContainer,this.editNode).o;b.mark={startContainer:tmp,startOffset:b.mark.startOffset,endContainer:b.mark.endContainer===b.mark.startContainer?tmp:_5.range.getIndex(b.mark.endContainer,this.editNode).o,endOffset:b.mark.endOffset};}}catch(e){b.mark=null;}}return b;},_beginEditing:function(cmd){if(this._steps.length===0){this._steps.push({"text":_5._editor.getChildrenHtml(this.editNode),"bookmark":this._getBookmark()});}},_endEditing:function(_1d){var v=_5._editor.getChildrenHtml(this.editNode);this._undoedSteps=[];this._steps.push({text:v,bookmark:this._getBookmark()});},onKeyDown:function(e){if(!_4.isIE&&!this.iframe&&e.keyCode==_4.keys.TAB&&!this.tabIndent){this._saveSelection();}if(!this.customUndo){this.inherited(arguments);return;}var k=e.keyCode,ks=_4.keys;if(e.ctrlKey&&!e.altKey){if(k==90||k==122){_4.stopEvent(e);this.undo();return;}else{if(k==89||k==121){_4.stopEvent(e);this.redo();return;}}}this.inherited(arguments);switch(k){case ks.ENTER:case ks.BACKSPACE:case ks.DELETE:this.beginEditing();break;case 88:case 86:if(e.ctrlKey&&!e.altKey&&!e.metaKey){this.endEditing();if(e.keyCode==88){this.beginEditing("cut");setTimeout(_4.hitch(this,this.endEditing),1);}else{this.beginEditing("paste");setTimeout(_4.hitch(this,this.endEditing),1);}break;}default:if(!e.ctrlKey&&!e.altKey&&!e.metaKey&&(e.keyCode<_4.keys.F1||e.keyCode>_4.keys.F15)){this.beginEditing();break;}case ks.ALT:this.endEditing();break;case ks.UP_ARROW:case ks.DOWN_ARROW:case ks.LEFT_ARROW:case ks.RIGHT_ARROW:case ks.HOME:case ks.END:case ks.PAGE_UP:case ks.PAGE_DOWN:this.endEditing(true);break;case ks.CTRL:case ks.SHIFT:case ks.TAB:break;}},_onBlur:function(){this.inherited(arguments);this.endEditing(true);},_saveSelection:function(){try{this._savedSelection=this._getBookmark();}catch(e){}},_restoreSelection:function(){if(this._savedSelection){delete this._cursorToStart;if(_4.withGlobal(this.window,"isCollapsed",_5)){this._moveToBookmark(this._savedSelection);}delete this._savedSelection;}},onClick:function(){this.endEditing(true);this.inherited(arguments);},replaceValue:function(_1e){if(!this.customUndo){this.inherited(arguments);}else{if(this.isClosed){this.setValue(_1e);}else{this.beginEditing();if(!_1e){_1e="&nbsp;";}this.setValue(_1e);this.endEditing();}}},_setDisabledAttr:function(_1f){var _20=_4.hitch(this,function(){if((!this.disabled&&_1f)||(!this._buttonEnabledPlugins&&_1f)){_4.forEach(this._plugins,function(p){p.set("disabled",true);});}else{if(this.disabled&&!_1f){_4.forEach(this._plugins,function(p){p.set("disabled",false);});}}});this.setValueDeferred.addCallback(_20);this.inherited(arguments);},_setStateClass:function(){try{this.inherited(arguments);if(this.document&&this.document.body){_4.style(this.document.body,"color",_4.style(this.iframe,"color"));}}catch(e){}}});_4.subscribe(_5._scopeName+".Editor.getPlugin",null,function(o){if(o.plugin){return;}var _21=o.args,p;var _22=_5._editor._Plugin;var _23=_21.name;switch(_23){case "undo":case "redo":case "cut":case "copy":case "paste":case "insertOrderedList":case "insertUnorderedList":case "indent":case "outdent":case "justifyCenter":case "justifyFull":case "justifyLeft":case "justifyRight":case "delete":case "selectAll":case "removeFormat":case "unlink":case "insertHorizontalRule":p=new _22({command:_23});break;case "bold":case "italic":case "underline":case "strikethrough":case "subscript":case "superscript":p=new _22({buttonClass:_5.form.ToggleButton,command:_23});break;case "|":p=new _22({button:new _5.ToolbarSeparator(),setEditor:function(_24){this.editor=_24;}});}o.plugin=p;});}}};});