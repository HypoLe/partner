/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


window[esri._dojoScopeName||"dojo"]._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dijit._editor.plugins.LinkDialog"],["require","dijit._Widget"],["require","dijit._editor._Plugin"],["require","dijit.TooltipDialog"],["require","dijit.form.DropDownButton"],["require","dijit.form.ValidationTextBox"],["require","dijit.form.Select"],["require","dijit._editor.range"],["require","dojo.i18n"],["require","dojo.string"],["requireLocalization","dijit","common",null,"ROOT,ar,ca,cs,da,de,el,es,fi,fr,he,hu,it,ja,kk,ko,nb,nl,pl,pt,pt-pt,ro,ru,sk,sl,sv,th,tr,zh,zh-tw","ROOT,ar,ca,cs,da,de,el,es,fi,fr,he,hu,it,ja,kk,ko,nb,nl,pl,pt,pt-pt,ro,ru,sk,sl,sv,th,tr,zh,zh-tw"],["requireLocalization","dijit._editor","LinkDialog",null,"ROOT,ar,ca,cs,da,de,el,es,fi,fr,he,hu,it,ja,kk,ko,nb,nl,pl,pt,pt-pt,ro,ru,sk,sl,sv,th,tr,zh,zh-tw","ROOT,ar,ca,cs,da,de,el,es,fi,fr,he,hu,it,ja,kk,ko,nb,nl,pl,pt,pt-pt,ro,ru,sk,sl,sv,th,tr,zh,zh-tw"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dijit._editor.plugins.LinkDialog"]){_4._hasResource["dijit._editor.plugins.LinkDialog"]=true;_4.provide("dijit._editor.plugins.LinkDialog");_4.require("dijit._Widget");_4.require("dijit._editor._Plugin");_4.require("dijit.TooltipDialog");_4.require("dijit.form.DropDownButton");_4.require("dijit.form.ValidationTextBox");_4.require("dijit.form.Select");_4.require("dijit._editor.range");_4.require("dojo.i18n");_4.require("dojo.string");_4.declare("dijit._editor.plugins.LinkDialog",_5._editor._Plugin,{buttonClass:_5.form.DropDownButton,useDefaultCommand:false,urlRegExp:"((https?|ftps?|file)\\://|./|/|)(/[a-zA-Z]{1,1}:/|)(((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)*(?:[a-zA-Z](?:[-\\da-zA-Z]{0,80}[\\da-zA-Z])?)\\.?)|(((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])|(0[xX]0*[\\da-fA-F]?[\\da-fA-F]\\.){3}0[xX]0*[\\da-fA-F]?[\\da-fA-F]|(0+[0-3][0-7][0-7]\\.){3}0+[0-3][0-7][0-7]|(0|[1-9]\\d{0,8}|[1-3]\\d{9}|4[01]\\d{8}|42[0-8]\\d{7}|429[0-3]\\d{6}|4294[0-8]\\d{5}|42949[0-5]\\d{4}|429496[0-6]\\d{3}|4294967[01]\\d{2}|42949672[0-8]\\d|429496729[0-5])|0[xX]0*[\\da-fA-F]{1,8}|([\\da-fA-F]{1,4}\\:){7}[\\da-fA-F]{1,4}|([\\da-fA-F]{1,4}\\:){6}((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])))(\\:\\d+)?(/(?:[^?#\\s/]+/)*(?:[^?#\\s/]{0,}(?:\\?[^?#\\s/]*)?(?:#.*)?)?)?",emailRegExp:"<?(mailto\\:)([!#-'*+\\-\\/-9=?A-Z^-~]+[.])*[!#-'*+\\-\\/-9=?A-Z^-~]+"+"@"+"((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)+(?:[a-zA-Z](?:[-\\da-zA-Z]{0,6}[\\da-zA-Z])?)\\.?)|localhost|^[^-][a-zA-Z0-9_-]*>?",htmlTemplate:"<a href=\"${urlInput}\" _djrealurl=\"${urlInput}\""+" target=\"${targetSelect}\""+">${textInput}</a>",tag:"a",_hostRxp:new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$"),_userAtRxp:new RegExp("^([!#-'*+\\-\\/-9=?A-Z^-~]+[.])*[!#-'*+\\-\\/-9=?A-Z^-~]+@","i"),linkDialogTemplate:["<table><tr><td>","<label for='${id}_urlInput'>${url}</label>","</td><td>","<input dojoType='dijit.form.ValidationTextBox' required='true' "+"id='${id}_urlInput' name='urlInput' intermediateChanges='true'/>","</td></tr><tr><td>","<label for='${id}_textInput'>${text}</label>","</td><td>","<input dojoType='dijit.form.ValidationTextBox' required='true' id='${id}_textInput' "+"name='textInput' intermediateChanges='true'/>","</td></tr><tr><td>","<label for='${id}_targetSelect'>${target}</label>","</td><td>","<select id='${id}_targetSelect' name='targetSelect' dojoType='dijit.form.Select'>","<option selected='selected' value='_self'>${currentWindow}</option>","<option value='_blank'>${newWindow}</option>","<option value='_top'>${topWindow}</option>","<option value='_parent'>${parentWindow}</option>","</select>","</td></tr><tr><td colspan='2'>","<button dojoType='dijit.form.Button' type='submit' id='${id}_setButton'>${set}</button>","<button dojoType='dijit.form.Button' type='button' id='${id}_cancelButton'>${buttonCancel}</button>","</td></tr></table>"].join(""),_initButton:function(){var _7=this;this.tag=this.command=="insertImage"?"img":"a";var _8=_4.mixin(_4.i18n.getLocalization("dijit","common",this.lang),_4.i18n.getLocalization("dijit._editor","LinkDialog",this.lang));var _9=(this.dropDown=new _5.TooltipDialog({title:_8[this.command+"Title"],execute:_4.hitch(this,"setValue"),onOpen:function(){_7._onOpenDialog();_5.TooltipDialog.prototype.onOpen.apply(this,arguments);},onCancel:function(){setTimeout(_4.hitch(_7,"_onCloseDialog"),0);}}));_8.urlRegExp=this.urlRegExp;_8.id=_5.getUniqueId(this.editor.id);this._uniqueId=_8.id;this._setContent(_9.title+"<div style='border-bottom: 1px black solid;padding-bottom:2pt;margin-bottom:4pt'></div>"+_4.string.substitute(this.linkDialogTemplate,_8));_9.startup();this._urlInput=_5.byId(this._uniqueId+"_urlInput");this._textInput=_5.byId(this._uniqueId+"_textInput");this._setButton=_5.byId(this._uniqueId+"_setButton");this.connect(_5.byId(this._uniqueId+"_cancelButton"),"onClick",function(){this.dropDown.onCancel();});if(this._urlInput){this.connect(this._urlInput,"onChange","_checkAndFixInput");}if(this._textInput){this.connect(this._textInput,"onChange","_checkAndFixInput");}this._urlRegExp=new RegExp("^"+this.urlRegExp+"$","i");this._emailRegExp=new RegExp("^"+this.emailRegExp+"$","i");this._urlInput.isValid=_4.hitch(this,function(){var _a=this._urlInput.get("value");return this._urlRegExp.test(_a)||this._emailRegExp.test(_a);});this._connectTagEvents();this.inherited(arguments);},_checkAndFixInput:function(){var _b=this;var _c=this._urlInput.get("value");var _d=function(_e){var _f=false;var _10=false;if(_e&&_e.length>1){_e=_4.trim(_e);if(_e.indexOf("mailto:")!==0){if(_e.indexOf("/")>0){if(_e.indexOf("://")===-1){if(_e.charAt(0)!=="/"&&_e.indexOf("./")!==0){if(_b._hostRxp.test(_e)){_f=true;}}}}else{if(_b._userAtRxp.test(_e)){_10=true;}}}}if(_f){_b._urlInput.set("value","http://"+_e);}if(_10){_b._urlInput.set("value","mailto:"+_e);}_b._setButton.set("disabled",!_b._isValid());};if(this._delayedCheck){clearTimeout(this._delayedCheck);this._delayedCheck=null;}this._delayedCheck=setTimeout(function(){_d(_c);},250);},_connectTagEvents:function(){this.editor.onLoadDeferred.addCallback(_4.hitch(this,function(){this.connect(this.editor.editNode,"ondblclick",this._onDblClick);}));},_isValid:function(){return this._urlInput.isValid()&&this._textInput.isValid();},_setContent:function(_11){this.dropDown.set({parserScope:"dojo",content:_11});},_checkValues:function(_12){if(_12&&_12.urlInput){_12.urlInput=_12.urlInput.replace(/"/g,"&quot;");}return _12;},setValue:function(_13){this._onCloseDialog();if(_4.isIE<9){var sel=_5.range.getSelection(this.editor.window);var _14=sel.getRangeAt(0);var a=_14.endContainer;if(a.nodeType===3){a=a.parentNode;}if(a&&(a.nodeName&&a.nodeName.toLowerCase()!==this.tag)){a=_4.withGlobal(this.editor.window,"getSelectedElement",_5._editor.selection,[this.tag]);}if(a&&(a.nodeName&&a.nodeName.toLowerCase()===this.tag)){if(this.editor.queryCommandEnabled("unlink")){_4.withGlobal(this.editor.window,"selectElementChildren",_5._editor.selection,[a]);this.editor.execCommand("unlink");}}}_13=this._checkValues(_13);this.editor.execCommand("inserthtml",_4.string.substitute(this.htmlTemplate,_13));},_onCloseDialog:function(){this.editor.focus();},_getCurrentValues:function(a){var url,_15,_16;if(a&&a.tagName.toLowerCase()===this.tag){url=a.getAttribute("_djrealurl")||a.getAttribute("href");_16=a.getAttribute("target")||"_self";_15=a.textContent||a.innerText;_4.withGlobal(this.editor.window,"selectElement",_5._editor.selection,[a,true]);}else{_15=_4.withGlobal(this.editor.window,_5._editor.selection.getSelectedText);}return {urlInput:url||"",textInput:_15||"",targetSelect:_16||""};},_onOpenDialog:function(){var a;if(_4.isIE<9){var sel=_5.range.getSelection(this.editor.window);var _17=sel.getRangeAt(0);a=_17.endContainer;if(a.nodeType===3){a=a.parentNode;}if(a&&(a.nodeName&&a.nodeName.toLowerCase()!==this.tag)){a=_4.withGlobal(this.editor.window,"getSelectedElement",_5._editor.selection,[this.tag]);}}else{a=_4.withGlobal(this.editor.window,"getAncestorElement",_5._editor.selection,[this.tag]);}this.dropDown.reset();this._setButton.set("disabled",true);this.dropDown.set("value",this._getCurrentValues(a));},_onDblClick:function(e){if(e&&e.target){var t=e.target;var tg=t.tagName?t.tagName.toLowerCase():"";if(tg===this.tag&&_4.attr(t,"href")){_4.withGlobal(this.editor.window,"selectElement",_5._editor.selection,[t]);this.editor.onDisplayChanged();setTimeout(_4.hitch(this,function(){this.button.set("disabled",false);this.button.openDropDown();}),10);}}}});_4.declare("dijit._editor.plugins.ImgLinkDialog",[_5._editor.plugins.LinkDialog],{linkDialogTemplate:["<table><tr><td>","<label for='${id}_urlInput'>${url}</label>","</td><td>","<input dojoType='dijit.form.ValidationTextBox' regExp='${urlRegExp}' "+"required='true' id='${id}_urlInput' name='urlInput' intermediateChanges='true'/>","</td></tr><tr><td>","<label for='${id}_textInput'>${text}</label>","</td><td>","<input dojoType='dijit.form.ValidationTextBox' required='false' id='${id}_textInput' "+"name='textInput' intermediateChanges='true'/>","</td></tr><tr><td>","</td><td>","</td></tr><tr><td colspan='2'>","<button dojoType='dijit.form.Button' type='submit' id='${id}_setButton'>${set}</button>","<button dojoType='dijit.form.Button' type='button' id='${id}_cancelButton'>${buttonCancel}</button>","</td></tr></table>"].join(""),htmlTemplate:"<img src=\"${urlInput}\" _djrealurl=\"${urlInput}\" alt=\"${textInput}\" />",tag:"img",_getCurrentValues:function(img){var url,_18;if(img&&img.tagName.toLowerCase()===this.tag){url=img.getAttribute("_djrealurl")||img.getAttribute("src");_18=img.getAttribute("alt");_4.withGlobal(this.editor.window,"selectElement",_5._editor.selection,[img,true]);}else{_18=_4.withGlobal(this.editor.window,_5._editor.selection.getSelectedText);}return {urlInput:url||"",textInput:_18||""};},_isValid:function(){return this._urlInput.isValid();},_connectTagEvents:function(){this.inherited(arguments);this.editor.onLoadDeferred.addCallback(_4.hitch(this,function(){this.connect(this.editor.editNode,"onmousedown",this._selectTag);}));},_selectTag:function(e){if(e&&e.target){var t=e.target;var tg=t.tagName?t.tagName.toLowerCase():"";if(tg===this.tag){_4.withGlobal(this.editor.window,"selectElement",_5._editor.selection,[t]);}}},_checkValues:function(_19){if(_19&&_19.urlInput){_19.urlInput=_19.urlInput.replace(/"/g,"&quot;");}if(_19&&_19.textInput){_19.textInput=_19.textInput.replace(/"/g,"&quot;");}return _19;},_onDblClick:function(e){if(e&&e.target){var t=e.target;var tg=t.tagName?t.tagName.toLowerCase():"";if(tg===this.tag&&_4.attr(t,"src")){_4.withGlobal(this.editor.window,"selectElement",_5._editor.selection,[t]);this.editor.onDisplayChanged();setTimeout(_4.hitch(this,function(){this.button.set("disabled",false);this.button.openDropDown();}),10);}}}});_4.subscribe(_5._scopeName+".Editor.getPlugin",null,function(o){if(o.plugin){return;}switch(o.args.name){case "createLink":o.plugin=new _5._editor.plugins.LinkDialog({command:o.args.name});break;case "insertImage":o.plugin=new _5._editor.plugins.ImgLinkDialog({command:o.args.name});break;}});}}};});