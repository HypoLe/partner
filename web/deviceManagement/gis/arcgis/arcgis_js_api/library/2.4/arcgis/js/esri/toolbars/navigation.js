/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */

if(!dojo._hasResource["esri.toolbars.navigation"]){dojo._hasResource["esri.toolbars.navigation"]=true;dojo.provide("esri.toolbars.navigation");dojo.require("esri.toolbars._toolbar");dojo.require("esri.geometry");dojo.require("esri.symbol");dojo.require("esri.utils");dojo.declare("esri.toolbars.Navigation",esri.toolbars._Toolbar,{constructor:function(_1){this.zoomSymbol=new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new dojo.Color([255,0,0]),2),new dojo.Color([0,0,0,0.25]));dojo.connect(_1,"onUnload",this,"_cleanUp");this._normalizeRect=dojo.hitch(this,this._normalizeRect);this._onMouseDownHandler=dojo.hitch(this,this._onMouseDownHandler);this._onMouseUpHandler=dojo.hitch(this,this._onMouseUpHandler);this._onMouseDragHandler=dojo.hitch(this,this._onMouseDragHandler);this._onExtentChangeHandler_connect=dojo.connect(_1,"onExtentChange",this,"_extentChangeHandler");this._extents=[];if(_1.extent){this._extents.push(_1.extent.toJson());}},_navType:null,_start:null,_graphic:null,_prevExtent:false,_nextExtent:false,_extentCursor:-1,_cleanUp:function(_2){this._extents=null;dojo.disconnect(this._onExtentChangeHandler_connect);},activate:function(_3){var _4=this.map;if(!this._graphic){this._deactivateMapTools(true,false,false,true);this._graphic=new esri.Graphic(null,this.zoomSymbol);}switch(_3){case esri.toolbars.Navigation.ZOOM_IN:case esri.toolbars.Navigation.ZOOM_OUT:this._deactivate();this._onMouseDownHandler_connect=dojo.connect(_4,"onMouseDown",this,"_onMouseDownHandler");this._onMouseDragHandler_connect=dojo.connect(_4,"onMouseDrag",this,"_onMouseDragHandler");this._onMouseUpHandler_connect=dojo.connect(_4,"onMouseUp",this,"_onMouseUpHandler");this._navType=_3;break;case esri.toolbars.Navigation.PAN:this._deactivate();_4.enablePan();this._navType=_3;break;}},_extentChangeHandler:function(_5){if(!this._prevExtent&&!this._nextExtent){this._extents=this._extents.splice(0,this._extentCursor+1);this._extents.push(dojo.toJson(_5.toJson()));this._extentCursor=this._extents.length-1;}this._prevExtent=this._nextExtent=false;this.onExtentHistoryChange();},_normalizeCursor:function(){if(this._extentCursor<0){this._extentCursor=0;}else{if(this._extentCursor>this._extents.length){this._extentCursor=this._extents.length;}}},_deactivate:function(){var _6=this._navType;if(_6===esri.toolbars.Navigation.PAN){this.map.disablePan();}else{if(_6===esri.toolbars.Navigation.ZOOM_IN||_6===esri.toolbars.Navigation.ZOOM_OUT){dojo.disconnect(this._onMouseDownHandler_connect);dojo.disconnect(this._onMouseDragHandler_connect);dojo.disconnect(this._onMouseUpHandler_connect);}}},_normalizeRect:function(_7,_8,_9){var sx=_7.x,sy=_7.y,ex=_8.x,ey=_8.y,_a=Math.abs(sx-ex),_b=Math.abs(sy-ey);return {x:Math.min(sx,ex),y:Math.max(sy,ey),width:_a,height:_b,spatialReference:_9};},_onMouseDownHandler:function(_c){this._start=_c.mapPoint;},_onMouseDragHandler:function(_d){var _e=this._graphic,_f=this.map.graphics;_f.remove(_e,true);_e.setGeometry(new esri.geometry.Rect(this._normalizeRect(this._start,_d.mapPoint,this.map.spatialReference)));_f.add(_e,true);},_onMouseUpHandler:function(evt){var map=this.map,_10=this._normalizeRect(this._start,evt.mapPoint,map.spatialReference);map.graphics.remove(this._graphic,true);if(_10.width===0&&_10.height===0){return;}if(this._navType===esri.toolbars.Navigation.ZOOM_IN){map.setExtent(esri.geometry._rectToExtent(new esri.geometry.Rect(_10)));}else{var tl=map.toScreen(_10),tr=map.toScreen({x:_10.x+_10.width,y:_10.y,spatialReference:map.spatialReference}),_11=map.extent.getWidth(),_12=(_11*map.width)/Math.abs(tr.x-tl.x),_13=(_12-_11)/2,ext=map.extent;map.setExtent(new esri.geometry.Extent(ext.xmin-_13,ext.ymin-_13,ext.xmax+_13,ext.ymax+_13,ext.spatialReference));}},deactivate:function(){this._deactivate();if(this._graphic){this.map.graphics.remove(this._graphic,true);}this._navType=this._start=this._graphic=null;this._activateMapTools(true,false,false,true);},setZoomSymbol:function(_14){this.zoomSymbol=_14;},isFirstExtent:function(){return this._extentCursor===0;},isLastExtent:function(){return this._extentCursor===(this._extents.length-1);},zoomToFullExtent:function(){var map=this.map;map.setExtent(map.getLayer(map.layerIds[0]).initialExtent);},zoomToPrevExtent:function(){if(this.isFirstExtent()){return;}this._extentCursor--;this._normalizeCursor();this._prevExtent=true;this.map.setExtent(new esri.geometry.Extent(dojo.fromJson(this._extents[this._extentCursor])));},zoomToNextExtent:function(){if(this.isLastExtent()){return;}this._extentCursor++;this._normalizeCursor();this._nextExtent=true;this.map.setExtent(new esri.geometry.Extent(dojo.fromJson(this._extents[this._extentCursor])));},onExtentHistoryChange:function(){}});dojo.mixin(esri.toolbars.Navigation,{ZOOM_IN:"zoomin",ZOOM_OUT:"zoomout",PAN:"pan"});}