/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */

window[esri._dojoScopeName||"dojo"]._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","esri.tasks.query"],["require","esri.tasks._task"],["require","esri._time"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["esri.tasks.query"]){_4._hasResource["esri.tasks.query"]=true;_4.provide("esri.tasks.query");_4.require("esri.tasks._task");_4.require("esri._time");_4.declare("esri.tasks.QueryTask",esri.tasks._Task,{constructor:function(_7){this._handler=_4.hitch(this,this._handler);this._relationshipQueryHandler=_4.hitch(this,this._relationshipQueryHandler);this._executeForIdsHandler=_4.hitch(this,this._executeForIdsHandler);this._countHandler=_4.hitch(this,this._countHandler);},__msigns:[{n:"execute",c:4,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForIds",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForCount",c:3,a:[{i:0,p:["geometry"]}],e:2}],onComplete:function(){},onExecuteRelationshipQueryComplete:function(){},onExecuteForIdsComplete:function(){},onExecuteForCountComplete:function(){},execute:function(_8,_9,_a,_b,_c){var _d=_c.assembly,_e=this._encode(_4.mixin({},this._url.query,{f:"json"},_8.toJson(_d&&_d[0]))),_f=this._handler,_10=this._errorHandler;return esri.request({url:this._url.path+"/query",content:_e,callbackParamName:"callback",load:function(r,i){_f(r,i,_9,_a,_c.dfd);},error:function(r){_10(r,_a,_c.dfd);},callbackSuffix:_b});},executeRelationshipQuery:function(_11,_12,_13){var _14=this._encode(_4.mixin({},this._url.query,{f:"json"},_11.toJson())),_15=this._relationshipQueryHandler,_16=this._errorHandler;var dfd=new _4.Deferred(esri._dfdCanceller);dfd._pendingDfd=esri.request({url:this._url.path+"/queryRelatedRecords",content:_14,callbackParamName:"callback",load:function(r,i){_15(r,i,_12,_13,dfd);},error:function(r){_16(r,_13,dfd);}});return dfd;},executeForIds:function(_17,_18,_19,_1a){var _1b=_1a.assembly,_1c=this._encode(_4.mixin({},this._url.query,{f:"json",returnIdsOnly:true},_17.toJson(_1b&&_1b[0]))),_1d=this._executeForIdsHandler,_1e=this._errorHandler;return esri.request({url:this._url.path+"/query",content:_1c,callbackParamName:"callback",load:function(r,i){_1d(r,i,_18,_19,_1a.dfd);},error:function(r){_1e(r,_19,_1a.dfd);}});},executeForCount:function(_1f,_20,_21,_22){var _23=_22.assembly,_24=this._encode(_4.mixin({},this._url.query,{f:"json",returnIdsOnly:true,returnCountOnly:true},_1f.toJson(_23&&_23[0]))),_25=this._countHandler,_26=this._errorHandler;return esri.request({url:this._url.path+"/query",content:_24,callbackParamName:"callback",load:function(r,i){_25(r,i,_20,_21,_22.dfd);},error:function(r){_26(r,_21,_22.dfd);}});},_handler:function(_27,io,_28,_29,dfd){try{var _2a=new esri.tasks.FeatureSet(_27);this._successHandler([_2a],"onComplete",_28,dfd);}catch(err){this._errorHandler(err,_29,dfd);}},_relationshipQueryHandler:function(_2b,io,_2c,_2d,dfd){try{var gt=_2b.geometryType,sr=_2b.spatialReference,_2e={};_4.forEach(_2b.relatedRecordGroups,function(gr){var _2f={};_2f.geometryType=gt;_2f.spatialReference=sr;_2f.features=gr.relatedRecords;var _30=new esri.tasks.FeatureSet(_2f);_2e[gr.objectId]=_30;});this._successHandler([_2e],"onExecuteRelationshipQueryComplete",_2c,dfd);}catch(err){this._errorHandler(err,_2d,dfd);}},_executeForIdsHandler:function(_31,io,_32,_33,dfd){try{this._successHandler([_31.objectIds],"onExecuteForIdsComplete",_32,dfd);}catch(err){this._errorHandler(err,_33,dfd);}},_countHandler:function(_34,io,_35,_36,dfd){try{var _37,_38=_34.features,ids=_34.objectIds;if(ids){_37=ids.length;}else{if(_38){throw new Error(esri.bundle.tasks.query.invalid);}else{_37=_34.count;}}this._successHandler([_37],"onExecuteForCountComplete",_35,dfd);}catch(err){this._errorHandler(err,_36,dfd);}}});esri._createWrappers("esri.tasks.QueryTask");_4.declare("esri.tasks.Query",null,{constructor:function(){this.spatialRelationship=esri.tasks.Query.SPATIAL_REL_INTERSECTS;},text:null,where:"",geometry:null,objectIds:null,returnGeometry:false,outSpatialReference:null,outFields:null,timeExtent:null,relationParam:null,toJson:function(_39){var _3a={text:this.text,where:this.where,returnGeometry:this.returnGeometry,spatialRel:this.spatialRelationship,maxAllowableOffset:this.maxAllowableOffset},g=_39&&_39["geometry"]||this.geometry,ids=this.objectIds,_3b=this.outFields,_3c=this.outSpatialReference;if(g){_3a.geometry=g;_3a.geometryType=esri.geometry.getJsonType(g);_3a.inSR=g.spatialReference.wkid||_4.toJson(g.spatialReference.toJson());}if(ids){_3a.objectIds=ids.join(",");}if(_3b){_3a.outFields=_3b.join(",");}if(_3c!==null){_3a.outSR=_3c.wkid||_4.toJson(_3c.toJson());}else{if(g){_3a.outSR=g.spatialReference.wkid||_4.toJson(g.spatialReference.toJson());}}var _3d=this.timeExtent;_3a.time=_3d?_3d.toJson().join(","):null;var _3e=this.relationParam;if(_3e&&this.spatialRelationship===esri.tasks.Query.SPATIAL_REL_RELATION){_3a.relationParam=_3e;}_3a._ts=this._ts;return _3a;}});_4.mixin(esri.tasks.Query,esri.tasks._SpatialRelationship);_4.declare("esri.tasks.RelationshipQuery",null,{definitionExpression:"",relationshipId:null,returnGeometry:false,objectIds:null,outSpatialReference:null,outFields:null,toJson:function(){var _3f={definitionExpression:this.definitionExpression,relationshipId:this.relationshipId,returnGeometry:this.returnGeometry,maxAllowableOffset:this.maxAllowableOffset},_40=this.objectIds,_41=this.outFields,_42=this.outSpatialReference;if(_40){_3f.objectIds=_40.join(",");}if(_41){_3f.outFields=_41.join(",");}if(_42){_3f.outSR=_42.toJson();}_3f._ts=this._ts;return _3f;}});}}};});