/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


window[esri._dojoScopeName||"dojo"]._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dijit._editor.RichText"],["require","dijit._Widget"],["require","dijit._CssStateMixin"],["require","dijit._editor.selection"],["require","dijit._editor.range"],["require","dijit._editor.html"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dijit._editor.RichText"]){_4._hasResource["dijit._editor.RichText"]=true;_4.provide("dijit._editor.RichText");_4.require("dijit._Widget");_4.require("dijit._CssStateMixin");_4.require("dijit._editor.selection");_4.require("dijit._editor.range");_4.require("dijit._editor.html");if(!_4.config["useXDomain"]||_4.config["allowXdRichTextSave"]){if(_4._postLoad){(function(){var _7=_4.doc.createElement("textarea");_7.id=_5._scopeName+"._editor.RichText.value";_4.style(_7,{display:"none",position:"absolute",top:"-100px",height:"3px",width:"3px"});_4.body().appendChild(_7);})();}else{try{_4.doc.write("<textarea id=\""+_5._scopeName+"._editor.RichText.value\" "+"style=\"display:none;position:absolute;top:-100px;left:-100px;height:3px;width:3px;overflow:hidden;\"></textarea>");}catch(e){}}}_4.declare("dijit._editor.RichText",[_5._Widget,_5._CssStateMixin],{constructor:function(_8){this.contentPreFilters=[];this.contentPostFilters=[];this.contentDomPreFilters=[];this.contentDomPostFilters=[];this.editingAreaStyleSheets=[];this.events=[].concat(this.events);this._keyHandlers={};if(_8&&_4.isString(_8.value)){this.value=_8.value;}this.onLoadDeferred=new _4.Deferred();},baseClass:"dijitEditor",inheritWidth:false,focusOnLoad:false,name:"",styleSheets:"",height:"300px",minHeight:"1em",isClosed:true,isLoaded:false,_SEPARATOR:"@@**%%__RICHTEXTBOUNDRY__%%**@@",_NAME_CONTENT_SEP:"@@**%%:%%**@@",onLoadDeferred:null,isTabIndent:false,disableSpellCheck:false,postCreate:function(){if("textarea"==this.domNode.tagName.toLowerCase()){console.warn("RichText should not be used with the TEXTAREA tag.  See dijit._editor.RichText docs.");}this.contentPreFilters=[_4.hitch(this,"_preFixUrlAttributes")].concat(this.contentPreFilters);if(_4.isMoz){this.contentPreFilters=[this._normalizeFontStyle].concat(this.contentPreFilters);this.contentPostFilters=[this._removeMozBogus].concat(this.contentPostFilters);}if(_4.isWebKit){this.contentPreFilters=[this._removeWebkitBogus].concat(this.contentPreFilters);this.contentPostFilters=[this._removeWebkitBogus].concat(this.contentPostFilters);}if(_4.isIE){this.contentPostFilters=[this._normalizeFontStyle].concat(this.contentPostFilters);}this.inherited(arguments);_4.publish(_5._scopeName+"._editor.RichText::init",[this]);this.open();this.setupDefaultShortcuts();},setupDefaultShortcuts:function(){var _9=_4.hitch(this,function(_a,_b){return function(){return !this.execCommand(_a,_b);};});var _c={b:_9("bold"),i:_9("italic"),u:_9("underline"),a:_9("selectall"),s:function(){this.save(true);},m:function(){this.isTabIndent=!this.isTabIndent;},"1":_9("formatblock","h1"),"2":_9("formatblock","h2"),"3":_9("formatblock","h3"),"4":_9("formatblock","h4"),"\\":_9("insertunorderedlist")};if(!_4.isIE){_c.Z=_9("redo");}for(var _d in _c){this.addKeyHandler(_d,true,false,_c[_d]);}},events:["onKeyPress","onKeyDown","onKeyUp"],captureEvents:[],_editorCommandsLocalized:false,_localizeEditorCommands:function(){if(_5._editor._editorCommandsLocalized){this._local2NativeFormatNames=_5._editor._local2NativeFormatNames;this._native2LocalFormatNames=_5._editor._native2LocalFormatNames;return;}_5._editor._editorCommandsLocalized=true;_5._editor._local2NativeFormatNames={};_5._editor._native2LocalFormatNames={};this._local2NativeFormatNames=_5._editor._local2NativeFormatNames;this._native2LocalFormatNames=_5._editor._native2LocalFormatNames;var _e=["div","p","pre","h1","h2","h3","h4","h5","h6","ol","ul","address"];var _f="",_10,i=0;while((_10=_e[i++])){if(_10.charAt(1)!=="l"){_f+="<"+_10+"><span>content</span></"+_10+"><br/>";}else{_f+="<"+_10+"><li>content</li></"+_10+"><br/>";}}var _11={position:"absolute",top:"0px",zIndex:10,opacity:0.01};var div=_4.create("div",{style:_11,innerHTML:_f});_4.body().appendChild(div);var _12=_4.hitch(this,function(){var _13=div.firstChild;while(_13){try{_5._editor.selection.selectElement(_13.firstChild);var _14=_13.tagName.toLowerCase();this._local2NativeFormatNames[_14]=document.queryCommandValue("formatblock");this._native2LocalFormatNames[this._local2NativeFormatNames[_14]]=_14;_13=_13.nextSibling.nextSibling;}catch(e){}}div.parentNode.removeChild(div);div.innerHTML="";});setTimeout(_12,0);},open:function(_15){if(!this.onLoadDeferred||this.onLoadDeferred.fired>=0){this.onLoadDeferred=new _4.Deferred();}if(!this.isClosed){this.close();}_4.publish(_5._scopeName+"._editor.RichText::open",[this]);if(arguments.length==1&&_15.nodeName){this.domNode=_15;}var dn=this.domNode;var _16;if(_4.isString(this.value)){_16=this.value;delete this.value;dn.innerHTML="";}else{if(dn.nodeName&&dn.nodeName.toLowerCase()=="textarea"){var ta=(this.textarea=dn);this.name=ta.name;_16=ta.value;dn=this.domNode=_4.doc.createElement("div");dn.setAttribute("widgetId",this.id);ta.removeAttribute("widgetId");dn.cssText=ta.cssText;dn.className+=" "+ta.className;_4.place(dn,ta,"before");var _17=_4.hitch(this,function(){_4.style(ta,{display:"block",position:"absolute",top:"-1000px"});if(_4.isIE){var s=ta.style;this.__overflow=s.overflow;s.overflow="hidden";}});if(_4.isIE){setTimeout(_17,10);}else{_17();}if(ta.form){var _18=ta.value;this.reset=function(){var _19=this.getValue();if(_19!=_18){this.replaceValue(_18);}};_4.connect(ta.form,"onsubmit",this,function(){_4.attr(ta,"disabled",this.disabled);ta.value=this.getValue();});}}else{_16=_5._editor.getChildrenHtml(dn);dn.innerHTML="";}}var _1a=_4.contentBox(dn);this._oldHeight=_1a.h;this._oldWidth=_1a.w;this.value=_16;if(dn.nodeName&&dn.nodeName=="LI"){dn.innerHTML=" <br>";}this.header=dn.ownerDocument.createElement("div");dn.appendChild(this.header);this.editingArea=dn.ownerDocument.createElement("div");dn.appendChild(this.editingArea);this.footer=dn.ownerDocument.createElement("div");dn.appendChild(this.footer);if(!this.name){this.name=this.id+"_AUTOGEN";}if(this.name!==""&&(!_4.config["useXDomain"]||_4.config["allowXdRichTextSave"])){var _1b=_4.byId(_5._scopeName+"._editor.RichText.value");if(_1b&&_1b.value!==""){var _1c=_1b.value.split(this._SEPARATOR),i=0,dat;while((dat=_1c[i++])){var _1d=dat.split(this._NAME_CONTENT_SEP);if(_1d[0]==this.name){_16=_1d[1];_1c=_1c.splice(i,1);_1b.value=_1c.join(this._SEPARATOR);break;}}}if(!_5._editor._globalSaveHandler){_5._editor._globalSaveHandler={};_4.addOnUnload(function(){var id;for(id in _5._editor._globalSaveHandler){var f=_5._editor._globalSaveHandler[id];if(_4.isFunction(f)){f();}}});}_5._editor._globalSaveHandler[this.id]=_4.hitch(this,"_saveContent");}this.isClosed=false;var ifr=(this.editorObject=this.iframe=_4.doc.createElement("iframe"));ifr.id=this.id+"_iframe";this._iframeSrc=this._getIframeDocTxt();ifr.style.border="none";ifr.style.width="100%";if(this._layoutMode){ifr.style.height="100%";}else{if(_4.isIE>=7){if(this.height){ifr.style.height=this.height;}if(this.minHeight){ifr.style.minHeight=this.minHeight;}}else{ifr.style.height=this.height?this.height:this.minHeight;}}ifr.frameBorder=0;ifr._loadFunc=_4.hitch(this,function(win){this.window=win;this.document=this.window.document;if(_4.isIE){this._localizeEditorCommands();}this.onLoad(_16);});var s="javascript:parent."+_5._scopeName+".byId(\""+this.id+"\")._iframeSrc";ifr.setAttribute("src",s);this.editingArea.appendChild(ifr);if(_4.isSafari<=4){var src=ifr.getAttribute("src");if(!src||src.indexOf("javascript")==-1){setTimeout(function(){ifr.setAttribute("src",s);},0);}}if(dn.nodeName=="LI"){dn.lastChild.style.marginTop="-1.2em";}_4.addClass(this.domNode,this.baseClass);},_local2NativeFormatNames:{},_native2LocalFormatNames:{},_getIframeDocTxt:function(){var _1e=_4.getComputedStyle(this.domNode);var _1f="";var _20=true;if(_4.isIE||_4.isWebKit||(!this.height&&!_4.isMoz)){_1f="<div id='dijitEditorBody'></div>";_20=false;}else{if(_4.isMoz){this._cursorToStart=true;_1f="&nbsp;";}}var _21=[_1e.fontWeight,_1e.fontSize,_1e.fontFamily].join(" ");var _22=_1e.lineHeight;if(_22.indexOf("px")>=0){_22=parseFloat(_22)/parseFloat(_1e.fontSize);}else{if(_22.indexOf("em")>=0){_22=parseFloat(_22);}else{_22="normal";}}var _23="";var _24=this;this.style.replace(/(^|;)\s*(line-|font-?)[^;]+/ig,function(_25){_25=_25.replace(/^;/ig,"")+";";var s=_25.split(":")[0];if(s){s=_4.trim(s);s=s.toLowerCase();var i;var sC="";for(i=0;i<s.length;i++){var c=s.charAt(i);switch(c){case "-":i++;c=s.charAt(i).toUpperCase();default:sC+=c;}}_4.style(_24.domNode,sC,"");}_23+=_25+";";});var _26=_4.query("label[for=\""+this.id+"\"]");return [this.isLeftToRight()?"<html>\n<head>\n":"<html dir='rtl'>\n<head>\n",(_4.isMoz&&_26.length?"<title>"+_26[0].innerHTML+"</title>\n":""),"<meta http-equiv='Content-Type' content='text/html'>\n","<style>\n","\tbody,html {\n","\t\tbackground:transparent;\n","\t\tpadding: 1px 0 0 0;\n","\t\tmargin: -1px 0 0 0;\n",((_4.isWebKit)?"\t\twidth: 100%;\n":""),((_4.isWebKit)?"\t\theight: 100%;\n":""),"\t}\n","\tbody{\n","\t\ttop:0px;\n","\t\tleft:0px;\n","\t\tright:0px;\n","\t\tfont:",_21,";\n",((this.height||_4.isOpera)?"":"\t\tposition: fixed;\n"),"\t\tmin-height:",this.minHeight,";\n","\t\tline-height:",_22,";\n","\t}\n","\tp{ margin: 1em 0; }\n",(!_20&&!this.height?"\tbody,html {overflow-y: hidden;}\n":""),"\t#dijitEditorBody{overflow-x: auto; overflow-y:"+(this.height?"auto;":"hidden;")+" outline: 0px;}\n","\tli > ul:-moz-first-node, li > ol:-moz-first-node{ padding-top: 1.2em; }\n",(!_4.isIE?"\tli{ min-height:1.2em; }\n":""),"</style>\n",this._applyEditingAreaStyleSheets(),"\n","</head>\n<body ",(_20?"id='dijitEditorBody' ":""),"onload='frameElement._loadFunc(window,document)' style='"+_23+"'>",_1f,"</body>\n</html>"].join("");},_applyEditingAreaStyleSheets:function(){var _27=[];if(this.styleSheets){_27=this.styleSheets.split(";");this.styleSheets="";}_27=_27.concat(this.editingAreaStyleSheets);this.editingAreaStyleSheets=[];var _28="",i=0,url;while((url=_27[i++])){var _29=(new _4._Url(_4.global.location,url)).toString();this.editingAreaStyleSheets.push(_29);_28+="<link rel=\"stylesheet\" type=\"text/css\" href=\""+_29+"\"/>";}return _28;},addStyleSheet:function(uri){var url=uri.toString();if(url.charAt(0)=="."||(url.charAt(0)!="/"&&!uri.host)){url=(new _4._Url(_4.global.location,url)).toString();}if(_4.indexOf(this.editingAreaStyleSheets,url)>-1){return;}this.editingAreaStyleSheets.push(url);this.onLoadDeferred.addCallback(_4.hitch(this,function(){if(this.document.createStyleSheet){this.document.createStyleSheet(url);}else{var _2a=this.document.getElementsByTagName("head")[0];var _2b=this.document.createElement("link");_2b.rel="stylesheet";_2b.type="text/css";_2b.href=url;_2a.appendChild(_2b);}}));},removeStyleSheet:function(uri){var url=uri.toString();if(url.charAt(0)=="."||(url.charAt(0)!="/"&&!uri.host)){url=(new _4._Url(_4.global.location,url)).toString();}var _2c=_4.indexOf(this.editingAreaStyleSheets,url);if(_2c==-1){return;}delete this.editingAreaStyleSheets[_2c];_4.withGlobal(this.window,"query",_4,["link:[href=\""+url+"\"]"]).orphan();},disabled:false,_mozSettingProps:{"styleWithCSS":false},_setDisabledAttr:function(_2d){_2d=!!_2d;this._set("disabled",_2d);if(!this.isLoaded){return;}if(_4.isIE||_4.isWebKit||_4.isOpera){var _2e=_4.isIE&&(this.isLoaded||!this.focusOnLoad);if(_2e){this.editNode.unselectable="on";}this.editNode.contentEditable=!_2d;if(_2e){var _2f=this;setTimeout(function(){_2f.editNode.unselectable="off";},0);}}else{try{this.document.designMode=(_2d?"off":"on");}catch(e){return;}if(!_2d&&this._mozSettingProps){var ps=this._mozSettingProps;for(var n in ps){if(ps.hasOwnProperty(n)){try{this.document.execCommand(n,false,ps[n]);}catch(e2){}}}}}this._disabledOK=true;},onLoad:function(_30){if(!this.window.__registeredWindow){this.window.__registeredWindow=true;this._iframeRegHandle=_5.registerIframe(this.iframe);}if(!_4.isIE&&!_4.isWebKit&&(this.height||_4.isMoz)){this.editNode=this.document.body;}else{this.editNode=this.document.body.firstChild;var _31=this;if(_4.isIE){this.tabStop=_4.create("div",{tabIndex:-1},this.editingArea);this.iframe.onfocus=function(){_31.editNode.setActive();};}}this.focusNode=this.editNode;var _32=this.events.concat(this.captureEvents);var ap=this.iframe?this.document:this.editNode;_4.forEach(_32,function(_33){this.connect(ap,_33.toLowerCase(),_33);},this);this.connect(ap,"onmouseup","onClick");if(_4.isIE){this.connect(this.document,"onmousedown","_onIEMouseDown");this.editNode.style.zoom=1;}else{this.connect(this.document,"onmousedown",function(){delete this._cursorToStart;});}if(_4.isWebKit){this._webkitListener=this.connect(this.document,"onmouseup","onDisplayChanged");this.connect(this.document,"onmousedown",function(e){var t=e.target;if(t&&(t===this.document.body||t===this.document)){setTimeout(_4.hitch(this,"placeCursorAtEnd"),0);}});}if(_4.isIE){try{this.document.execCommand("RespectVisibilityInDesign",true,null);}catch(e){}}this.isLoaded=true;this.set("disabled",this.disabled);var _34=_4.hitch(this,function(){this.setValue(_30);if(this.onLoadDeferred){this.onLoadDeferred.callback(true);}this.onDisplayChanged();if(this.focusOnLoad){_4.addOnLoad(_4.hitch(this,function(){setTimeout(_4.hitch(this,"focus"),this.updateInterval);}));}this.value=this.getValue(true);});if(this.setValueDeferred){this.setValueDeferred.addCallback(_34);}else{_34();}},onKeyDown:function(e){if(e.keyCode===_4.keys.TAB&&this.isTabIndent){_4.stopEvent(e);if(this.queryCommandEnabled((e.shiftKey?"outdent":"indent"))){this.execCommand((e.shiftKey?"outdent":"indent"));}}if(_4.isIE){if(e.keyCode==_4.keys.TAB&&!this.isTabIndent){if(e.shiftKey&&!e.ctrlKey&&!e.altKey){this.iframe.focus();}else{if(!e.shiftKey&&!e.ctrlKey&&!e.altKey){this.tabStop.focus();}}}else{if(e.keyCode===_4.keys.BACKSPACE&&this.document.selection.type==="Control"){_4.stopEvent(e);this.execCommand("delete");}else{if((65<=e.keyCode&&e.keyCode<=90)||(e.keyCode>=37&&e.keyCode<=40)){e.charCode=e.keyCode;this.onKeyPress(e);}}}}return true;},onKeyUp:function(e){return;},setDisabled:function(_35){_4.deprecated("dijit.Editor::setDisabled is deprecated","use dijit.Editor::attr(\"disabled\",boolean) instead",2);this.set("disabled",_35);},_setValueAttr:function(_36){this.setValue(_36);},_setDisableSpellCheckAttr:function(_37){if(this.document){_4.attr(this.document.body,"spellcheck",!_37);}else{this.onLoadDeferred.addCallback(_4.hitch(this,function(){_4.attr(this.document.body,"spellcheck",!_37);}));}this._set("disableSpellCheck",_37);},onKeyPress:function(e){var c=(e.keyChar&&e.keyChar.toLowerCase())||e.keyCode,_38=this._keyHandlers[c],_39=arguments;if(_38&&!e.altKey){_4.some(_38,function(h){if(!(h.shift^e.shiftKey)&&!(h.ctrl^(e.ctrlKey||e.metaKey))){if(!h.handler.apply(this,_39)){e.preventDefault();}return true;}},this);}if(!this._onKeyHitch){this._onKeyHitch=_4.hitch(this,"onKeyPressed");}setTimeout(this._onKeyHitch,1);return true;},addKeyHandler:function(key,_3a,_3b,_3c){if(!_4.isArray(this._keyHandlers[key])){this._keyHandlers[key]=[];}this._keyHandlers[key].push({shift:_3b||false,ctrl:_3a||false,handler:_3c});},onKeyPressed:function(){this.onDisplayChanged();},onClick:function(e){this.onDisplayChanged(e);},_onIEMouseDown:function(e){if(!this._focused&&!this.disabled){this.focus();}},_onBlur:function(e){this.inherited(arguments);var _3d=this.getValue(true);if(_3d!=this.value){this.onChange(_3d);}this._set("value",_3d);},_onFocus:function(e){if(!this.disabled){if(!this._disabledOK){this.set("disabled",false);}this.inherited(arguments);}},blur:function(){if(!_4.isIE&&this.window.document.documentElement&&this.window.document.documentElement.focus){this.window.document.documentElement.focus();}else{if(_4.doc.body.focus){_4.doc.body.focus();}}},focus:function(){if(!this.isLoaded){this.focusOnLoad=true;return;}if(this._cursorToStart){delete this._cursorToStart;if(this.editNode.childNodes){this.placeCursorAtStart();return;}}if(!_4.isIE){_5.focus(this.iframe);}else{if(this.editNode&&this.editNode.focus){this.iframe.fireEvent("onfocus",document.createEventObject());}}},updateInterval:200,_updateTimer:null,onDisplayChanged:function(e){if(this._updateTimer){clearTimeout(this._updateTimer);}if(!this._updateHandler){this._updateHandler=_4.hitch(this,"onNormalizedDisplayChanged");}this._updateTimer=setTimeout(this._updateHandler,this.updateInterval);},onNormalizedDisplayChanged:function(){delete this._updateTimer;},onChange:function(_3e){},_normalizeCommand:function(cmd,_3f){var _40=cmd.toLowerCase();if(_40=="formatblock"){if(_4.isSafari&&_3f===undefined){_40="heading";}}else{if(_40=="hilitecolor"&&!_4.isMoz){_40="backcolor";}}return _40;},_qcaCache:{},queryCommandAvailable:function(_41){var ca=this._qcaCache[_41];if(ca!==undefined){return ca;}return (this._qcaCache[_41]=this._queryCommandAvailable(_41));},_queryCommandAvailable:function(_42){var ie=1;var _43=1<<1;var _44=1<<2;var _45=1<<3;function _46(_47){return {ie:Boolean(_47&ie),mozilla:Boolean(_47&_43),webkit:Boolean(_47&_44),opera:Boolean(_47&_45)};};var _48=null;switch(_42.toLowerCase()){case "bold":case "italic":case "underline":case "subscript":case "superscript":case "fontname":case "fontsize":case "forecolor":case "hilitecolor":case "justifycenter":case "justifyfull":case "justifyleft":case "justifyright":case "delete":case "selectall":case "toggledir":_48=_46(_43|ie|_44|_45);break;case "createlink":case "unlink":case "removeformat":case "inserthorizontalrule":case "insertimage":case "insertorderedlist":case "insertunorderedlist":case "indent":case "outdent":case "formatblock":case "inserthtml":case "undo":case "redo":case "strikethrough":case "tabindent":_48=_46(_43|ie|_45|_44);break;case "blockdirltr":case "blockdirrtl":case "dirltr":case "dirrtl":case "inlinedirltr":case "inlinedirrtl":_48=_46(ie);break;case "cut":case "copy":case "paste":_48=_46(ie|_43|_44);break;case "inserttable":_48=_46(_43|ie);break;case "insertcell":case "insertcol":case "insertrow":case "deletecells":case "deletecols":case "deleterows":case "mergecells":case "splitcell":_48=_46(ie|_43);break;default:return false;}return (_4.isIE&&_48.ie)||(_4.isMoz&&_48.mozilla)||(_4.isWebKit&&_48.webkit)||(_4.isOpera&&_48.opera);},execCommand:function(_49,_4a){var _4b;this.focus();_49=this._normalizeCommand(_49,_4a);if(_4a!==undefined){if(_49=="heading"){throw new Error("unimplemented");}else{if((_49=="formatblock")&&_4.isIE){_4a="<"+_4a+">";}}}var _4c="_"+_49+"Impl";if(this[_4c]){_4b=this[_4c](_4a);}else{_4a=arguments.length>1?_4a:null;if(_4a||_49!="createlink"){_4b=this.document.execCommand(_49,false,_4a);}}this.onDisplayChanged();return _4b;},queryCommandEnabled:function(_4d){if(this.disabled||!this._disabledOK){return false;}_4d=this._normalizeCommand(_4d);if(_4.isMoz||_4.isWebKit){if(_4d=="unlink"){return this._sCall("hasAncestorElement",["a"]);}else{if(_4d=="inserttable"){return true;}}}if(_4.isWebKit){if(_4d=="cut"||_4d=="copy"){var sel=this.window.getSelection();if(sel){sel=sel.toString();}return !!sel;}else{if(_4d=="paste"){return true;}}}var _4e=_4.isIE?this.document.selection.createRange():this.document;try{return _4e.queryCommandEnabled(_4d);}catch(e){return false;}},queryCommandState:function(_4f){if(this.disabled||!this._disabledOK){return false;}_4f=this._normalizeCommand(_4f);try{return this.document.queryCommandState(_4f);}catch(e){return false;}},queryCommandValue:function(_50){if(this.disabled||!this._disabledOK){return false;}var r;_50=this._normalizeCommand(_50);if(_4.isIE&&_50=="formatblock"){r=this._native2LocalFormatNames[this.document.queryCommandValue(_50)];}else{if(_4.isMoz&&_50==="hilitecolor"){var _51;try{_51=this.document.queryCommandValue("styleWithCSS");}catch(e){_51=false;}this.document.execCommand("styleWithCSS",false,true);r=this.document.queryCommandValue(_50);this.document.execCommand("styleWithCSS",false,_51);}else{r=this.document.queryCommandValue(_50);}}return r;},_sCall:function(_52,_53){return _4.withGlobal(this.window,_52,_5._editor.selection,_53);},placeCursorAtStart:function(){this.focus();var _54=false;if(_4.isMoz){var _55=this.editNode.firstChild;while(_55){if(_55.nodeType==3){if(_55.nodeValue.replace(/^\s+|\s+$/g,"").length>0){_54=true;this._sCall("selectElement",[_55]);break;}}else{if(_55.nodeType==1){_54=true;var tg=_55.tagName?_55.tagName.toLowerCase():"";if(/br|input|img|base|meta|area|basefont|hr|link/.test(tg)){this._sCall("selectElement",[_55]);}else{this._sCall("selectElementChildren",[_55]);}break;}}_55=_55.nextSibling;}}else{_54=true;this._sCall("selectElementChildren",[this.editNode]);}if(_54){this._sCall("collapse",[true]);}},placeCursorAtEnd:function(){this.focus();var _56=false;if(_4.isMoz){var _57=this.editNode.lastChild;while(_57){if(_57.nodeType==3){if(_57.nodeValue.replace(/^\s+|\s+$/g,"").length>0){_56=true;this._sCall("selectElement",[_57]);break;}}else{if(_57.nodeType==1){_56=true;if(_57.lastChild){this._sCall("selectElement",[_57.lastChild]);}else{this._sCall("selectElement",[_57]);}break;}}_57=_57.previousSibling;}}else{_56=true;this._sCall("selectElementChildren",[this.editNode]);}if(_56){this._sCall("collapse",[false]);}},getValue:function(_58){if(this.textarea){if(this.isClosed||!this.isLoaded){return this.textarea.value;}}return this._postFilterContent(null,_58);},_getValueAttr:function(){return this.getValue(true);},setValue:function(_59){if(!this.isLoaded){this.onLoadDeferred.addCallback(_4.hitch(this,function(){this.setValue(_59);}));return;}this._cursorToStart=true;if(this.textarea&&(this.isClosed||!this.isLoaded)){this.textarea.value=_59;}else{_59=this._preFilterContent(_59);var _5a=this.isClosed?this.domNode:this.editNode;if(_59&&_4.isMoz&&_59.toLowerCase()=="<p></p>"){_59="<p>&nbsp;</p>";}if(!_59&&_4.isWebKit){_59="&nbsp;";}_5a.innerHTML=_59;this._preDomFilterContent(_5a);}this.onDisplayChanged();this._set("value",this.getValue(true));},replaceValue:function(_5b){if(this.isClosed){this.setValue(_5b);}else{if(this.window&&this.window.getSelection&&!_4.isMoz){this.setValue(_5b);}else{if(this.window&&this.window.getSelection){_5b=this._preFilterContent(_5b);this.execCommand("selectall");if(!_5b){this._cursorToStart=true;_5b="&nbsp;";}this.execCommand("inserthtml",_5b);this._preDomFilterContent(this.editNode);}else{if(this.document&&this.document.selection){this.setValue(_5b);}}}}this._set("value",this.getValue(true));},_preFilterContent:function(_5c){var ec=_5c;_4.forEach(this.contentPreFilters,function(ef){if(ef){ec=ef(ec);}});return ec;},_preDomFilterContent:function(dom){dom=dom||this.editNode;_4.forEach(this.contentDomPreFilters,function(ef){if(ef&&_4.isFunction(ef)){ef(dom);}},this);},_postFilterContent:function(dom,_5d){var ec;if(!_4.isString(dom)){dom=dom||this.editNode;if(this.contentDomPostFilters.length){if(_5d){dom=_4.clone(dom);}_4.forEach(this.contentDomPostFilters,function(ef){dom=ef(dom);});}ec=_5._editor.getChildrenHtml(dom);}else{ec=dom;}if(!_4.trim(ec.replace(/^\xA0\xA0*/,"").replace(/\xA0\xA0*$/,"")).length){ec="";}_4.forEach(this.contentPostFilters,function(ef){ec=ef(ec);});return ec;},_saveContent:function(e){var _5e=_4.byId(_5._scopeName+"._editor.RichText.value");if(_5e.value){_5e.value+=this._SEPARATOR;}_5e.value+=this.name+this._NAME_CONTENT_SEP+this.getValue(true);},escapeXml:function(str,_5f){str=str.replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/gm,"&quot;");if(!_5f){str=str.replace(/'/gm,"&#39;");}return str;},getNodeHtml:function(_60){_4.deprecated("dijit.Editor::getNodeHtml is deprecated","use dijit._editor.getNodeHtml instead",2);return _5._editor.getNodeHtml(_60);},getNodeChildrenHtml:function(dom){_4.deprecated("dijit.Editor::getNodeChildrenHtml is deprecated","use dijit._editor.getChildrenHtml instead",2);return _5._editor.getChildrenHtml(dom);},close:function(_61){if(this.isClosed){return;}if(!arguments.length){_61=true;}if(_61){this._set("value",this.getValue(true));}if(this.interval){clearInterval(this.interval);}if(this._webkitListener){this.disconnect(this._webkitListener);delete this._webkitListener;}if(_4.isIE){this.iframe.onfocus=null;}this.iframe._loadFunc=null;if(this._iframeRegHandle){_5.unregisterIframe(this._iframeRegHandle);delete this._iframeRegHandle;}if(this.textarea){var s=this.textarea.style;s.position="";s.left=s.top="";if(_4.isIE){s.overflow=this.__overflow;this.__overflow=null;}this.textarea.value=this.value;_4.destroy(this.domNode);this.domNode=this.textarea;}else{this.domNode.innerHTML=this.value;}delete this.iframe;_4.removeClass(this.domNode,this.baseClass);this.isClosed=true;this.isLoaded=false;delete this.editNode;delete this.focusNode;if(this.window&&this.window._frameElement){this.window._frameElement=null;}this.window=null;this.document=null;this.editingArea=null;this.editorObject=null;},destroy:function(){if(!this.isClosed){this.close(false);}this.inherited(arguments);if(_5._editor._globalSaveHandler){delete _5._editor._globalSaveHandler[this.id];}},_removeMozBogus:function(_62){return _62.replace(/\stype="_moz"/gi,"").replace(/\s_moz_dirty=""/gi,"").replace(/_moz_resizing="(true|false)"/gi,"");},_removeWebkitBogus:function(_63){_63=_63.replace(/\sclass="webkit-block-placeholder"/gi,"");_63=_63.replace(/\sclass="apple-style-span"/gi,"");_63=_63.replace(/<meta charset=\"utf-8\" \/>/gi,"");return _63;},_normalizeFontStyle:function(_64){return _64.replace(/<(\/)?strong([ \>])/gi,"<$1b$2").replace(/<(\/)?em([ \>])/gi,"<$1i$2");},_preFixUrlAttributes:function(_65){return _65.replace(/(?:(<a(?=\s).*?\shref=)("|')(.*?)\2)|(?:(<a\s.*?href=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl=$2$3$5$2").replace(/(?:(<img(?=\s).*?\ssrc=)("|')(.*?)\2)|(?:(<img\s.*?src=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl=$2$3$5$2");},_inserthorizontalruleImpl:function(_66){if(_4.isIE){return this._inserthtmlImpl("<hr>");}return this.document.execCommand("inserthorizontalrule",false,_66);},_unlinkImpl:function(_67){if((this.queryCommandEnabled("unlink"))&&(_4.isMoz||_4.isWebKit)){var a=this._sCall("getAncestorElement",["a"]);this._sCall("selectElement",[a]);return this.document.execCommand("unlink",false,null);}return this.document.execCommand("unlink",false,_67);},_hilitecolorImpl:function(_68){var _69;if(_4.isMoz){this.document.execCommand("styleWithCSS",false,true);_69=this.document.execCommand("hilitecolor",false,_68);this.document.execCommand("styleWithCSS",false,false);}else{_69=this.document.execCommand("hilitecolor",false,_68);}return _69;},_backcolorImpl:function(_6a){if(_4.isIE){_6a=_6a?_6a:null;}return this.document.execCommand("backcolor",false,_6a);},_forecolorImpl:function(_6b){if(_4.isIE){_6b=_6b?_6b:null;}return this.document.execCommand("forecolor",false,_6b);},_inserthtmlImpl:function(_6c){_6c=this._preFilterContent(_6c);var rv=true;if(_4.isIE){var _6d=this.document.selection.createRange();if(this.document.selection.type.toUpperCase()=="CONTROL"){var n=_6d.item(0);while(_6d.length){_6d.remove(_6d.item(0));}n.outerHTML=_6c;}else{_6d.pasteHTML(_6c);}_6d.select();}else{if(_4.isMoz&&!_6c.length){this._sCall("remove");}else{rv=this.document.execCommand("inserthtml",false,_6c);}}return rv;},_boldImpl:function(_6e){if(_4.isIE){this._adaptIESelection();}return this.document.execCommand("bold",false,_6e);},_italicImpl:function(_6f){if(_4.isIE){this._adaptIESelection();}return this.document.execCommand("italic",false,_6f);},_underlineImpl:function(_70){if(_4.isIE){this._adaptIESelection();}return this.document.execCommand("underline",false,_70);},_strikethroughImpl:function(_71){if(_4.isIE){this._adaptIESelection();}return this.document.execCommand("strikethrough",false,_71);},getHeaderHeight:function(){return this._getNodeChildrenHeight(this.header);},getFooterHeight:function(){return this._getNodeChildrenHeight(this.footer);},_getNodeChildrenHeight:function(_72){var h=0;if(_72&&_72.childNodes){var i;for(i=0;i<_72.childNodes.length;i++){var _73=_4.position(_72.childNodes[i]);h+=_73.h;}}return h;},_isNodeEmpty:function(_74,_75){if(_74.nodeType==1){if(_74.childNodes.length>0){return this._isNodeEmpty(_74.childNodes[0],_75);}return true;}else{if(_74.nodeType==3){return (_74.nodeValue.substring(_75)=="");}}return false;},_removeStartingRangeFromRange:function(_76,_77){if(_76.nextSibling){_77.setStart(_76.nextSibling,0);}else{var _78=_76.parentNode;while(_78&&_78.nextSibling==null){_78=_78.parentNode;}if(_78){_77.setStart(_78.nextSibling,0);}}return _77;},_adaptIESelection:function(){var _79=_5.range.getSelection(this.window);if(_79&&_79.rangeCount&&!_79.isCollapsed){var _7a=_79.getRangeAt(0);var _7b=_7a.startContainer;var _7c=_7a.startOffset;while(_7b.nodeType==3&&_7c>=_7b.length&&_7b.nextSibling){_7c=_7c-_7b.length;_7b=_7b.nextSibling;}var _7d=null;while(this._isNodeEmpty(_7b,_7c)&&_7b!=_7d){_7d=_7b;_7a=this._removeStartingRangeFromRange(_7b,_7a);_7b=_7a.startContainer;_7c=0;}_79.removeAllRanges();_79.addRange(_7a);}}});}}};});