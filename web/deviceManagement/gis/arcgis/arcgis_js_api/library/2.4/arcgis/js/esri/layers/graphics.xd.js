/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */

window[esri._dojoScopeName||"dojo"]._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","esri.layers.graphics"],["require","esri.layers.layer"],["require","dojox.gfx"],["require","esri.graphic"],["require","esri.renderer"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["esri.layers.graphics"]){_4._hasResource["esri.layers.graphics"]=true;_4.provide("esri.layers.graphics");_4.require("esri.layers.layer");_4.require("dojox.gfx");_4.require("esri.graphic");_4.require("esri.renderer");if(_6.gfx.renderer==="vml"){esri.vml=true;_4.addOnLoad(function(){_4.declare("esri.gfx.Path",_6.gfx.Path,{setShape:function(_7){this.rawNode.path.v=(this.vmlPath=_7);return this;}});esri.gfx.Path.nodeType="shape";var _8=_6.gfx.Shape||_6.gfx.vml.Shape,_9=_8.prototype.setStroke;_8.prototype.setStroke=function(){var _a=_9.apply(this,arguments);var _b=this.rawNode,_c=_b&&_b.stroke,_d=this.getParent();if(_c&&_d){var op=esri._isDefined(_d._esriIeOpacity)?_d._esriIeOpacity:1;_c.opacity*=op;}return _a;};var _e=_8.prototype.setFill;_8.prototype.setFill=function(){var _f=_e.apply(this,arguments);var _10=this.rawNode,_11=_10&&_10.fill,_12=this.getParent();if(_11&&_12){var op=esri._isDefined(_12._esriIeOpacity)?_12._esriIeOpacity:1;if(_11.type==="tile"){_4.style(_10,"opacity",op);}else{_11.opacity*=op;}}return _f;};});}_4.declare("esri.layers._GraphicsContainer",null,{_setMap:function(map,_13){var es,_14=(this._connects=[]);if(_6.gfx.renderer==="canvas"){es=_4.create("div",{style:"overflow: visible; position: absolute;"},_13);this._surface={getEventSource:function(){return es;}};this._map=map;_14.push(_4.connect(es,"onmousedown",this,this._canvasDownHandler));_14.push(_4.connect(es,"onmouseup",this,this._canvasUpHandler));_14.push(_4.connect(es,"onclick",this,this._canvasClickHandler));}else{var _15=(this._surface=_6.gfx.createSurface(_13,map.width,map.height));es=_15.getEventSource();_4.style((es=esri.vml?es.parentNode:es),{overflow:"visible",position:"absolute"});}_14.push(_4.connect(map,"onResize",this,"_onResizeHandler"));return es;},_onResizeHandler:function(_16,_17,_18){var es=this._surface.getEventSource();if(esri.vml){_4.style((es=es.parentNode),{width:_17+"px",height:_18+"px",clip:"rect(0px "+_17+"px "+_18+"px 0px)"});}_4.attr(es,"width",_17);_4.attr(es,"height",_18);if(!this._surface.declaredClass){_4.forEach(es.childNodes,function(_19){_4.attr(_19,"width",_17);_4.attr(_19,"height",_18);});}},_cleanUp:function(){_4.forEach(this._connects,_4.disconnect,_4);this._map=this._surface=null;},_processEvent:function(evt){var map=this._map;evt.screenPoint=new esri.geometry.Point(evt.pageX-map.position.x,evt.pageY-map.position.y);evt.mapPoint=map.toMap(evt.screenPoint);},_canvasDownHandler:function(evt){this._processEvent(evt);this._downPt=evt.screenPoint.x+","+evt.screenPoint.y;},_canvasUpHandler:function(evt){this._processEvent(evt);this._upPt=evt.screenPoint.x+","+evt.screenPoint.y;},_tolerance:15,_canvasClickHandler:function(evt){if(!this._downPt||!this._upPt||this._downPt!==this._upPt){return;}this._processEvent(evt);var map=this._map;var _1a=_4.map(map.graphicsLayerIds,function(id){return map.getLayer(id);});_1a.push(map.graphics);_1a.reverse();_1a=_4.filter(_1a,function(_1b){return _1b.loaded&&_1b._mouseEvents&&_1b.visible&&(!esri._isDefined(_1b.opacity)||_1b.opacity>0);});var _1c=evt.screenPoint,geo=esri.geometry,_1d=this._tolerance;var _1e=_1c.x-_1d,_1f=_1c.y+_1d;var _20=_1c.x+_1d,_21=_1c.y-_1d;var _22=new geo.Extent(_1e,_21,_20,_1f);var _23=map.toMap(new geo.Point(_1e,_1f));var _24=map.toMap(new geo.Point(_20,_21));var _25=new geo.Extent(_23.x,_23.y,_24.x,_24.y);var _26,_27=esri.isTouchEnabled;_4.some(_1a,function(_28){var _29=_4.filter(_28.graphics,function(_2a){var _2b=_2a.getDojoShape();if(!_2a.visible||!_2b){return false;}var _2c=_2b.getTransformedBoundingBox();if(_2c){var _2d=new geo.Extent(_2c[0].x,_2c[0].y,_2c[2].x,_2c[2].y);return _27?_2d.intersects(_22):_2d.contains(_1c);}else{return _4.some(_2b.children||[],function(_2e){_2c=_2e.getTransformedBoundingBox();var _2f=new geo.Extent(_2c[0].x,_2c[0].y,_2c[2].x,_2c[2].y);return _27?_2f.intersects(_22):_2f.contains(_1c);});}});if(_29.length>0){var _30;_4.some(_29,function(_31){if(_31.geometry&&_25.intersects(_31.geometry)){_30=_31;return true;}return false;});if(_30){_26=_30;return true;}}return false;});if(_26){var _32=_26.getLayer();if(_32){evt.graphic=_26;_32.onClick(evt);}}}});_4.declare("esri.layers._GraphicsLayer",esri.layers.Layer,{constructor:function(_33){if(_33&&(_4.isString(_33)||(_4.isObject(_33)&&_33.layerDefinition))){_33=arguments[1];}this._params=_4.mixin({displayOnPan:true,drawMode:true},_33||{});this.infoTemplate=_33&&_33.infoTemplate;this.graphics=[];this._init=false;this._suspended=false;this._draw=_4.hitch(this,this._draw);this._refresh=_4.hitch(this,this._refresh);},setDrawMode:function(_34){this._params.drawMode=_34;},renderer:null,_setMap:function(map,_35){this._map=map;var _36=map.spatialReference;this._wrap=map.wrapAround180;this._srInfo=_36._getInfo();if(_35.declaredClass){this._div=_35.createGroup();}else{_35=_6.gfx.createSurface(_35.getEventSource(),map.width,map.height);_4.style(_35.rawNode,"position","absolute");this._div=_35.createGroup();this._div.getEventSource=function(){return _35.rawNode;};this._renderProto=this._div.constructor.prototype._render;this._div._render=_4.hitch(this,this._canvasRender);}this._div.getEventSource().id=this.id+"_layer";this._enableAllConnectors();this._updateStatus();if(!this._suspended&&map.extent&&map.loaded===true){this._onExtentChangeHandler(map.extent,null,null,null);}var op=this.opacity;if(esri._isDefined(op)&&op<1){this.setOpacity(op,true);}return this._div;},_unsetMap:function(map,_37){_4.forEach(this.graphics,function(g){g._shape=null;});if(_37.declaredClass){this._div.clear();_37.remove(this._div);_4.destroy(this._div.getEventSource());}else{_37=this._div.getParent();_37._parent={};_4.destroy(_37.rawNode);_37.destroy();}this._map=this._div=null;this._init=false;this._disableAllConnectors();},_onZoomStartHandler:function(_38,_39,_3a){esri.hide(this._div.getEventSource());},_onExtentChangeHandler:function(_3b,_3c,_3d,lod){if(_3d||!this._init){var _3e=this._map.__visibleRect,_3f=this._div;this._init=true;this._refresh(true);_3f.setTransform(_6.gfx.matrix.translate({x:_3e.x,y:_3e.y}));if(this._renderProto&&_3f.surface.pendingRender){this._dirty=true;}else{if(this.visible){esri.show(_3f.getEventSource());}}if(this.graphics.length>0){this.onUpdate();}}},_canvasRender:function(){var _40=this._div;if(this._dirty){delete this._dirty;if(this.visible){esri.show(_40.getEventSource());}}return this._renderProto.apply(_40,arguments);},_refresh:function(_41){var gs=this.graphics,il=gs.length,i,_42=this._draw;for(i=0;i<il;i++){_42(gs[i],_41);}},refresh:function(){this._refresh(true);},_onPanHandler:function(_43,_44){this._panDx=_44.x;this._panDy=_44.y;var _45=this._map.__visibleRect;this._div.setTransform(_6.gfx.matrix.translate({x:_45.x+_44.x,y:_45.y+_44.y}));},_onPanStartHandler:function(_46,_47){esri.hide(this._div.getEventSource());},_onPanEndUpdateHandler:function(_48,_49){if(_49.x!==this._panDx||_49.y!==this._panDy){var _4a=this._map.__visibleRect;this._div.setTransform(_6.gfx.matrix.translate({x:_4a.x,y:_4a.y}));}this._refresh(false);if(this.graphics.length){this.onUpdate();}},_onPanEndHandler:function(_4b,_4c){var _4d=this._map.__visibleRect,_4e=this._div;_4e.setTransform(_6.gfx.matrix.translate({x:_4d.x,y:_4d.y}));this._refresh(false);if(this._renderProto&&_4e.surface.pendingRender){this._dirty=true;}else{esri.show(_4e.getEventSource());}if(this.graphics.length){this.onUpdate();}},_getDesiredStatus:function(){return this.visible;},_updateStatus:function(){if(this._getDesiredStatus()){if(this._suspended){this._resume();}}else{if(!this._suspended){this._suspend();}}},_suspend:function(){this._suspended=true;esri.hide(this._div.getEventSource());this._disableDrawConnectors();},_resume:function(){var _4f=this._div;this._suspended=false;this._enableDrawConnectors();var _50=this._map.__visibleRect;_4f.setTransform(_6.gfx.matrix.translate({x:_50.x,y:_50.y}));this._refresh(true);if(this._renderProto&&_4f.surface.pendingRender){this._dirty=true;}else{esri.show(_4f.getEventSource());}},_enableAllConnectors:function(){this._disableAllConnectors();this._onVisibilityChangeHandler_connect=_4.connect(this,"onVisibilityChange",this,this._updateStatus);this._enableDrawConnectors();},_disableAllConnectors:function(){this._disableDrawConnectors();_4.disconnect(this._onVisibilityChangeHandler_connect);},_enableDrawConnectors:function(){var map=this._map,dc=_4.connect;this._disableDrawConnectors();if(this._params.displayOnPan){this._onPanHandler_connect=dc(map,"onPan",this,"_onPanHandler");this._onPanEndHandler_connect=dc(map,"onPanEnd",this,"_onPanEndUpdateHandler");}else{this._onPanStartHandler_connect=dc(map,"onPanStart",this,"_onPanStartHandler");this._onPanEndHandler_connect=dc(map,"onPanEnd",this,"_onPanEndHandler");}this._onZoomStartHandler_connect=dc(map,"onZoomStart",this,"_onZoomStartHandler");this._onExtentChangeHandler_connect=dc(map,"onExtentChange",this,"_onExtentChangeHandler");},_disableDrawConnectors:function(){var dd=_4.disconnect;dd(this._onExtentChangeHandler_connect);dd(this._onZoomStartHandler_connect);dd(this._onPanHandler_connect);dd(this._onPanStartHandler_connect);dd(this._onPanEndHandler_connect);},_updateExtent:function(_51){var _52=_51.geometry,eg=esri.geometry;if(!_52){_51._extent=null;return;}var _53=(_51._extent=_52.getExtent());if(!_53){var x,y;if(_52 instanceof eg.Point){x=_52.x;y=_52.y;}else{if(_52 instanceof eg.Multipoint){x=_52.points[0][0];y=_52.points[0][1];}else{_51._extent=null;return;}}_51._extent=new eg.Extent(x,y,x,y,_52.spatialReference);}},_intersects:function(map,_54,_55){if(this._wrap&&!_55){var _56=[],_57=map._getFrameWidth(),_58=this._srInfo,_59,_5a=map._clip?map._getAvailExtent():map.extent,_5b=_5a._getParts(_58),g,m,f,gl,ml,fl,_5c,_5d,_5e=[],_5f=_54._partwise;if(_5f&&_5f.length){_59=[];for(g=0,gl=_5f.length;g<gl;g++){_59=_59.concat(_5f[g]._getParts(_58));}}else{_59=_54._getParts(_58);}for(g=0,gl=_59.length;g<gl;g++){_5c=_59[g];for(m=0,ml=_5b.length;m<ml;m++){_5d=_5b[m];if(_5d.extent.intersects(_5c.extent)){for(f=0,fl=_5c.frameIds.length;f<fl;f++){_56.push((_5d.frameIds[0]-_5c.frameIds[f])*_57);}}}}for(g=0,gl=_56.length;g<gl;g++){f=_56[g];if(_4.indexOf(_56,f)===g){_5e.push(f);}}return (_5e.length)?_5e:null;}else{return map.extent.intersects(_54)?[0]:null;}},_draw:function(_60,_61){if(!this._params.drawMode||!this._map){return;}try{var _62=_60._extent,_63;if(_60.visible&&_62&&(_63=this._intersects(this._map,_62,_60.geometry._originOnly))){if(!_60.getDojoShape()||_61||_63){var _64=_60.geometry.type;if(_64==="point"){this._drawMarker(_60,_63);this._symbolizeMarker(_60);}else{if(_64==="multipoint"){this._drawMarkers(_60,_63);this._symbolizeMarkers(_60);}else{this._drawShape(_60,_63);this._symbolizeShape(_60);}}}}else{if(_60.getDojoShape()){this._removeShape(_60);}}}catch(err){this._errorHandler(err,_60);}},_removeShape:function(_65){var _66=_65.getDojoShape();_66.removeShape();_65._shape=null;},_drawShape:function(_67,_68){var _69=_67.geometry,_6a=_69.type,map=this._map,me=map.extent,mw=map.width,mh=map.height,eg=esri.geometry,_6b=map.__visibleRect,_6c=[],i,il;if(_6a==="rect"||_6a==="extent"){var _6d;if(_6a==="extent"){_6d=eg.toScreenGeometry(me,mw,mh,_69);_6d={x:_6d.xmin-_6b.x+_68[0],y:_6d.ymax-_6b.y,width:_6d.getWidth(),height:_6d.getHeight()};}else{var xy=eg.toScreenPoint(me,mw,mh,_69),wh=eg.toScreenPoint(me,mw,mh,{x:_69.x+_69.width,y:_69.y+_69.height});_6d={x:xy.x-_6b.x+_68[0],y:xy.y-_6b.y,width:wh.x-xy.x,height:xy.y-wh.y};}if(_6d.width===0){_6d.width=1;}if(_6d.height===0){_6d.height=1;}_67._shape=this._drawRect(this._div,_67.getDojoShape(),_6d);}else{if(_6a==="polyline"||_6a==="polygon"){for(i=0,il=_68.length;i<il;i++){_6c=_6c.concat(eg._toScreenPath(me,mw,mh,_69,-_6b.x+_68[i],-_6b.y));}_67._shape=this._drawPath(this._div,_67.getDojoShape(),_6c);if(this._rendererLimits){if(_6a==="polyline"){this._clipPolyline(_67._shape,_69);}else{this._clipPolygon(_67._shape,_69);}}}}},_drawRect:function(_6e,_6f,_70){return _6f?_6f.setShape(_70):_6e.createRect(_70);},_drawImage:function(_71,_72,_73){return _72?_72.setShape(_73):_71.createImage(_73);},_drawCircle:function(_74,_75,_76){return _75?_75.setShape(_76):_74.createCircle(_76);},_drawPath:(function(){if(esri.vml){return function(_77,_78,_79){if(_78){return _78.setShape(_79.join(" "));}else{var p=_77.createObject(esri.gfx.Path,_79.join(" "));_77._overrideSize(p.getEventSource());return p;}};}else{return function(_7a,_7b,_7c){return _7b?_7b.setShape(_7c.join(" ")):_7a.createPath(_7c.join(" "));};}}()),_drawText:function(_7d,_7e,_7f){return _7e?_7e.setShape(_7f):_7d.createText(_7f);},_getSymbol:function(_80){return _80.symbol||(this.renderer?this.renderer.getSymbol(_80):null)||null;},_symbolizeShape:function(_81){var _82=this._getSymbol(_81);var _83=_82._stroke,_84=_82._fill;if(_83===null||_84===null){_83=_82.getStroke();_84=_82.getFill();}_81.getDojoShape().setStroke(_83).setFill(_84);_82._stroke=_83;_82._fill=_84;},_smsToPath:(function(){if(esri.vml){return function(SMS,_85,x,y,xMh,xPh,yMh,yPh,_86){switch(_85){case SMS.STYLE_SQUARE:return ["M",xMh+","+yMh,"L",xPh+","+yMh,xPh+","+yPh,xMh+","+yPh,"X","E"];case SMS.STYLE_CROSS:return ["M",x+","+yMh,"L",x+","+yPh,"M",xMh+","+y,"L",xPh+","+y,"E"];case SMS.STYLE_X:return ["M",xMh+","+yMh,"L",xPh+","+yPh,"M",xMh+","+yPh,"L",xPh+","+yMh,"E"];case SMS.STYLE_DIAMOND:return ["M",x+","+yMh,"L",xPh+","+y,x+","+yPh,xMh+","+y,"X","E"];case SMS.STYLE_TARGET:return ["M",xMh+","+yMh,"L",xPh+","+yMh,xPh+","+yPh,xMh+","+yPh,xMh+","+yMh,"M",(xMh-_86)+","+y,"L",xMh+","+y,"M",x+","+(yMh-_86),"L",x+","+yMh,"M",(xPh+_86)+","+y,"L",xPh+","+y,"M",x+","+(yPh+_86),"L",x+","+yPh,"E"];}};}else{return function(SMS,_87,x,y,xMh,xPh,yMh,yPh,_88){switch(_87){case SMS.STYLE_SQUARE:return ["M",xMh+","+yMh,xPh+","+yMh,xPh+","+yPh,xMh+","+yPh,"Z"];case SMS.STYLE_CROSS:return ["M",x+","+yMh,x+","+yPh,"M",xMh+","+y,xPh+","+y];case SMS.STYLE_X:return ["M",xMh+","+yMh,xPh+","+yPh,"M",xMh+","+yPh,xPh+","+yMh];case SMS.STYLE_DIAMOND:return ["M",x+","+yMh,xPh+","+y,x+","+yPh,xMh+","+y,"Z"];case SMS.STYLE_TARGET:return ["M",xMh+","+yMh,xPh+","+yMh,xPh+","+yPh,xMh+","+yPh,xMh+","+yMh,"M",(xMh-_88)+","+y,xMh+","+y,"M",x+","+(yMh-_88),x+","+yMh,"M",(xPh+_88)+","+y,xPh+","+y,"M",x+","+(yPh+_88),x+","+yPh];}};}}()),_drawPoint:function(_89,_8a,_8b,_8c,_8d){var _8e=_8b.type,map=this._map,_8f=map.__visibleRect,_90=esri.geometry.toScreenPoint(map.extent,map.width,map.height,_8a).offset(-_8f.x+_8d[0],-_8f.y),px=_90.x,py=_90.y,_91;if(_8e==="simplemarkersymbol"){var _92=_8b.style,_93=_8b.size/2,_94=Math.round,SMS=esri.symbol.SimpleMarkerSymbol;switch(_92){case SMS.STYLE_SQUARE:case SMS.STYLE_CROSS:case SMS.STYLE_X:case SMS.STYLE_DIAMOND:_91=this._drawPath(_89,_8c,this._smsToPath(SMS,_92,px,py,_94(px-_93),_94(px+_93),_94(py-_93),_94(py+_93)));break;case SMS.STYLE_TARGET:var _95=_8b._targetWidth/2,_96=_8b._targetHeight/2;_91=this._drawPath(_89,_8c,this._smsToPath(SMS,_92,px,py,_94(px-_95),_94(px+_95),_94(py-_96),_94(py+_96),_8b._spikeSize));break;default:_91=this._drawCircle(_89,_8c,{cx:px,cy:py,r:_93});}}else{if(_8e==="picturemarkersymbol"){var w=_8b.width,h=_8b.height;_91=this._drawImage(_89,_8c,{x:px-(w/2),y:py-(h/2),width:w,height:h,src:_8b.url});}else{if(_8e==="textsymbol"){_91=this._drawText(_89,_8c,{type:"text",text:_8b.text,x:px,y:py,align:_8b.align,decoration:_8b.decoration,rotated:_8b.rotated,kerning:_8b.kerning});}}}_91.setTransform(_6.gfx.matrix.multiply(_6.gfx.matrix.translate(_8b.xoffset,-_8b.yoffset),_6.gfx.matrix.rotategAt(_8b.angle,_90)));_91._wrapOffsets=_8d;return _91;},_symbolizePoint:function(_97,_98){var _99=_98.type;if(_99==="picturemarkersymbol"){return;}var _9a=_98._stroke,_9b=_98._fill;if(_99==="textsymbol"){_97.setFont(_98.font).setFill(_98.getFill());}else{if(_9a===null||_9b===null){_9a=_98.getStroke();_9b=_98.getFill();}if(_99==="simplemarkersymbol"){_97.setFill(_9b).setStroke(_9a);}_98._stroke=_9a;_98._fill=_9b;}},_drawMarker:function(_9c,_9d){_9c._shape=this._drawPoint(this._div,_9c.geometry,this._getSymbol(_9c),_9c.getDojoShape(),_9d);},_symbolizeMarker:function(_9e){this._symbolizePoint(_9e.getDojoShape(),this._getSymbol(_9e));},_drawMarkers:function(_9f,_a0){var _a1=_9f.geometry,_a2=_a1.points,_a3=this._getSymbol(_9f),_a4=_9f.getDojoShape()||this._div.createGroup(),_a5,i,il=_a2.length,_a6=[],idx=0;for(i=0;i<il;i++){_a5=_a2[i];_4.forEach(_a0,function(_a7){_a6[0]=_a7;this._drawPoint(_a4,{x:_a5[0],y:_a5[1]},_a3,_a4.children[idx++],_a6);},this);}var _a8=_a4.children.length;if(il*_a0.length<_a8){for(i=_a8-1;i>=il*_a0.length;i--){_a4.children[i].removeShape();}}_9f._shape=_a4;},_symbolizeMarkers:function(_a9){var _aa=this._getSymbol(_a9),_ab=_a9.getDojoShape(),_ac=_ab.children,i,il=_ac.length;for(i=0;i<il;i++){this._symbolizePoint(_ac[i],_aa);}},_errorHandler:function(err,_ad){var msg=esri.bundle.layers.graphics.drawingError;if(_ad){err.message=msg+"(geometry:"+(_ad.geometry?_ad.geometry.declaredClass:null)+", symbol:"+(_ad.symbol?_ad.symbol.declaredClass:null)+"): "+err.message;}else{err.message=msg+"(null): "+err.message;}this.inherited(arguments);},_rendererLimits:(function(){var _ae,_af,_b0;if(_4.isFF){_ae=16125;_af=-32250;_b0=32250;}else{if(_4.isIE<9){_ae=100000;_af=-100000;_b0=100000;}else{if(_4.isChrome&&_4.isChrome<6){_ae=8150;_af=-10000;_b0=10000;}}}if(_ae){var _b1,_b2;_b1=[-_ae,-_ae,_ae,_ae];_b2=[[[-_ae,-_ae],[_ae,-_ae]],[[_ae,-_ae],[_ae,_ae]],[[_ae,_ae],[-_ae,_ae]],[[-_ae,_ae],[-_ae,-_ae]]];return {clipLimit:_ae,rangeMin:_af,rangeMax:_b0,clipBBox:_b1,clipSegments:_b2};}}()),_clipPolyline:function(_b3,_b4){var _b5=this._getCorners(_b3,_b4);var _b6=_b5.tl,_b7=_b5.br;var _b8=this._rendererLimits;var _b9=_b8.rangeMin,_ba=_b8.rangeMax,_bb=_b8.clipBBox,_bc=_b8.clipSegments;var _bd=this._isPointWithinRange,_be=this._isPointWithinBBox,_bf=this._getClipperIntersection,_c0=this._getPlaneIndex;if(!_bd(_b6,_b9,_ba)||!_bd(_b7,_b9,_ba)){if(esri.vml){this._createSegments(_b3);}var _c1=[];_4.forEach(_b3.segments,function(_c2){var _c3=_c2.args,len=_c3.length,_c4=[],i;for(i=0;i<len;i+=2){var pt1=[_c3[i],_c3[i+1]];var pt2=[_c3[i+2],_c3[i+3]];var _c5=_be(pt1,_bb);var _c6=_be(pt2,_bb);if(_c5^_c6){var _c7=_bf([pt1,pt2],_bc);if(_c7){if(!_c5){_c4.push(_c7[1],pt2);}else{if(i){_c4.push(_c7[1]);}else{_c4.push(pt1,_c7[1]);}_c1.push(_c4);_c4=[];}}}else{if(_c5){if(i){_c4.push(pt2);}else{_c4.push(pt1,pt2);}}else{var _c8=_c0(pt1,_bb);var _c9=_c0(pt2,_bb);if(_c8===-1||_c9===-1||_c8===_c9){continue;}var _ca=_bf([pt1,pt2],_bc,true);if(_ca.length>0){if(!_ca[_c8]){_c8=_ca[_c8[0]]?_c8[0]:_c8[1];}if(!_ca[_c9]){_c9=_ca[_c9[0]]?_c9[0]:_c9[1];}var _cb=_ca[_c8],_cc=_ca[_c9];if(_cb){_c4.push(_cb);}if(_cc){_c4.push(_cc);_c1.push(_c4);_c4=[];}}}}}_c1.push(_c4);});_b3.setShape(this._getPathStringFromPaths(_c1));}},_clipPolygon:function(_cd,_ce){var _cf=this._getCorners(_cd,_ce);var _d0=_cf.tl,_d1=_cf.br;var _d2=this._rendererLimits;var _d3=_d2.clipLimit,_d4=_d2.rangeMin,_d5=_d2.rangeMax,_d6=_d2.clipBBox,_d7=_d2.clipSegments;var _d8=this._isPointWithinRange,_d9=this._isPointWithinBBox,_da=this._getClipperIntersection,_db=this._getPlaneIndex,_dc=esri.geometry._pointLineDistance;if(!_d8(_d0,_d4,_d5)||!_d8(_d1,_d4,_d5)){if(esri.vml){this._createSegments(_cd);}var _dd=_4.map(_cd.segments,function(_de){var _df=_de.args,len=_df.length,_e0=[],_e1=[],i;for(i=0;i<len;i+=2){var pt1=[_df[i],_df[i+1]];var pt2=[_df[i+2],_df[i+3]];if(i===(len-2)){_e0.push(pt1);break;}var _e2=_d9(pt1,_d6);var _e3=_d9(pt2,_d6);_e0.push(pt1);if(_e2^_e3){var _e4=_da([pt1,pt2],_d7);if(_e4){var _e5=_e4[1];_e5[_e2?"inOut":"outIn"]=true;_e0.push(_e5);_e1.push([_e2?"INOUT":"OUTIN",_e0.length-1,_e4[0]]);}}else{if(!_e2){var _e6=_db(pt1,_d6);var _e7=_db(pt2,_d6);if(_e6===-1||_e7===-1||_e6===_e7){continue;}var _e4=_da([pt1,pt2],_d7,true);if(_e4.length>0){if(!_e4[_e6]){_e6=_e4[_e6[0]]?_e6[0]:_e6[1];}if(!_e4[_e7]){_e7=_e4[_e7[0]]?_e7[0]:_e7[1];}var _e8=_e4[_e6],_e9=_e4[_e7];if(_e8){_e8.outIn=true;_e0.push(_e8);_e1.push(["OUTIN",_e0.length-1,_e6]);}if(_e9){_e9.inOut=true;_e0.push(_e9);_e1.push(["INOUT",_e0.length-1,_e7]);}}else{if(_4.isArray(_e6)&&_4.isArray(_e7)){var _ea=_e6.concat(_e7);_ea.sort();if(_ea.join("")==="0123"){var _eb=[];if((_e6[0]+_e6[1])===3){_eb.push([_d3,-_d3],[-_d3,_d3]);}else{_eb.push([-_d3,-_d3],[_d3,_d3]);}var d1=_dc(_eb[0],[pt1,pt2]);var d2=_dc(_eb[1],[pt1,pt2]);_e0.push((d1<d2)?_eb[0]:_eb[1]);}}}}}}var _ec=_d6[0],_ed=_d6[1],_ee=_d6[2],_ef=_d6[3];_4.forEach(_e0,function(_f0){if(_f0[0]<_ec){if(_f0[1]>=_ed&&_f0[1]<=_ef){_f0[0]=_ec;}else{_f0[0]=_ec;_f0[1]=_f0[1]<_ed?_ed:_ef;}}});_4.forEach(_e0,function(_f1){if(_f1[1]<_ed){if(_f1[0]>=_ec&&_f1[0]<=_ee){_f1[1]=_ed;}else{_f1[1]=_ed;_f1[0]=_f1[0]<_ec?_ec:_ee;}}});_4.forEach(_e0,function(_f2){if(_f2[0]>_ee){if(_f2[1]>=_ed&&_f2[1]<=_ef){_f2[0]=_ee;}else{_f2[0]=_ee;_f2[1]=_f2[1]<_ed?_ed:_ef;}}});_4.forEach(_e0,function(_f3){if(_f3[1]>_ef){if(_f3[0]>=_ec&&_f3[0]<=_ee){_f3[1]=_ef;}else{_f3[1]=_ef;_f3[0]=_f3[0]<_ec?_ec:_ee;}}});var k=0,len=_e1.length;if(len>0){do{var _f4=_e1[k];var _f5=_e1[(k+1)%len];if(_f4[2]===_f5[2]&&_f4[0]==="INOUT"&&_f5[0]==="OUTIN"){var _f6=_f4[1],end=_f5[1],u;if(_f6<end){for(u=_f6+1;u<end;u++){_e0[u][2]=true;}}else{if(_f6>end){for(u=_f6+1;u<_e0.length;u++){_e0[u][2]=true;}for(u=0;u<end;u++){_e0[u][2]=true;}}}}k=(k+1)%len;}while(k!==0);}var _f7=_e0[0],_f8=_e0[_e0.length-1];if(_f7[2]){_f8[2]=true;_4.some(_e1,function(_f9){if(_f9[1]===1){_e0.splice(_e0.length-1,0,_4.clone(_e0[1]));return true;}return false;});}_e0=_4.filter(_e0,function(_fa){return _fa[2]?false:true;});for(k=0;k<_e0.length-1;k++){var now=_e0[k];var _f5=_e0[k+1];if(!_f5||(now[0]!==_f5[0])||(now[1]!==_f5[1])){continue;}if(_f5.outIn){now.outIn=true;}else{if(_f5.inOut){now.inOut=true;}}_e0.splice(k+1,1);}var abs=Math.abs,_fb=[];for(k=0;k<_e0.length-1;k++){var _f4=_e0[k],cx=_f4[0],cy=_f4[1];var x1=(abs(cx)===_d3);var y1=(abs(cy)===_d3);var _f5=_e0[k+1],nx=_f5[0],ny=_f5[1];var x2=(abs(nx)===_d3);var y2=(abs(ny)===_d3);if(x1&&y2){_fb.push([k+1,[cx,ny]]);}else{if(y1&&x2){_fb.push([k+1,[nx,cy]]);}}}for(k=_fb.length-1;k>=0;k--){var _fc=_fb[k];var _fd=_e0[_fc[0]-1];var now=_e0[_fc[0]];if(_fd.outIn||_fd.inOut||now.outIn||now.inOut){continue;}_e0.splice(_fc[0],0,_fc[1]);}var _f7=_e0[0],_f8=_e0[_e0.length-1];if(_f7[0]!==_f8[0]||_f7[1]!==_f8[1]){_e0.push(_f7);}return _e0;});_cd.setShape(this._getPathStringFromPaths(_dd));}},_getCorners:function(_fe,_ff){if(esri.vml){var map=this._map;var _100=_ff.getExtent();var _101=map.toScreen(new esri.geometry.Point(_100.xmin,_100.ymax));var _102=map.toScreen(new esri.geometry.Point(_100.xmax,_100.ymin));return {tl:_101,br:_102};}else{var _103=_fe.getTransformedBoundingBox();return {tl:_103[0],br:_103[2]};}},_createSegments:function(_104){_104.shape.path=_104.vmlPath;_104.segmented=false;_104._confirmSegmented();var _105=_104.segments;if(_105.length>1){_104.segments=_4.filter(_105,function(_106,idx,arr){var next=arr[idx+1];if(_106.action==="M"&&next&&next.action==="L"){_106.args=_106.args.concat(next.args);return true;}return false;});}},_getPathStringFromPaths:function(_107){if(esri.vml){_107=_4.map(_107,function(path){var _108=_4.map(path,function(_109,idx){return (idx===1?"l ":"")+_109.join(",");});return "m "+_108.join(" ");});_107.push("e");}else{_107=_4.map(_107,function(path){var _10a=_4.map(path,function(_10b){return _10b.join(",");});return "M "+_10a.join(" ");});}return _107.join(" ");},_isPointWithinBBox:function(_10c,bbox){var left=bbox[0],top=bbox[1];var _10d=bbox[2],_10e=bbox[3];var x=_10c[0],y=_10c[1];if(x>left&&x<_10d&&y>top&&y<_10e){return true;}else{return false;}},_isPointWithinRange:function(_10f,_110,_111){var x=_10f.x,y=_10f.y;if(x<_110||y<_110||x>_111||y>_111){return false;}else{return true;}},_getClipperIntersection:function(line,_112,_113){var i,_114=esri.geometry._getLineIntersection2,_115=Math.round,data={length:0};for(i=0;i<4;i++){var _116=_114(line,_112[i]);if(_116){_116[0]=_115(_116[0]);_116[1]=_115(_116[1]);if(!_113){return [i,_116];}else{data[i]=_116;data.length++;}}}return _113?data:null;},_getPlaneIndex:function(_117,_118){var px=_117[0],py=_117[1],xmin=_118[0],ymin=_118[1],xmax=_118[2],ymax=_118[3];if(px<=xmin){if((py>=ymin)&&(py<=ymax)){return 3;}else{return (py<ymin)?[0,3]:[2,3];}}if(py<=ymin){if((px>=xmin)&&(px<=xmax)){return 0;}else{return (px<xmin)?[3,0]:[1,0];}}if(px>=xmax){if((py>=ymin)&&(py<=ymax)){return 1;}else{return (py<ymin)?[0,1]:[2,1];}}if(py>=ymax){if((px>=xmin)&&(px<=xmax)){return 2;}else{return (px<xmin)?[3,2]:[1,2];}}return -1;},onGraphicAdd:function(){},onGraphicRemove:function(){},onGraphicsClear:function(){},onOpacityChange:function(){},setInfoTemplate:function(_119){this.infoTemplate=_119;},add:function(_11a){var _11b=arguments[1],i;if((i=_4.indexOf(this.graphics,_11a))!==-1){return this.graphics[i];}if(!_11b){this.graphics.push(_11a);}_11a._graphicsLayer=this;this._updateExtent(_11a);this._draw(_11a);if(!_11b){this.onGraphicAdd(_11a);}return _11a;},remove:function(_11c){if(!arguments[1]){var _11d=this.graphics,i;if((i=_4.indexOf(_11d,_11c))===-1){return null;}_11c=this.graphics.splice(i,1)[0];}if(_11c.getDojoShape()){this._removeShape(_11c);}_11c._shape=_11c._graphicsLayer=null;this.onGraphicRemove(_11c);return _11c;},clear:function(){var _11e=arguments[1],g=this.graphics;while(g.length>0){this.remove(g[0]);}if(!_11e){this.onGraphicsClear();}},setOpacity:function(op,_11f){if(_11f||this.opacity!=op){var div=this._div;if(div){if(esri.vml){_4.forEach(this.graphics,function(_120){var _121=_120._shape;var node=_121&&_121.getNode();if(node){var _122=_121.strokeStyle,_123=node.stroke;if(_122&&_123){_123.opacity=_122.color.a*op;}var _124=_121.fillStyle,fill=node.fill;if(_124&&fill){if(fill.type==="tile"){_4.style(node,"opacity",op);}else{fill.opacity=_124.a*op;}}}});div._esriIeOpacity=op;}else{if(this._renderProto){_4.style(div.getEventSource(),"opacity",op);}else{div.getEventSource().setAttribute("opacity",op);}}}this.opacity=op;if(!_11f){this.onOpacityChange(op);}}},setRenderer:function(ren){this.renderer=ren;}});_4.declare("esri.layers.GraphicsLayer",esri.layers._GraphicsLayer,{constructor:function(){this.enableMouseEvents=_4.hitch(this,this.enableMouseEvents);this.disableMouseEvents=_4.hitch(this,this.disableMouseEvents);this._processEvent=_4.hitch(this,this._processEvent);this._initLayer();},_initLayer:function(){this.loaded=true;this.onLoad(this);},_setMap:function(map,_125){var d=this.inherited("_setMap",arguments);this.enableMouseEvents();return d;},_unsetMap:function(map,_126){this.disableMouseEvents();this.inherited("_unsetMap",arguments);},_processEvent:function(evt){var _127=this._map,g=this.graphics,gl=g.length;evt.screenPoint=new esri.geometry.Point(evt.pageX-_127.position.x,evt.pageY-_127.position.y);evt.mapPoint=_127.toMap(evt.screenPoint);var i,es,gr,ds,_128=evt.target,_129=_128.parentNode;for(i=0;i<gl;i++){gr=g[i];ds=gr.getDojoShape();if(ds){es=ds.getEventSource();if(es===_128||es===_129){evt.graphic=gr;return evt;}}}},_onMouseOverHandler:function(evt){if(this._processEvent(evt)){this.onMouseOver(evt);}},_onMouseMoveHandler:function(evt){if(this._processEvent(evt)){this.onMouseMove(evt);}},_onMouseDragHandler:function(evt){if(this._processEvent(evt)){this.onMouseDrag(evt);}},_onMouseOutHandler:function(evt){if(this._processEvent(evt)){this.onMouseOut(evt);}},_onMouseDownHandler:function(evt){this._downGr=this._downPt=null;if(this._processEvent(evt)){_4.disconnect(this._onmousemove_connect);_4.disconnect(this._onmousedrag_connect);this._onmousedrag_connect=_4.connect(this._div.getEventSource(),"onmousemove",this,"_onMouseDragHandler");this._downGr=evt.graphic;this._downPt=evt.screenPoint.x+","+evt.screenPoint.y;this.onMouseDown(evt);}},_onMouseUpHandler:function(evt){this._upGr=this._upPt=null;if(this._processEvent(evt)){_4.disconnect(this._onmousedrag_connect);_4.disconnect(this._onmousemove_connect);this._onmousemove_connect=_4.connect(this._div.getEventSource(),"onmousemove",this,"_onMouseMoveHandler");this._upGr=evt.graphic;this._upPt=evt.screenPoint.x+","+evt.screenPoint.y;this.onMouseUp(evt);}},_onClickHandler:function(evt){if(this._processEvent(evt)){var _12a=this._downGr,upGr=this._upGr;if(_12a&&upGr&&_12a===upGr&&this._downPt===this._upPt){if(_4.isIE<9){esri.layers.GraphicsLayer._clicked=evt.graphic;}this.onClick(evt);}}},_onDblClickHandler:function(evt){if(this._processEvent(evt)){this.onDblClick(evt);}},onMouseOver:function(){},onMouseMove:function(){},onMouseDrag:function(){},onMouseOut:function(){},onMouseDown:function(){},onMouseUp:function(){},onClick:function(){},onDblClick:function(){},enableMouseEvents:function(){if(this._mouseEvents){return;}var dc=_4.connect,gc=this._div.getEventSource();if(_6.gfx.renderer!=="canvas"){this._onmouseover_connect=dc(gc,"onmouseover",this,"_onMouseOverHandler");this._onmousemove_connect=dc(gc,"onmousemove",this,"_onMouseMoveHandler");this._onmouseout_connect=dc(gc,"onmouseout",this,"_onMouseOutHandler");this._onmousedown_connect=dc(gc,"onmousedown",this,"_onMouseDownHandler");this._onmouseup_connect=dc(gc,"onmouseup",this,"_onMouseUpHandler");this._onclick_connect=dc(gc,"onclick",this,"_onClickHandler");this._ondblclick_connect=dc(gc,"ondblclick",this,"_onDblClickHandler");}this._mouseEvents=true;},disableMouseEvents:function(){if(!this._mouseEvents){return;}var ddc=_4.disconnect;ddc(this._onmouseover_connect);ddc(this._onmousemove_connect);ddc(this._onmousedrag_connect);ddc(this._onmouseout_connect);ddc(this._onmousedown_connect);ddc(this._onmouseup_connect);ddc(this._onclick_connect);ddc(this._ondblclick_connect);this._mouseEvents=false;}});}}};});