/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

/*
	This is an optimized version of Dojo, built for deployment and not for
	development. To get sources and documentation, please visit:

		http://dojotoolkit.org
*/

if(!dojo._hasResource["dojox.gfx.shape"]){dojo._hasResource["dojox.gfx.shape"]=true;dojo.provide("dojox.gfx.shape");dojo.declare("dojox.gfx.shape.Shape",null,{constructor:function(){this.rawNode=null;this.shape=null;this.matrix=null;this.fillStyle=null;this.strokeStyle=null;this.bbox=null;this.parent=null;this.parentMatrix=null;},getNode:function(){return this.rawNode;},getShape:function(){return this.shape;},getTransform:function(){return this.matrix;},getFill:function(){return this.fillStyle;},getStroke:function(){return this.strokeStyle;},getParent:function(){return this.parent;},getBoundingBox:function(){return this.bbox;},getTransformedBoundingBox:function(){var b=this.getBoundingBox();if(!b){return null;}var m=this._getRealMatrix();gm=dojox.gfx.matrix;return [gm.multiplyPoint(m,b.x,b.y),gm.multiplyPoint(m,b.x+b.width,b.y),gm.multiplyPoint(m,b.x+b.width,b.y+b.height),gm.multiplyPoint(m,b.x,b.y+b.height)];},getEventSource:function(){return this.rawNode;},setShape:function(_1){this.shape=dojox.gfx.makeParameters(this.shape,_1);this.bbox=null;return this;},setFill:function(_2){if(!_2){this.fillStyle=null;return this;}var f=null;if(typeof (_2)=="object"&&"type" in _2){switch(_2.type){case "linear":f=dojox.gfx.makeParameters(dojox.gfx.defaultLinearGradient,_2);break;case "radial":f=dojox.gfx.makeParameters(dojox.gfx.defaultRadialGradient,_2);break;case "pattern":f=dojox.gfx.makeParameters(dojox.gfx.defaultPattern,_2);break;}}else{f=dojox.gfx.normalizeColor(_2);}this.fillStyle=f;return this;},setStroke:function(_3){if(!_3){this.strokeStyle=null;return this;}if(typeof _3=="string"||dojo.isArray(_3)||_3 instanceof dojo.Color){_3={color:_3};}var s=this.strokeStyle=dojox.gfx.makeParameters(dojox.gfx.defaultStroke,_3);s.color=dojox.gfx.normalizeColor(s.color);return this;},setTransform:function(_4){this.matrix=dojox.gfx.matrix.clone(_4?dojox.gfx.matrix.normalize(_4):dojox.gfx.matrix.identity);return this._applyTransform();},_applyTransform:function(){return this;},moveToFront:function(){var p=this.getParent();if(p){p._moveChildToFront(this);this._moveToFront();}return this;},moveToBack:function(){var p=this.getParent();if(p){p._moveChildToBack(this);this._moveToBack();}return this;},_moveToFront:function(){},_moveToBack:function(){},applyRightTransform:function(_5){return _5?this.setTransform([this.matrix,_5]):this;},applyLeftTransform:function(_6){return _6?this.setTransform([_6,this.matrix]):this;},applyTransform:function(_7){return _7?this.setTransform([this.matrix,_7]):this;},removeShape:function(_8){if(this.parent){this.parent.remove(this,_8);}return this;},_setParent:function(_9,_a){this.parent=_9;return this._updateParentMatrix(_a);},_updateParentMatrix:function(_b){this.parentMatrix=_b?dojox.gfx.matrix.clone(_b):null;return this._applyTransform();},_getRealMatrix:function(){var m=this.matrix;var p=this.parent;while(p){if(p.matrix){m=dojox.gfx.matrix.multiply(p.matrix,m);}p=p.parent;}return m;}});dojox.gfx.shape._eventsProcessing={connect:function(_c,_d,_e){return arguments.length>2?dojo.connect(this.getEventSource(),_c,_d,_e):dojo.connect(this.getEventSource(),_c,_d);},disconnect:function(_f){dojo.disconnect(_f);}};dojo.extend(dojox.gfx.shape.Shape,dojox.gfx.shape._eventsProcessing);dojox.gfx.shape.Container={_init:function(){this.children=[];},openBatch:function(){},closeBatch:function(){},add:function(_10){var _11=_10.getParent();if(_11){_11.remove(_10,true);}this.children.push(_10);return _10._setParent(this,this._getRealMatrix());},remove:function(_12,_13){for(var i=0;i<this.children.length;++i){if(this.children[i]==_12){if(_13){}else{_12.parent=null;_12.parentMatrix=null;}this.children.splice(i,1);break;}}return this;},clear:function(){this.children=[];return this;},_moveChildToFront:function(_14){for(var i=0;i<this.children.length;++i){if(this.children[i]==_14){this.children.splice(i,1);this.children.push(_14);break;}}return this;},_moveChildToBack:function(_15){for(var i=0;i<this.children.length;++i){if(this.children[i]==_15){this.children.splice(i,1);this.children.unshift(_15);break;}}return this;}};dojo.declare("dojox.gfx.shape.Surface",null,{constructor:function(){this.rawNode=null;this._parent=null;this._nodes=[];this._events=[];},destroy:function(){dojo.forEach(this._nodes,dojo.destroy);this._nodes=[];dojo.forEach(this._events,dojo.disconnect);this._events=[];this.rawNode=null;if(dojo.isIE){while(this._parent.lastChild){dojo.destroy(this._parent.lastChild);}}else{this._parent.innerHTML="";}this._parent=null;},getEventSource:function(){return this.rawNode;},_getRealMatrix:function(){return null;},isLoaded:true,onLoad:function(_16){},whenLoaded:function(_17,_18){var f=dojo.hitch(_17,_18);if(this.isLoaded){f(this);}else{var h=dojo.connect(this,"onLoad",function(_19){dojo.disconnect(h);f(_19);});}}});dojo.extend(dojox.gfx.shape.Surface,dojox.gfx.shape._eventsProcessing);dojo.declare("dojox.gfx.Point",null,{});dojo.declare("dojox.gfx.Rectangle",null,{});dojo.declare("dojox.gfx.shape.Rect",dojox.gfx.shape.Shape,{constructor:function(_1a){this.shape=dojox.gfx.getDefault("Rect");this.rawNode=_1a;},getBoundingBox:function(){return this.shape;}});dojo.declare("dojox.gfx.shape.Ellipse",dojox.gfx.shape.Shape,{constructor:function(_1b){this.shape=dojox.gfx.getDefault("Ellipse");this.rawNode=_1b;},getBoundingBox:function(){if(!this.bbox){var _1c=this.shape;this.bbox={x:_1c.cx-_1c.rx,y:_1c.cy-_1c.ry,width:2*_1c.rx,height:2*_1c.ry};}return this.bbox;}});dojo.declare("dojox.gfx.shape.Circle",dojox.gfx.shape.Shape,{constructor:function(_1d){this.shape=dojox.gfx.getDefault("Circle");this.rawNode=_1d;},getBoundingBox:function(){if(!this.bbox){var _1e=this.shape;this.bbox={x:_1e.cx-_1e.r,y:_1e.cy-_1e.r,width:2*_1e.r,height:2*_1e.r};}return this.bbox;}});dojo.declare("dojox.gfx.shape.Line",dojox.gfx.shape.Shape,{constructor:function(_1f){this.shape=dojox.gfx.getDefault("Line");this.rawNode=_1f;},getBoundingBox:function(){if(!this.bbox){var _20=this.shape;this.bbox={x:Math.min(_20.x1,_20.x2),y:Math.min(_20.y1,_20.y2),width:Math.abs(_20.x2-_20.x1),height:Math.abs(_20.y2-_20.y1)};}return this.bbox;}});dojo.declare("dojox.gfx.shape.Polyline",dojox.gfx.shape.Shape,{constructor:function(_21){this.shape=dojox.gfx.getDefault("Polyline");this.rawNode=_21;},setShape:function(_22,_23){if(_22&&_22 instanceof Array){this.inherited(arguments,[{points:_22}]);if(_23&&this.shape.points.length){this.shape.points.push(this.shape.points[0]);}}else{this.inherited(arguments,[_22]);}return this;},_normalizePoints:function(){var p=this.shape.points,l=p&&p.length;if(l&&typeof p[0]=="number"){var _24=[];for(var i=0;i<l;i+=2){_24.push({x:p[i],y:p[i+1]});}this.shape.points=_24;}},getBoundingBox:function(){if(!this.bbox&&this.shape.points.length){var p=this.shape.points;var l=p.length;var t=p[0];var _25={l:t.x,t:t.y,r:t.x,b:t.y};for(var i=1;i<l;++i){t=p[i];if(_25.l>t.x){_25.l=t.x;}if(_25.r<t.x){_25.r=t.x;}if(_25.t>t.y){_25.t=t.y;}if(_25.b<t.y){_25.b=t.y;}}this.bbox={x:_25.l,y:_25.t,width:_25.r-_25.l,height:_25.b-_25.t};}return this.bbox;}});dojo.declare("dojox.gfx.shape.Image",dojox.gfx.shape.Shape,{constructor:function(_26){this.shape=dojox.gfx.getDefault("Image");this.rawNode=_26;},getBoundingBox:function(){return this.shape;},setStroke:function(){return this;},setFill:function(){return this;}});dojo.declare("dojox.gfx.shape.Text",dojox.gfx.shape.Shape,{constructor:function(_27){this.fontStyle=null;this.shape=dojox.gfx.getDefault("Text");this.rawNode=_27;},getFont:function(){return this.fontStyle;},setFont:function(_28){this.fontStyle=typeof _28=="string"?dojox.gfx.splitFontString(_28):dojox.gfx.makeParameters(dojox.gfx.defaultFont,_28);this._setFont();return this;}});dojox.gfx.shape.Creator={createShape:function(_29){var gfx=dojox.gfx;switch(_29.type){case gfx.defaultPath.type:return this.createPath(_29);case gfx.defaultRect.type:return this.createRect(_29);case gfx.defaultCircle.type:return this.createCircle(_29);case gfx.defaultEllipse.type:return this.createEllipse(_29);case gfx.defaultLine.type:return this.createLine(_29);case gfx.defaultPolyline.type:return this.createPolyline(_29);case gfx.defaultImage.type:return this.createImage(_29);case gfx.defaultText.type:return this.createText(_29);case gfx.defaultTextPath.type:return this.createTextPath(_29);}return null;},createGroup:function(){return this.createObject(dojox.gfx.Group);},createRect:function(_2a){return this.createObject(dojox.gfx.Rect,_2a);},createEllipse:function(_2b){return this.createObject(dojox.gfx.Ellipse,_2b);},createCircle:function(_2c){return this.createObject(dojox.gfx.Circle,_2c);},createLine:function(_2d){return this.createObject(dojox.gfx.Line,_2d);},createPolyline:function(_2e){return this.createObject(dojox.gfx.Polyline,_2e);},createImage:function(_2f){return this.createObject(dojox.gfx.Image,_2f);},createText:function(_30){return this.createObject(dojox.gfx.Text,_30);},createPath:function(_31){return this.createObject(dojox.gfx.Path,_31);},createTextPath:function(_32){return this.createObject(dojox.gfx.TextPath,{}).setText(_32);},createObject:function(_33,_34){return null;}};}if(!dojo._hasResource["dojox.gfx.path"]){dojo._hasResource["dojox.gfx.path"]=true;dojo.provide("dojox.gfx.path");dojo.declare("dojox.gfx.path.Path",dojox.gfx.shape.Shape,{constructor:function(_35){this.shape=dojo.clone(dojox.gfx.defaultPath);this.segments=[];this.tbbox=null;this.absolute=true;this.last={};this.rawNode=_35;this.segmented=false;},setAbsoluteMode:function(_36){this._confirmSegmented();this.absolute=typeof _36=="string"?(_36=="absolute"):_36;return this;},getAbsoluteMode:function(){this._confirmSegmented();return this.absolute;},getBoundingBox:function(){this._confirmSegmented();return (this.bbox&&("l" in this.bbox))?{x:this.bbox.l,y:this.bbox.t,width:this.bbox.r-this.bbox.l,height:this.bbox.b-this.bbox.t}:null;},_getRealBBox:function(){this._confirmSegmented();if(this.tbbox){return this.tbbox;}var _37=this.bbox,_38=this._getRealMatrix();this.bbox=null;for(var i=0,len=this.segments.length;i<len;++i){this._updateWithSegment(this.segments[i],_38);}var t=this.bbox;this.bbox=_37;this.tbbox=t?[{x:t.l,y:t.t},{x:t.r,y:t.t},{x:t.r,y:t.b},{x:t.l,y:t.b}]:null;return this.tbbox;},getLastPosition:function(){this._confirmSegmented();return "x" in this.last?this.last:null;},_applyTransform:function(){this.tbbox=null;return this.inherited(arguments);},_updateBBox:function(x,y,_39){if(_39){var t=dojox.gfx.matrix.multiplyPoint(_39,x,y);x=t.x;y=t.y;}if(this.bbox&&("l" in this.bbox)){if(this.bbox.l>x){this.bbox.l=x;}if(this.bbox.r<x){this.bbox.r=x;}if(this.bbox.t>y){this.bbox.t=y;}if(this.bbox.b<y){this.bbox.b=y;}}else{this.bbox={l:x,b:y,r:x,t:y};}},_updateWithSegment:function(_3a,_3b){var n=_3a.args,l=n.length;switch(_3a.action){case "M":case "L":case "C":case "S":case "Q":case "T":for(var i=0;i<l;i+=2){this._updateBBox(n[i],n[i+1],_3b);}this.last.x=n[l-2];this.last.y=n[l-1];this.absolute=true;break;case "H":for(var i=0;i<l;++i){this._updateBBox(n[i],this.last.y,_3b);}this.last.x=n[l-1];this.absolute=true;break;case "V":for(var i=0;i<l;++i){this._updateBBox(this.last.x,n[i],_3b);}this.last.y=n[l-1];this.absolute=true;break;case "m":var _3c=0;if(!("x" in this.last)){this._updateBBox(this.last.x=n[0],this.last.y=n[1],_3b);_3c=2;}for(var i=_3c;i<l;i+=2){this._updateBBox(this.last.x+=n[i],this.last.y+=n[i+1],_3b);}this.absolute=false;break;case "l":case "t":for(var i=0;i<l;i+=2){this._updateBBox(this.last.x+=n[i],this.last.y+=n[i+1],_3b);}this.absolute=false;break;case "h":for(var i=0;i<l;++i){this._updateBBox(this.last.x+=n[i],this.last.y,_3b);}this.absolute=false;break;case "v":for(var i=0;i<l;++i){this._updateBBox(this.last.x,this.last.y+=n[i],_3b);}this.absolute=false;break;case "c":for(var i=0;i<l;i+=6){this._updateBBox(this.last.x+n[i],this.last.y+n[i+1],_3b);this._updateBBox(this.last.x+n[i+2],this.last.y+n[i+3],_3b);this._updateBBox(this.last.x+=n[i+4],this.last.y+=n[i+5],_3b);}this.absolute=false;break;case "s":case "q":for(var i=0;i<l;i+=4){this._updateBBox(this.last.x+n[i],this.last.y+n[i+1],_3b);this._updateBBox(this.last.x+=n[i+2],this.last.y+=n[i+3],_3b);}this.absolute=false;break;case "A":for(var i=0;i<l;i+=7){this._updateBBox(n[i+5],n[i+6],_3b);}this.last.x=n[l-2];this.last.y=n[l-1];this.absolute=true;break;case "a":for(var i=0;i<l;i+=7){this._updateBBox(this.last.x+=n[i+5],this.last.y+=n[i+6],_3b);}this.absolute=false;break;}var _3d=[_3a.action];for(var i=0;i<l;++i){_3d.push(dojox.gfx.formatNumber(n[i],true));}if(typeof this.shape.path=="string"){this.shape.path+=_3d.join("");}else{Array.prototype.push.apply(this.shape.path,_3d);}},_validSegments:{m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},_pushSegment:function(_3e,_3f){this.tbbox=null;var _40=this._validSegments[_3e.toLowerCase()];if(typeof _40=="number"){if(_40){if(_3f.length>=_40){var _41={action:_3e,args:_3f.slice(0,_3f.length-_3f.length%_40)};this.segments.push(_41);this._updateWithSegment(_41);}}else{var _41={action:_3e,args:[]};this.segments.push(_41);this._updateWithSegment(_41);}}},_collectArgs:function(_42,_43){for(var i=0;i<_43.length;++i){var t=_43[i];if(typeof t=="boolean"){_42.push(t?1:0);}else{if(typeof t=="number"){_42.push(t);}else{if(t instanceof Array){this._collectArgs(_42,t);}else{if("x" in t&&"y" in t){_42.push(t.x,t.y);}}}}}},moveTo:function(){this._confirmSegmented();var _44=[];this._collectArgs(_44,arguments);this._pushSegment(this.absolute?"M":"m",_44);return this;},lineTo:function(){this._confirmSegmented();var _45=[];this._collectArgs(_45,arguments);this._pushSegment(this.absolute?"L":"l",_45);return this;},hLineTo:function(){this._confirmSegmented();var _46=[];this._collectArgs(_46,arguments);this._pushSegment(this.absolute?"H":"h",_46);return this;},vLineTo:function(){this._confirmSegmented();var _47=[];this._collectArgs(_47,arguments);this._pushSegment(this.absolute?"V":"v",_47);return this;},curveTo:function(){this._confirmSegmented();var _48=[];this._collectArgs(_48,arguments);this._pushSegment(this.absolute?"C":"c",_48);return this;},smoothCurveTo:function(){this._confirmSegmented();var _49=[];this._collectArgs(_49,arguments);this._pushSegment(this.absolute?"S":"s",_49);return this;},qCurveTo:function(){this._confirmSegmented();var _4a=[];this._collectArgs(_4a,arguments);this._pushSegment(this.absolute?"Q":"q",_4a);return this;},qSmoothCurveTo:function(){this._confirmSegmented();var _4b=[];this._collectArgs(_4b,arguments);this._pushSegment(this.absolute?"T":"t",_4b);return this;},arcTo:function(){this._confirmSegmented();var _4c=[];this._collectArgs(_4c,arguments);this._pushSegment(this.absolute?"A":"a",_4c);return this;},closePath:function(){this._confirmSegmented();this._pushSegment("Z",[]);return this;},_confirmSegmented:function(){if(!this.segmented){var _4d=this.shape.path;this.shape.path=[];this._setPath(_4d);this.shape.path=this.shape.path.join("");this.segmented=true;}},_setPath:function(_4e){var p=dojo.isArray(_4e)?_4e:_4e.match(dojox.gfx.pathSvgRegExp);this.segments=[];this.absolute=true;this.bbox={};this.last={};if(!p){return;}var _4f="",_50=[],l=p.length;for(var i=0;i<l;++i){var t=p[i],x=parseFloat(t);if(isNaN(x)){if(_4f){this._pushSegment(_4f,_50);}_50=[];_4f=t;}else{_50.push(x);}}this._pushSegment(_4f,_50);},setShape:function(_51){this.inherited(arguments,[typeof _51=="string"?{path:_51}:_51]);this.segmented=false;this.segments=[];if(!dojox.gfx.lazyPathSegmentation){this._confirmSegmented();}return this;},_2PI:Math.PI*2});dojo.declare("dojox.gfx.path.TextPath",dojox.gfx.path.Path,{constructor:function(_52){if(!("text" in this)){this.text=dojo.clone(dojox.gfx.defaultTextPath);}if(!("fontStyle" in this)){this.fontStyle=dojo.clone(dojox.gfx.defaultFont);}},getText:function(){return this.text;},setText:function(_53){this.text=dojox.gfx.makeParameters(this.text,typeof _53=="string"?{text:_53}:_53);this._setText();return this;},getFont:function(){return this.fontStyle;},setFont:function(_54){this.fontStyle=typeof _54=="string"?dojox.gfx.splitFontString(_54):dojox.gfx.makeParameters(dojox.gfx.defaultFont,_54);this._setFont();return this;}});}if(!dojo._hasResource["dojox.gfx.arc"]){dojo._hasResource["dojox.gfx.arc"]=true;dojo.provide("dojox.gfx.arc");(function(){var m=dojox.gfx.matrix,_55=2*Math.PI,pi4=Math.PI/4,pi8=Math.PI/8,_56=pi4+pi8,_57=_58(pi8);function _58(_59){var _5a=Math.cos(_59),_5b=Math.sin(_59),p2={x:_5a+(4/3)*(1-_5a),y:_5b-(4/3)*_5a*(1-_5a)/_5b};return {s:{x:_5a,y:-_5b},c1:{x:p2.x,y:-p2.y},c2:p2,e:{x:_5a,y:_5b}};};dojox.gfx.arc={unitArcAsBezier:_58,curvePI4:_57,arcAsBezier:function(_5c,rx,ry,_5d,_5e,_5f,x,y){_5e=Boolean(_5e);_5f=Boolean(_5f);var _60=m._degToRad(_5d),rx2=rx*rx,ry2=ry*ry,pa=m.multiplyPoint(m.rotate(-_60),{x:(_5c.x-x)/2,y:(_5c.y-y)/2}),_61=pa.x*pa.x,_62=pa.y*pa.y,c1=Math.sqrt((rx2*ry2-rx2*_62-ry2*_61)/(rx2*_62+ry2*_61));if(isNaN(c1)){c1=0;}var ca={x:c1*rx*pa.y/ry,y:-c1*ry*pa.x/rx};if(_5e==_5f){ca={x:-ca.x,y:-ca.y};}var c=m.multiplyPoint([m.translate((_5c.x+x)/2,(_5c.y+y)/2),m.rotate(_60)],ca);var _63=m.normalize([m.translate(c.x,c.y),m.rotate(_60),m.scale(rx,ry)]);var _64=m.invert(_63),sp=m.multiplyPoint(_64,_5c),ep=m.multiplyPoint(_64,x,y),_65=Math.atan2(sp.y,sp.x),_66=Math.atan2(ep.y,ep.x),_67=_65-_66;if(_5f){_67=-_67;}if(_67<0){_67+=_55;}else{if(_67>_55){_67-=_55;}}var _68=pi8,_69=_57,_6a=_5f?_68:-_68,_6b=[];for(var _6c=_67;_6c>0;_6c-=pi4){if(_6c<_56){_68=_6c/2;_69=_58(_68);_6a=_5f?_68:-_68;_6c=0;}var c1,c2,e,M=m.normalize([_63,m.rotate(_65+_6a)]);if(_5f){c1=m.multiplyPoint(M,_69.c1);c2=m.multiplyPoint(M,_69.c2);e=m.multiplyPoint(M,_69.e);}else{c1=m.multiplyPoint(M,_69.c2);c2=m.multiplyPoint(M,_69.c1);e=m.multiplyPoint(M,_69.s);}_6b.push([c1.x,c1.y,c2.x,c2.y,e.x,e.y]);_65+=2*_6a;}return _6b;}};})();}if(!dojo._hasResource["dojox.gfx.decompose"]){dojo._hasResource["dojox.gfx.decompose"]=true;dojo.provide("dojox.gfx.decompose");(function(){var m=dojox.gfx.matrix;function eq(a,b){return Math.abs(a-b)<=0.000001*(Math.abs(a)+Math.abs(b));};function _6d(r1,m1,r2,m2){if(!isFinite(r1)){return r2;}else{if(!isFinite(r2)){return r1;}}m1=Math.abs(m1),m2=Math.abs(m2);return (m1*r1+m2*r2)/(m1+m2);};function _6e(_6f){var M=new m.Matrix2D(_6f);return dojo.mixin(M,{dx:0,dy:0,xy:M.yx,yx:M.xy});};function _70(_71){return (_71.xx*_71.yy<0||_71.xy*_71.yx>0)?-1:1;};function _72(_73){var M=m.normalize(_73),b=-M.xx-M.yy,c=M.xx*M.yy-M.xy*M.yx,d=Math.sqrt(b*b-4*c),l1=-(b+(b<0?-d:d))/2,l2=c/l1,vx1=M.xy/(l1-M.xx),vy1=1,vx2=M.xy/(l2-M.xx),vy2=1;if(eq(l1,l2)){vx1=1,vy1=0,vx2=0,vy2=1;}if(!isFinite(vx1)){vx1=1,vy1=(l1-M.xx)/M.xy;if(!isFinite(vy1)){vx1=(l1-M.yy)/M.yx,vy1=1;if(!isFinite(vx1)){vx1=1,vy1=M.yx/(l1-M.yy);}}}if(!isFinite(vx2)){vx2=1,vy2=(l2-M.xx)/M.xy;if(!isFinite(vy2)){vx2=(l2-M.yy)/M.yx,vy2=1;if(!isFinite(vx2)){vx2=1,vy2=M.yx/(l2-M.yy);}}}var d1=Math.sqrt(vx1*vx1+vy1*vy1),d2=Math.sqrt(vx2*vx2+vy2*vy2);if(!isFinite(vx1/=d1)){vx1=0;}if(!isFinite(vy1/=d1)){vy1=0;}if(!isFinite(vx2/=d2)){vx2=0;}if(!isFinite(vy2/=d2)){vy2=0;}return {value1:l1,value2:l2,vector1:{x:vx1,y:vy1},vector2:{x:vx2,y:vy2}};};function _74(M,_75){var _76=_70(M),a=_75.angle1=(Math.atan2(M.yx,M.yy)+Math.atan2(-_76*M.xy,_76*M.xx))/2,cos=Math.cos(a),sin=Math.sin(a);_75.sx=_6d(M.xx/cos,cos,-M.xy/sin,sin);_75.sy=_6d(M.yy/cos,cos,M.yx/sin,sin);return _75;};function _77(M,_78){var _79=_70(M),a=_78.angle2=(Math.atan2(_79*M.yx,_79*M.xx)+Math.atan2(-M.xy,M.yy))/2,cos=Math.cos(a),sin=Math.sin(a);_78.sx=_6d(M.xx/cos,cos,M.yx/sin,sin);_78.sy=_6d(M.yy/cos,cos,-M.xy/sin,sin);return _78;};dojox.gfx.decompose=function(_7a){var M=m.normalize(_7a),_7b={dx:M.dx,dy:M.dy,sx:1,sy:1,angle1:0,angle2:0};if(eq(M.xy,0)&&eq(M.yx,0)){return dojo.mixin(_7b,{sx:M.xx,sy:M.yy});}if(eq(M.xx*M.yx,-M.xy*M.yy)){return _74(M,_7b);}if(eq(M.xx*M.xy,-M.yx*M.yy)){return _77(M,_7b);}var MT=_6e(M),u=_72([M,MT]),v=_72([MT,M]),U=new m.Matrix2D({xx:u.vector1.x,xy:u.vector2.x,yx:u.vector1.y,yy:u.vector2.y}),VT=new m.Matrix2D({xx:v.vector1.x,xy:v.vector1.y,yx:v.vector2.x,yy:v.vector2.y}),S=new m.Matrix2D([m.invert(U),M,m.invert(VT)]);_74(VT,_7b);S.xx*=_7b.sx;S.yy*=_7b.sy;_77(U,_7b);S.xx*=_7b.sx;S.yy*=_7b.sy;return dojo.mixin(_7b,{sx:S.xx,sy:S.yy});};})();}if(!dojo._hasResource["dojox.gfx.canvas"]){dojo._hasResource["dojox.gfx.canvas"]=true;dojo.provide("dojox.gfx.canvas");dojo.experimental("dojox.gfx.canvas");(function(){var d=dojo,g=dojox.gfx,gs=g.shape,ga=g.arc,_7c=g.canvas,m=g.matrix,mp=m.multiplyPoint,pi=Math.PI,_7d=2*pi,_7e=pi/2,_7f=null;d.declare("dojox.gfx.canvas.Shape",gs.Shape,{_render:function(ctx){ctx.save();this._renderTransform(ctx);this._renderShape(ctx);this._renderFill(ctx,true);this._renderStroke(ctx,true);ctx.restore();},_renderTransform:function(ctx){if("canvasTransform" in this){var t=this.canvasTransform;ctx.translate(t.dx,t.dy);ctx.rotate(t.angle2);ctx.scale(t.sx,t.sy);ctx.rotate(t.angle1);}},_renderShape:function(ctx){},_renderFill:function(ctx,_80){if("canvasFill" in this){var fs=this.fillStyle;if("canvasFillImage" in this){var w=fs.width,h=fs.height,iw=this.canvasFillImage.width,ih=this.canvasFillImage.height,sx=w==iw?1:w/iw,sy=h==ih?1:h/ih,s=Math.min(sx,sy),dx=(w-s*iw)/2,dy=(h-s*ih)/2;_7f.width=w;_7f.height=h;var _81=_7f.getContext("2d");_81.clearRect(0,0,w,h);_81.drawImage(this.canvasFillImage,0,0,iw,ih,dx,dy,s*iw,s*ih);this.canvasFill=ctx.createPattern(_7f,"repeat");delete this.canvasFillImage;}ctx.fillStyle=this.canvasFill;if(_80){if(fs.type==="pattern"&&(fs.x!==0||fs.y!==0)){ctx.translate(fs.x,fs.y);}ctx.fill();}}else{ctx.fillStyle="rgba(0,0,0,0.0)";}},_renderStroke:function(ctx,_82){var s=this.strokeStyle;if(s){ctx.strokeStyle=s.color.toString();ctx.lineWidth=s.width;ctx.lineCap=s.cap;if(typeof s.join=="number"){ctx.lineJoin="miter";ctx.miterLimit=s.join;}else{ctx.lineJoin=s.join;}if(_82){ctx.stroke();}}else{if(!_82){ctx.strokeStyle="rgba(0,0,0,0.0)";}}},getEventSource:function(){return null;},connect:function(){},disconnect:function(){}});var _83=function(_84,_85,_86){var old=_84.prototype[_85];_84.prototype[_85]=_86?function(){this.surface.makeDirty();old.apply(this,arguments);_86.call(this);return this;}:function(){this.surface.makeDirty();return old.apply(this,arguments);};};_83(_7c.Shape,"setTransform",function(){if(this.matrix){this.canvasTransform=g.decompose(this.matrix);}else{delete this.canvasTransform;}});_83(_7c.Shape,"setFill",function(){var fs=this.fillStyle,f;if(fs){if(typeof (fs)=="object"&&"type" in fs){var ctx=this.surface.rawNode.getContext("2d");switch(fs.type){case "linear":case "radial":f=fs.type=="linear"?ctx.createLinearGradient(fs.x1,fs.y1,fs.x2,fs.y2):ctx.createRadialGradient(fs.cx,fs.cy,0,fs.cx,fs.cy,fs.r);d.forEach(fs.colors,function(_87){f.addColorStop(_87.offset,g.normalizeColor(_87.color).toString());});break;case "pattern":if(!_7f){_7f=document.createElement("canvas");}var img=new Image();this.surface.downloadImage(img,fs.src);this.canvasFillImage=img;}}else{f=fs.toString();}this.canvasFill=f;}else{delete this.canvasFill;}});_83(_7c.Shape,"setStroke");_83(_7c.Shape,"setShape");dojo.declare("dojox.gfx.canvas.Group",_7c.Shape,{constructor:function(){gs.Container._init.call(this);},_render:function(ctx){ctx.save();this._renderTransform(ctx);for(var i=0;i<this.children.length;++i){this.children[i]._render(ctx);}ctx.restore();}});dojo.declare("dojox.gfx.canvas.Rect",[_7c.Shape,gs.Rect],{_renderShape:function(ctx){var s=this.shape,r=Math.min(s.r,s.height/2,s.width/2),xl=s.x,xr=xl+s.width,yt=s.y,yb=yt+s.height,xl2=xl+r,xr2=xr-r,yt2=yt+r,yb2=yb-r;ctx.beginPath();ctx.moveTo(xl2,yt);if(r){ctx.arc(xr2,yt2,r,-_7e,0,false);ctx.arc(xr2,yb2,r,0,_7e,false);ctx.arc(xl2,yb2,r,_7e,pi,false);ctx.arc(xl2,yt2,r,pi,pi+_7e,false);}else{ctx.lineTo(xr2,yt);ctx.lineTo(xr,yb2);ctx.lineTo(xl2,yb);ctx.lineTo(xl,yt2);}ctx.closePath();}});var _88=[];(function(){var u=ga.curvePI4;_88.push(u.s,u.c1,u.c2,u.e);for(var a=45;a<360;a+=45){var r=m.rotateg(a);_88.push(mp(r,u.c1),mp(r,u.c2),mp(r,u.e));}})();dojo.declare("dojox.gfx.canvas.Ellipse",[_7c.Shape,gs.Ellipse],{setShape:function(){this.inherited(arguments);var s=this.shape,t,c1,c2,r=[],M=m.normalize([m.translate(s.cx,s.cy),m.scale(s.rx,s.ry)]);t=mp(M,_88[0]);r.push([t.x,t.y]);for(var i=1;i<_88.length;i+=3){c1=mp(M,_88[i]);c2=mp(M,_88[i+1]);t=mp(M,_88[i+2]);r.push([c1.x,c1.y,c2.x,c2.y,t.x,t.y]);}this.canvasEllipse=r;return this;},_renderShape:function(ctx){var r=this.canvasEllipse;ctx.beginPath();ctx.moveTo.apply(ctx,r[0]);for(var i=1;i<r.length;++i){ctx.bezierCurveTo.apply(ctx,r[i]);}ctx.closePath();}});dojo.declare("dojox.gfx.canvas.Circle",[_7c.Shape,gs.Circle],{_renderShape:function(ctx){var s=this.shape;ctx.beginPath();ctx.arc(s.cx,s.cy,s.r,0,_7d,1);}});dojo.declare("dojox.gfx.canvas.Line",[_7c.Shape,gs.Line],{_renderShape:function(ctx){var s=this.shape;ctx.beginPath();ctx.moveTo(s.x1,s.y1);ctx.lineTo(s.x2,s.y2);}});dojo.declare("dojox.gfx.canvas.Polyline",[_7c.Shape,gs.Polyline],{setShape:function(){this.inherited(arguments);var p=this.shape.points,f=p[0],r=[],c,i;if(p.length){if(typeof f=="number"){r.push(f,p[1]);i=2;}else{r.push(f.x,f.y);i=1;}for(;i<p.length;++i){c=p[i];if(typeof c=="number"){r.push(c,p[++i]);}else{r.push(c.x,c.y);}}}this.canvasPolyline=r;return this;},_renderShape:function(ctx){var p=this.canvasPolyline;if(p.length){ctx.beginPath();ctx.moveTo(p[0],p[1]);for(var i=2;i<p.length;i+=2){ctx.lineTo(p[i],p[i+1]);}}}});dojo.declare("dojox.gfx.canvas.Image",[_7c.Shape,gs.Image],{setShape:function(){this.inherited(arguments);var img=new Image();this.surface.downloadImage(img,this.shape.src);this.canvasImage=img;return this;},_renderShape:function(ctx){var s=this.shape;ctx.drawImage(this.canvasImage,s.x,s.y,s.width,s.height);}});dojo.declare("dojox.gfx.canvas.Text",[_7c.Shape,gs.Text],{_setFont:function(){if(this.fontStyle){this.canvasFont=g.makeFontString(this.fontStyle);}else{delete this.canvasFont;}},getTextWidth:function(){var s=this.shape,w=0,ctx;if(s.text&&s.text.length>0){ctx=this.surface.rawNode.getContext("2d");ctx.save();this._renderTransform(ctx);this._renderFill(ctx,false);this._renderStroke(ctx,false);if(this.canvasFont){ctx.font=this.canvasFont;}w=ctx.measureText(s.text).width;ctx.restore();}return w;},_render:function(ctx){ctx.save();this._renderTransform(ctx);this._renderFill(ctx,false);this._renderStroke(ctx,false);this._renderShape(ctx);ctx.restore();},_renderShape:function(ctx){var ta,s=this.shape;if(!s.text||s.text.length==0){return;}ta=s.align==="middle"?"center":s.align;ctx.textAlign=ta;if(this.canvasFont){ctx.font=this.canvasFont;}if(this.canvasFill){ctx.fillText(s.text,s.x,s.y);}if(this.strokeStyle){ctx.beginPath();ctx.strokeText(s.text,s.x,s.y);ctx.closePath();}}});_83(_7c.Text,"setFont");if(typeof dojo.doc.createElement("canvas").getContext("2d").fillText!="function"){_7c.Text.extend({getTextWidth:function(){return 0;},_renderShape:function(){}});}var _89={M:"_moveToA",m:"_moveToR",L:"_lineToA",l:"_lineToR",H:"_hLineToA",h:"_hLineToR",V:"_vLineToA",v:"_vLineToR",C:"_curveToA",c:"_curveToR",S:"_smoothCurveToA",s:"_smoothCurveToR",Q:"_qCurveToA",q:"_qCurveToR",T:"_qSmoothCurveToA",t:"_qSmoothCurveToR",A:"_arcTo",a:"_arcTo",Z:"_closePath",z:"_closePath"};dojo.declare("dojox.gfx.canvas.Path",[_7c.Shape,g.path.Path],{constructor:function(){this.lastControl={};},setShape:function(){this.canvasPath=[];return this.inherited(arguments);},_updateWithSegment:function(_8a){var _8b=d.clone(this.last);this[_89[_8a.action]](this.canvasPath,_8a.action,_8a.args);this.last=_8b;this.inherited(arguments);},_renderShape:function(ctx){var r=this.canvasPath;ctx.beginPath();for(var i=0;i<r.length;i+=2){ctx[r[i]].apply(ctx,r[i+1]);}},_moveToA:function(_8c,_8d,_8e){_8c.push("moveTo",[_8e[0],_8e[1]]);for(var i=2;i<_8e.length;i+=2){_8c.push("lineTo",[_8e[i],_8e[i+1]]);}this.last.x=_8e[_8e.length-2];this.last.y=_8e[_8e.length-1];this.lastControl={};},_moveToR:function(_8f,_90,_91){if("x" in this.last){_8f.push("moveTo",[this.last.x+=_91[0],this.last.y+=_91[1]]);}else{_8f.push("moveTo",[this.last.x=_91[0],this.last.y=_91[1]]);}for(var i=2;i<_91.length;i+=2){_8f.push("lineTo",[this.last.x+=_91[i],this.last.y+=_91[i+1]]);}this.lastControl={};},_lineToA:function(_92,_93,_94){for(var i=0;i<_94.length;i+=2){_92.push("lineTo",[_94[i],_94[i+1]]);}this.last.x=_94[_94.length-2];this.last.y=_94[_94.length-1];this.lastControl={};},_lineToR:function(_95,_96,_97){for(var i=0;i<_97.length;i+=2){_95.push("lineTo",[this.last.x+=_97[i],this.last.y+=_97[i+1]]);}this.lastControl={};},_hLineToA:function(_98,_99,_9a){for(var i=0;i<_9a.length;++i){_98.push("lineTo",[_9a[i],this.last.y]);}this.last.x=_9a[_9a.length-1];this.lastControl={};},_hLineToR:function(_9b,_9c,_9d){for(var i=0;i<_9d.length;++i){_9b.push("lineTo",[this.last.x+=_9d[i],this.last.y]);}this.lastControl={};},_vLineToA:function(_9e,_9f,_a0){for(var i=0;i<_a0.length;++i){_9e.push("lineTo",[this.last.x,_a0[i]]);}this.last.y=_a0[_a0.length-1];this.lastControl={};},_vLineToR:function(_a1,_a2,_a3){for(var i=0;i<_a3.length;++i){_a1.push("lineTo",[this.last.x,this.last.y+=_a3[i]]);}this.lastControl={};},_curveToA:function(_a4,_a5,_a6){for(var i=0;i<_a6.length;i+=6){_a4.push("bezierCurveTo",_a6.slice(i,i+6));}this.last.x=_a6[_a6.length-2];this.last.y=_a6[_a6.length-1];this.lastControl.x=_a6[_a6.length-4];this.lastControl.y=_a6[_a6.length-3];this.lastControl.type="C";},_curveToR:function(_a7,_a8,_a9){for(var i=0;i<_a9.length;i+=6){_a7.push("bezierCurveTo",[this.last.x+_a9[i],this.last.y+_a9[i+1],this.lastControl.x=this.last.x+_a9[i+2],this.lastControl.y=this.last.y+_a9[i+3],this.last.x+_a9[i+4],this.last.y+_a9[i+5]]);this.last.x+=_a9[i+4];this.last.y+=_a9[i+5];}this.lastControl.type="C";},_smoothCurveToA:function(_aa,_ab,_ac){for(var i=0;i<_ac.length;i+=4){var _ad=this.lastControl.type=="C";_aa.push("bezierCurveTo",[_ad?2*this.last.x-this.lastControl.x:this.last.x,_ad?2*this.last.y-this.lastControl.y:this.last.y,_ac[i],_ac[i+1],_ac[i+2],_ac[i+3]]);this.lastControl.x=_ac[i];this.lastControl.y=_ac[i+1];this.lastControl.type="C";}this.last.x=_ac[_ac.length-2];this.last.y=_ac[_ac.length-1];},_smoothCurveToR:function(_ae,_af,_b0){for(var i=0;i<_b0.length;i+=4){var _b1=this.lastControl.type=="C";_ae.push("bezierCurveTo",[_b1?2*this.last.x-this.lastControl.x:this.last.x,_b1?2*this.last.y-this.lastControl.y:this.last.y,this.last.x+_b0[i],this.last.y+_b0[i+1],this.last.x+_b0[i+2],this.last.y+_b0[i+3]]);this.lastControl.x=this.last.x+_b0[i];this.lastControl.y=this.last.y+_b0[i+1];this.lastControl.type="C";this.last.x+=_b0[i+2];this.last.y+=_b0[i+3];}},_qCurveToA:function(_b2,_b3,_b4){for(var i=0;i<_b4.length;i+=4){_b2.push("quadraticCurveTo",_b4.slice(i,i+4));}this.last.x=_b4[_b4.length-2];this.last.y=_b4[_b4.length-1];this.lastControl.x=_b4[_b4.length-4];this.lastControl.y=_b4[_b4.length-3];this.lastControl.type="Q";},_qCurveToR:function(_b5,_b6,_b7){for(var i=0;i<_b7.length;i+=4){_b5.push("quadraticCurveTo",[this.lastControl.x=this.last.x+_b7[i],this.lastControl.y=this.last.y+_b7[i+1],this.last.x+_b7[i+2],this.last.y+_b7[i+3]]);this.last.x+=_b7[i+2];this.last.y+=_b7[i+3];}this.lastControl.type="Q";},_qSmoothCurveToA:function(_b8,_b9,_ba){for(var i=0;i<_ba.length;i+=2){var _bb=this.lastControl.type=="Q";_b8.push("quadraticCurveTo",[this.lastControl.x=_bb?2*this.last.x-this.lastControl.x:this.last.x,this.lastControl.y=_bb?2*this.last.y-this.lastControl.y:this.last.y,_ba[i],_ba[i+1]]);this.lastControl.type="Q";}this.last.x=_ba[_ba.length-2];this.last.y=_ba[_ba.length-1];},_qSmoothCurveToR:function(_bc,_bd,_be){for(var i=0;i<_be.length;i+=2){var _bf=this.lastControl.type=="Q";_bc.push("quadraticCurveTo",[this.lastControl.x=_bf?2*this.last.x-this.lastControl.x:this.last.x,this.lastControl.y=_bf?2*this.last.y-this.lastControl.y:this.last.y,this.last.x+_be[i],this.last.y+_be[i+1]]);this.lastControl.type="Q";this.last.x+=_be[i];this.last.y+=_be[i+1];}},_arcTo:function(_c0,_c1,_c2){var _c3=_c1=="a";for(var i=0;i<_c2.length;i+=7){var x1=_c2[i+5],y1=_c2[i+6];if(_c3){x1+=this.last.x;y1+=this.last.y;}var _c4=ga.arcAsBezier(this.last,_c2[i],_c2[i+1],_c2[i+2],_c2[i+3]?1:0,_c2[i+4]?1:0,x1,y1);d.forEach(_c4,function(p){_c0.push("bezierCurveTo",p);});this.last.x=x1;this.last.y=y1;}this.lastControl={};},_closePath:function(_c5,_c6,_c7){_c5.push("closePath",[]);this.lastControl={};}});d.forEach(["moveTo","lineTo","hLineTo","vLineTo","curveTo","smoothCurveTo","qCurveTo","qSmoothCurveTo","arcTo","closePath"],function(_c8){_83(_7c.Path,_c8);});dojo.declare("dojox.gfx.canvas.TextPath",[_7c.Shape,g.path.TextPath],{_renderShape:function(ctx){var s=this.shape;},_setText:function(){},_setFont:function(){}});dojo.declare("dojox.gfx.canvas.Surface",gs.Surface,{constructor:function(){gs.Container._init.call(this);this.pendingImageCount=0;this.makeDirty();},setDimensions:function(_c9,_ca){this.width=g.normalizedLength(_c9);this.height=g.normalizedLength(_ca);if(!this.rawNode){return this;}this.rawNode.width=_c9;this.rawNode.height=_ca;this.makeDirty();return this;},getDimensions:function(){return this.rawNode?{width:this.rawNode.width,height:this.rawNode.height}:null;},_render:function(){if(this.pendingImageCount){return;}var ctx=this.rawNode.getContext("2d");ctx.save();ctx.clearRect(0,0,this.rawNode.width,this.rawNode.height);for(var i=0;i<this.children.length;++i){this.children[i]._render(ctx);}ctx.restore();if("pendingRender" in this){clearTimeout(this.pendingRender);delete this.pendingRender;}},makeDirty:function(){if(!this.pendingImagesCount&&!("pendingRender" in this)){this.pendingRender=setTimeout(d.hitch(this,this._render),0);}},downloadImage:function(img,url){var _cb=d.hitch(this,this.onImageLoad);if(!this.pendingImageCount++&&"pendingRender" in this){clearTimeout(this.pendingRender);delete this.pendingRender;}img.onload=_cb;img.onerror=_cb;img.onabort=_cb;img.src=url;},onImageLoad:function(){if(!--this.pendingImageCount){this._render();}},getEventSource:function(){return null;},connect:function(){},disconnect:function(){}});_7c.createSurface=function(_cc,_cd,_ce){if(!_cd&&!_ce){var pos=d.position(_cc);_cd=_cd||pos.w;_ce=_ce||pos.h;}if(typeof _cd=="number"){_cd=_cd+"px";}if(typeof _ce=="number"){_ce=_ce+"px";}var s=new _7c.Surface(),p=d.byId(_cc),c=p.ownerDocument.createElement("canvas");c.width=g.normalizedLength(_cd);c.height=g.normalizedLength(_ce);p.appendChild(c);s.rawNode=c;s._parent=p;s.surface=s;return s;};var C=gs.Container,_cf={add:function(_d0){this.surface.makeDirty();return C.add.apply(this,arguments);},remove:function(_d1,_d2){this.surface.makeDirty();return C.remove.apply(this,arguments);},clear:function(){this.surface.makeDirty();return C.clear.apply(this,arguments);},_moveChildToFront:function(_d3){this.surface.makeDirty();return C._moveChildToFront.apply(this,arguments);},_moveChildToBack:function(_d4){this.surface.makeDirty();return C._moveChildToBack.apply(this,arguments);}};var _d5={createObject:function(_d6,_d7){var _d8=new _d6();_d8.surface=this.surface;_d8.setShape(_d7);this.add(_d8);return _d8;}};d.extend(_7c.Group,_cf);d.extend(_7c.Group,gs.Creator);d.extend(_7c.Group,_d5);d.extend(_7c.Surface,_cf);d.extend(_7c.Surface,gs.Creator);d.extend(_7c.Surface,_d5);if(g.loadAndSwitch==="canvas"){g.switchTo("canvas");delete g.loadAndSwitch;}})();}
