/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */

window[esri._dojoScopeName||"dojo"]._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","esri.layers.agsdynamic"],["require","esri.layers.dynamic"],["require","esri.layers.agscommon"],["require","esri._time"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["esri.layers.agsdynamic"]){_4._hasResource["esri.layers.agsdynamic"]=true;_4.provide("esri.layers.agsdynamic");_4.require("esri.layers.dynamic");_4.require("esri.layers.agscommon");_4.require("esri._time");_4.declare("esri.layers.ArcGISDynamicMapServiceLayer",[esri.layers.DynamicMapServiceLayer,esri.layers.ArcGISMapServiceLayer],{constructor:function(_7,_8){var _9=_8&&_8.imageParameters,dh=_4.hitch;if(_9){var _a=_9.layerDefinitions;if(_a){this.setLayerDefinitions(_a);}if(_9.layerOption===esri.layers.ImageParameters.LAYER_OPTION_SHOW){this.visibleLayers=[].concat(_9.layerIds);}}this._setIsPNG32=dh(this,this._setIsPNG32);this.dpi=(_9&&_9.dpi)||96;this.imageFormat=(_9&&_9.format)||"png8";this.imageTransparency=(_9&&_9.transparent===false)?false:true;this._setIsPNG32();_4.mixin(this._params,this._url.query,{dpi:this.dpi,transparent:this.imageTransparency,format:this.imageFormat},_9?_9.toJson():{});this.getImageUrl=dh(this,this.getImageUrl);this._initLayer=dh(this,this._initLayer);this._load=dh(this,this._load);this.useMapImage=_8?_8.useMapImage:false;if(this.useMapImage){this._imageExportHandler=dh(this,this._imageExportHandler);}this._loadCallback=_8&&_8.loadCallback;var _b=_8&&_8.resourceInfo;if(_b){this._initLayer(_b);}else{if(arguments[2]===undefined||arguments[2]===false){this._load();}}},disableClientCaching:false,layerDefinitions:null,_initLayer:function(_c,io){this.inherited(arguments);if(_c.timeInfo){this.timeInfo=new esri.layers.TimeInfo(_c.timeInfo);}this.loaded=true;this.onLoad(this);var _d=this._loadCallback;if(_d){delete this._loadCallback;_d(this);}},getImageUrl:function(_e,_f,_10,_11){var _12=this._url.path+"/export?",_13=this._params,sr=_e.spatialReference.wkid||_4.toJson(_e.spatialReference.toJson()),_14=this._errorHandler;delete _13._ts;_4.mixin(_13,{bbox:_e.xmin+","+_e.ymin+","+_e.xmax+","+_e.ymax,bboxSR:sr,imageSR:sr,size:_f+","+_10},this.disableClientCaching?{_ts:new Date().getTime()}:{});if(_13.layerDefs){var _15=_13.layerDefs;delete _13.layerDefs;_4.mixin(_13,{layerDefs:_15});}var _16=esri._getProxiedUrl(_12+_4.objectToQuery(_4.mixin({},_13,{f:"image"})));if((_16.length>esri.config.defaults.io.postLength)||this.useMapImage){var _17=this._imageExportHandler;this._jsonRequest=esri.request({url:_12,content:_4.mixin(_13,{f:"json"}),callbackParamName:"callback",load:function(_18,io){_17(_18,io,_11);},error:_14});}else{_11(_16);}},_imageExportHandler:function(_19,io,_1a){_1a(esri._getProxiedUrl(_19.href));},_setIsPNG32:function(){var _1b=this.imageFormat.toLowerCase();var _1c=_4.isIE;this.isPNG32=_1c&&_1c===6&&(_1b==="png32"||_1b==="png24")&&this.imageTransparency;},_setTime:function(_1d){var _1e=(this._params.time=_1d?_1d.toJson().join(","):null);if(this.version<10.02&&this.timeInfo){if(!_1e){var _1f=this.layerInfos;if(_1f){var _20=this.layerTimeOptions,_21=_20?_20.slice(0):[],ids=[];_4.forEach(_1f,function(_22){if(!_22.subLayerIds){ids.push(_22.id);}});if(ids.length){_4.forEach(ids,function(id){if(!_21[id]){var opt=new esri.layers.LayerTimeOptions();opt.useTime=false;_21[id]=opt;}});this._params.layerTimeOptions=esri._serializeTimeOptions(_21,ids);}}}else{this._params.layerTimeOptions=esri._serializeTimeOptions(this.layerTimeOptions);}}if(this.version>=10.02&&this.timeInfo){if(!_1e){this._params.time="null,null";}}},setDPI:function(dpi,_23){this.dpi=(this._params.dpi=dpi);if(!_23){this.refresh(true);}},setImageFormat:function(_24,_25){this.imageFormat=(this._params.format=_24);this._setIsPNG32();if(!_25){this.refresh(true);}},setImageTransparency:function(_26,_27){this.imageTransparency=(this._params.transparent=_26);this._setIsPNG32();if(!_27){this.refresh(true);}},setVisibleLayers:function(_28,_29){this.visibleLayers=_28;this._params.layers=esri.layers.ImageParameters.LAYER_OPTION_SHOW+":"+_28.join(",");if(!_29){this.refresh(true);}},setDefaultVisibleLayers:function(_2a){this.visibleLayers=this._defaultVisibleLayers;this._params.layers=null;if(!_2a){this.refresh(true);}},setLayerDefinitions:function(_2b,_2c){this.layerDefinitions=_2b;this._params.layerDefs=esri._serializeLayerDefinitions(_2b);if(!_2c){this.refresh(true);}},setDefaultLayerDefinitions:function(_2d){this.layerDefinitions=this._params.layerDefs=null;if(!_2d){this.refresh(true);}},setDisableClientCaching:function(_2e){this.disableClientCaching=_2e;},setLayerTimeOptions:function(_2f,_30){this.layerTimeOptions=_2f;this._params.layerTimeOptions=esri._serializeTimeOptions(_2f);if(!_30){this.refresh(true);}},refresh:function(_31){if(_31){this.inherited(arguments);}else{var dc=this.disableClientCaching;this.disableClientCaching=true;this.inherited(arguments);this.disableClientCaching=dc;}},exportMapImage:function(_32,_33){var m=esri.config.defaults.map,p=_4.mixin({size:m.width+","+m.height},this._params,_32?_32.toJson(this.normalization):{},{f:"json"});delete p._ts;if(p.layerDefs){var _34=p.layerDefs;delete p.layerDefs;_4.mixin(p,{layerDefs:_34});}this._exportMapImage(this._url.path+"/export",p,_33);}});_4.declare("esri.layers.ImageParameters",null,{constructor:function(){this.layerDefinitions=[];this._bundle=_4.i18n.getLocalization("esri","jsapi");},bbox:null,extent:null,width:null,height:null,dpi:null,format:null,imageSpatialReference:null,layerOption:null,layerIds:null,transparent:null,timeExtent:null,layerTimeOptions:null,toJson:function(_35){if(this.bbox){_4.deprecated(this.declaredClass+" : "+this._bundle.layers.imageParameters.deprecateBBox);}var bb=this.bbox||this.extent;bb=bb&&_35&&bb._normalize(true);var _36=this.layerOption,_37=bb?(bb.spatialReference.wkid||_4.toJson(bb.spatialReference.toJson())):null,_38=this.imageSpatialReference,_39={dpi:this.dpi,format:this.format,transparent:this.transparent,size:(this.width!==null&&this.height!==null?this.width+","+this.height:null),bbox:(bb?(bb.xmin+","+bb.ymin+","+bb.xmax+","+bb.ymax):null),bboxSR:_37,layers:(_36?_36+":"+this.layerIds.join(","):null),imageSR:(_38?(_38.wkid||_4.toJson(_38.toJson())):_37)};_39.layerDefs=esri._serializeLayerDefinitions(this.layerDefinitions);var _3a=this.timeExtent;_39.time=_3a?_3a.toJson().join(","):null;_39.layerTimeOptions=esri._serializeTimeOptions(this.layerTimeOptions);return esri.filter(_39,function(_3b){if(_3b!==null){return true;}});}});_4.mixin(esri.layers.ImageParameters,{LAYER_OPTION_SHOW:"show",LAYER_OPTION_HIDE:"hide",LAYER_OPTION_INCLUDE:"include",LAYER_OPTION_EXCLUDE:"exclude"});_4.declare("esri.layers.MapImage",null,{constructor:function(_3c){_4.mixin(this,_3c);this.extent=new esri.geometry.Extent(this.extent);}});}}};});