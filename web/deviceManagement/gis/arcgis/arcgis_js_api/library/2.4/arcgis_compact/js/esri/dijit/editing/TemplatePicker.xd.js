/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */

window[esri._dojoScopeName||"dojo"]._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","esri.dijit.editing.TemplatePicker"],["require","dojo.data.ItemFileReadStore"],["require","dojox.grid.DataGrid"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["esri.dijit.editing.TemplatePicker"]){_4._hasResource["esri.dijit.editing.TemplatePicker"]=true;_4.provide("esri.dijit.editing.TemplatePicker");_4.require("dojo.data.ItemFileReadStore");_4.require("dojox.grid.DataGrid");(function(){var _7=[_4.moduleUrl("esri.dijit.editing","css/TemplatePicker.css"),_4.moduleUrl("dojox","grid/resources/Grid.css")];var _8=document.getElementsByTagName("head").item(0),_9;for(var i=0,il=_7.length;i<il;i++){_9=document.createElement("link");_9.type="text/css";_9.rel="stylesheet";_9.href=_7[i].toString();_8.appendChild(_9);}}());_4.declare("esri.dijit.editing.TemplatePicker",[_5._Widget,_5._Templated],{widgetsInTemplate:true,templateString:"<div class=\"templatePicker\">\r\n\r\n  <table dojoType=\"dojox.grid.DataGrid\" selectionMode=\"none\" autoHeight=\"${_rows}\" autoWidth=\"${_autoWidth}\"\r\n         query=\"{ query: '*' }\" dojoAttachPoint=\"grid\" class=\"grid\">\r\n  </table>\r\n  \r\n</div>\r\n",basePath:_4.moduleUrl("esri.dijit.editing"),featureLayers:null,items:null,grouping:true,showTooltip:false,maxLabelLength:0,rows:4,columns:3,surfaceWidth:30,surfaceHeight:30,_uniqueId:{id:0},_assumedCellWidth:90,_initialAutoWidth:300,_initialAutoHeight:200,_ieTimer:150,constructor:function(_a,_b){_a=_a||{};if(!_a.items&&!_a.featureLayers){console.error("TemplatePicker: please provide 'featureLayers' or 'items' parameter in the constructor");}this._dojo14x=(_4.version.minor>=4);this._itemWidgets={};},postMixInProperties:function(){this.inherited(arguments);this._preprocess();},startup:function(){this.inherited(arguments);if(this.rows==="auto"&&this.columns==="auto"){var _c=_4.contentBox(this.domNode);if(!_c.w){this.domNode.style.width=this._initialAutoWidth+"px";}if(!_c.h){this.domNode.style.height=this._initialAutoHeight+"px";}_c=_4.contentBox(this.domNode);this._columns=Math.floor(_c.w/this._assumedCellWidth)||1;}this._applyGridPatches();this._setGridLayout();_4.connect(this.grid,"onRowClick",this,this._rowClicked);this._setGridData();this._toggleTooltip();if(_4.isIE<9){this._repaintItems=_4.hitch(this,this._repaintItems);setTimeout(this._repaintItems,this._ieTimer);}},destroy:function(){this.showTooltip=false;this._toggleTooltip();this.featureLayers=this.items=this.grid=this._flItems=this._itItems=this._groupRowIndices=this._selectedCell=this._selectedInfo=this._selectedItem=null;this.inherited(arguments);},getSelected:function(){return this._selectedCell?this._selectedItem:null;},clearSelection:function(){var _d=this._selectedCell,_e=this._selectedInfo;if(_d){this._rowClicked({cellNode:_d,rowIndex:_e.selRow,cellIndex:_e.selCol});}},update:function(_f){var _10=(this.rows==="auto"&&this.columns==="auto"&&_f)?true:false;var _11=this.grid;if(_10){var _12=this.domNode,box=_4.contentBox(_12),id=_12.id;this._columns=Math.floor((box.w-_11.views.views[0].getScrollbarWidth())/_4.coords(_4.query("#"+id+".templatePicker div.item")[0].parentNode).w);this._columns=this._columns||1;}var _13=this._rows;this._preprocess();var _14=this._rows;this._setGridLayout();this._setGridData();if(_14!==_13){_11.set("autoHeight",this._rows,false);}if(_10){_11._resize({w:box.w,h:box.h});_11.viewsHeaderNode.style.display="none";}else{_11.update();}this._toggleTooltip();var _15=this,_16=this.getSelected();if(_16){_11.store.fetch({onComplete:function(its){var _17=_15._locate(_16,_15._selectedInfo,its);var _18=_17&&_11.views.views[0].getCellNode(_17[0],_17[1]);if(_18){_15._rowClicked({cellNode:_18,rowIndex:_17[0],cellIndex:_17[1]},true);}}});}if(_4.isIE<9){setTimeout(this._repaintItems,this._ieTimer);}},onSelectionChange:function(){},_preprocess:function(){if(this.items){this.grouping=false;}this._autoWidth=false;if(this.rows==="auto"||this.columns==="auto"){this._autoWidth=true;}var _19;if(this.featureLayers){_19=this._flItems=this._getItemsFromLayers(this.featureLayers);}else{_19=this._itItems=this._getItemsFromItems(this.items);}if(this.rows==="auto"&&this.columns==="auto"){if(!this._started){this._rows=false;this._columns=null;this._autoWidth=false;}return;}var len=0;this._rows=this.rows;this._columns=this.columns;if(this.rows==="auto"){if(this.featureLayers){if(this.grouping){len=_19.length;_4.forEach(_19,function(_1a){len+=Math.ceil(_1a.length/this.columns);},this);}else{_4.forEach(_19,function(_1b){len+=_1b.length;},this);len=Math.ceil(len/this.columns);}}else{len=Math.ceil(_19.length/this.columns);}this._rows=len;}else{if(this.columns==="auto"){if(this.featureLayers){if(this.grouping){len=3;}else{_4.forEach(_19,function(_1c){len+=_1c.length;},this);len=Math.ceil(len/this.rows);}}else{len=Math.ceil(_19.length/this.rows);}this._columns=len;}}},_applyGridPatches:function(){var _1d=this.grid;var _1e=_1d.adaptWidth;_1d.adaptWidth=function(){var _1f=this.views.views;for(var i=0,_20;_20=_1f[i];i++){_4.style(_20.headerNode,"display","block");}_1e.apply(this,arguments);for(var i=0,_20;_20=_1f[i];i++){_4.style(_20.headerNode,"display","none");}};if(this._dojo14x){if(this.rows!=="auto"&&this.columns!=="auto"){var _21=_4.connect(_1d,"_onFetchComplete",this,function(){_4.disconnect(_21);this.grid.set("autoHeight",this._rows);});}_4.connect(_1d,"_onDelete",this,this._destroyItems);_4.connect(_1d,"_clearData",this,this._destroyItems);_4.connect(_1d,"destroy",this,this._destroyItems);var _22=_1d.focus;if(_22&&_22.findAndFocusGridCell){_22.findAndFocusGridCell=function(){return false;};}}},_setGridLayout:function(){var _23=function(_24){return function(_25,_26){return this._cellGet(_24,_25,_26);};};var _27=_4.hitch(this,this._cellFormatter);var _28=[],_29=this._columns;for(var i=0;i<_29;i++){_28.push({field:"cell"+i,get:_4.hitch(this,_23(i)),formatter:_27});}var _2a={cells:[_28]};if(this.grouping){var _2b={field:"groupName",colSpan:_29,get:_4.hitch(this,this._cellGetGroup),formatter:_4.hitch(this,this._cellGroupFormatter)};_2a.cells.push([_2b]);}var _2c=this.grid;_2c.set("structure",_2a);},_setGridData:function(){var _2d=[];if(this.grouping){this._groupRowIndices=[];var _2e,_2f,_30=this._columns;_4.forEach(this._flItems,function(_31,idx){_2d.push({});var _32=(idx===0)?0:(_2e+_2f+1);this._groupRowIndices.push(_32);_2e=_32;_2f=Math.ceil(_31.length/_30);_2d=_2d.concat(this._getStoreItems(_31));},this);}else{if(this.featureLayers){_4.forEach(this._flItems,function(_33){_2d=_2d.concat(_33);});_2d=this._getStoreItems(_2d);}else{_2d=this._getStoreItems(this._itItems);}}var _34=new _4.data.ItemFileReadStore({data:{items:_2d}});this.grid.setStore(_34);},_toggleTooltip:function(){if(this.showTooltip){if(this.tooltip){return;}this.tooltip=_4.create("div",{"class":"tooltip"},this.domNode);this.tooltip.style.display="none";this.tooltip.style.position="fixed";var _35=this.grid;this._mouseOverConnect=_4.connect(_35,"onCellMouseOver",this,this._cellMouseOver);this._mouseOutConnect=_4.connect(_35,"onCellMouseOut",this,this._cellMouseOut);}else{if(this.tooltip){_4.disconnect(this._mouseOverConnect);_4.disconnect(this._mouseOutConnect);_4.destroy(this.tooltip);this.tooltip=null;}}},_rowClicked:function(evt,_36){var _37=evt.cellNode,row=evt.rowIndex,col=evt.cellIndex;var _38=this._getCellInfo(_37,row,col);if(!_38){return;}if(this._selectedCell){_4.removeClass(this._selectedCell,"selectedItem");}if(_37!==this._selectedCell){_4.addClass(_37,"selectedItem");this._selectedCell=_37;var _39=this.grid.store;this._selectedItem={featureLayer:_39.getValue(_38,"layer"),type:_39.getValue(_38,"type"),template:_39.getValue(_38,"template"),symbolInfo:_39.getValue(_38,"symbolInfo"),item:this._getItem(_38)};this._selectedInfo={selRow:row,selCol:col,index1:_39.getValue(_38,"index1"),index2:_39.getValue(_38,"index2"),index:_39.getValue(_38,"index")};}else{this._selectedCell=this._selectedInfo=this._selectedItem=null;}if(!_36){this.onSelectionChange();}},_locate:function(_3a,_3b,_3c){var _3d=this.grid.store,_3e=new Array(this._columns);var _3f,_40=_3b.index1,_41=_3b.index2,_42=_3b.index,_43=_3a.item;_4.some(_3c,function(_44,_45){return _4.some(_3e,function(_46,_47){var _48=_3d.getValue(_44,"cell"+_47);if(_48&&(_43?(_42===_3d.getValue(_48,"index")):(_40===_3d.getValue(_48,"index1")&&_41===_3d.getValue(_48,"index2")))){_3f=[_45,_47];return true;}else{return false;}});});return _3f;},_getCellInfo:function(_49,row,col){if(!_49){return;}var _4a=this.grid;var _4b=_4a.getItem(row);var _4c=_4a.store.getValue(_4b,"cell"+col);return _4c;},_getItem:function(_4d){var _4e=this.items;if(_4e){return _4e[this.grid.store.getValue(_4d,"index")];}},_cellMouseOver:function(evt){var _4f=this.tooltip;var _50=evt.cellNode,row=evt.rowIndex,col=evt.cellIndex;var _51=this._getCellInfo(_50,row,col);if(_4f&&_51){var _52=this.grid.store;var _53=_52.getValue(_51,"template");var _54=_52.getValue(_51,"type");var _55=_52.getValue(_51,"symbolInfo");var _56=_52.getValue(_51,"layer");var _57=this._getItem(_51);var _58=(_57&&(_57.label+(_57.description?(": "+_57.description):"")))||(_53&&(_53.name+(_53.description?(": "+_53.description):"")))||(_54&&_54.name)||(_55&&(_55.label+(_55.description?(": "+_55.description):"")))||((_56&&_56.name+": ")+"Default");_4f.style.display="none";_4f.innerHTML=_58;var _59=_4.coords(_50.firstChild);_4.style(_4f,{left:(_59.x)+"px",top:(_59.y+_59.h+5)+"px"});_4f.style.display="";}},_cellMouseOut:function(){var _5a=this.tooltip;if(_5a){_5a.style.display="none";}},_destroyItems:function(){var _5b=this._itemWidgets;for(var w in _5b){if(!_5b[w]){continue;}_5b[w].destroy();delete _5b[w];}},_repaintItems:function(){var _5c=this._itemWidgets;for(var w in _5c){var _5d=_5c[w];if(_5d){_5d._repaint(_5d._surface);}}},_getStoreItems:function(_5e){var uid=this._uniqueId;_5e=_4.map(_5e,function(_5f){return _4.mixin({"surfaceId":"tpick-surface-"+(uid.id++)},_5f);});var len=_5e.length,_60=0,obj={},k=0,_61,_62=[],_63=true,_64=this._columns;while(_60<len){_63=true;_61="cell"+k;obj[_61]=_5e[_60];_60++;k++;if(k%_64===0){_63=false;_62.push(obj);obj={};k=0;}}if(_63){_62.push(obj);}return _62;},_getItemsFromLayers:function(_65){var _66=[];_4.forEach(_65,function(_67,_68){_66.push(this._getItemsFromLayer(_67,_68));},this);return _66;},_getItemsFromLayer:function(_69,_6a){var _6b=[];var _6c=[];_6c=_6c.concat(_69.templates);_4.forEach(_69.types,function(_6d){var _6e=_6d.templates;_4.forEach(_6e,function(_6f){_6f._type_=_6d;});_6c=_6c.concat(_6e);});_6c=_4.filter(_6c,esri._isDefined);var _70=_69.renderer;if(_70){if(_6c.length>0){_4.forEach(_6c,function(_71){var _72=_71.prototype;if(_72){var _73=_70.getSymbol(_72);if(_73){_6b.push({label:this._trimLabel(_71.name),symbol:_73,layer:_69,type:_71._type_,template:_71,index1:_6a,index2:_6b.length});}}delete _71._type_;},this);}else{var _74=_70.declaredClass.replace("esri.renderer.",""),_75=[];if(_74==="TemporalRenderer"){_70=_70.observationRenderer;if(_70){_74=_70.declaredClass.replace("esri.renderer.","");}}switch(_74){case "SimpleRenderer":_75=[{symbol:_70.symbol,label:_70.label,description:_70.description}];break;case "UniqueValueRenderer":case "ClassBreaksRenderer":_75=_70.infos;break;}_6b=_4.map(_75,function(_76,idx){return {label:this._trimLabel(_76.label),description:_76.description,symbolInfo:_4.mixin({constructor:function(){}},_76),symbol:_76.symbol,layer:_69,index1:_6a,index2:idx};},this);}}return _6b;},_getItemsFromItems:function(_77){return _4.map(_77,function(_78,idx){var _78=_4.mixin({index:idx},_78);_78.label=this._trimLabel(_78.label);return _78;},this);},_trimLabel:function(_79){var max=this.maxLabelLength;if(max&&_79){if(_79.length>max){_79=_79.substr(0,max)+"...";}}return _79||"";},_cellGet:function(_7a,_7b,_7c){if(!_7c){return "";}return this.grid.store.getValue(_7c,"cell"+_7a);},_cellFormatter:function(_7d){if(_7d){var _7e=this._itemWidgets,_7f=this.grid.store;var sid=_7f.getValue(_7d,"surfaceId");var w=_7e[sid];if(!w){w=(_7e[sid]=new esri.dijit.editing.TemplatePickerItem({id:sid,label:_7f.getValue(_7d,"label"),symbol:_7f.getValue(_7d,"symbol"),surfaceWidth:this.surfaceWidth,surfaceHeight:this.surfaceHeight,template:_7f.getValue(_7d,"template")}));}return w||"";}else{return "";}},_cellGetGroup:function(_80,_81){if(!this._groupRowIndices){return "";}var _82=_4.indexOf(this._groupRowIndices,_80);if(!_81||_82===-1){return "";}return this.featureLayers[_82].name;},_cellGroupFormatter:function(_83){if(_83){return "<div class='groupLabel'>"+_83+"</div>";}else{return "";}}});_4.declare("esri.dijit.editing.TemplatePickerItem",[_5._Widget,_5._Templated],{templateString:"<div class='item' style='text-align: center;'>"+"<div class='itemSymbol' dojoAttachPoint='_surfaceNode'></div>"+"<div class='itemLabel'>${label}</div>"+"</div>",startup:function(){if(this._started){return;}this.inherited(arguments);this._surface=this._draw(this._surfaceNode,this.symbol,this.surfaceWidth,this.surfaceHeight,this.template);},_draw:function(_84,_85,_86,_87,_88){var _89=_6.gfx.createSurface(_84,_86,_87);if(_4.isIE<9){var _8a=_89.getEventSource();_4.style(_8a,"position","relative");_4.style(_8a.parentNode,"position","relative");}var _8b=this._getDrawingToolShape(_85,_88)||esri.symbol.getShapeDescriptors(_85);var _8c;try{_8c=_89.createShape(_8b.defaultShape).setFill(_8b.fill).setStroke(_8b.stroke);}catch(e){_89.clear();_89.destroy();return;}var dim=_89.getDimensions();var _8d={dx:dim.width/2,dy:dim.height/2};var _8e=_8c.getBoundingBox(),_8f=_8e.width,_90=_8e.height;if(_8f>_86||_90>_87){var _91=_8f>_90?_8f:_90;var _92=_86<_87?_86:_87;var _93=(_92-5)/_91;_4.mixin(_8d,{xx:_93,yy:_93});}_8c.applyTransform(_8d);return _89;},_getDrawingToolShape:function(_94,_95){var _96,_97=_95?_95.drawingTool||null:null;switch(_97){case "esriFeatureEditToolArrow":_96={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 E"};break;case "esriFeatureEditToolLeftArrow":_96={type:"path",path:"M -15,1 L -8,8 L -8,5 L 10,5 L 10,-2 L -8,-2 L -8,-5 L -15,1 E"};break;case "esriFeatureEditToolRightArrow":_96={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 E"};break;case "esriFeatureEditToolUpArrow":_96={type:"path",path:"M 1,-10 L 8,-3 L 5,-3 L 5,15 L -2,15 L -2,-3 L -5,-3 L 1,-10 E"};break;case "esriFeatureEditToolDownArrow":_96={type:"path",path:"M 1,15 L 8,8 L 5,8 L 5,-10 L -2,-10 L -2,8 L -5,8 L 1,15 E"};break;case "esriFeatureEditToolTriangle":_96={type:"path",path:"M -10,14 L 2,-10 L 14,14 L -10,14 E"};break;case "esriFeatureEditToolRectangle":_96={type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 E"};break;case "esriFeatureEditToolCircle":_96={type:"circle",cx:0,cy:0,r:10};break;case "esriFeatureEditToolEllipse":_96={type:"ellipse",cx:0,cy:0,rx:10,ry:5};break;case "esriFeatureEditToolFreehand":if(_94.type==="simplelinesymbol"||_94.type==="cartographiclinesymbol"){_96={type:"path",path:"m -11, -7c-1.5,-3.75 7.25,-9.25 12.5,-7c5.25,2.25 6.75,9.75 3.75,12.75c-3,3 -3.25,2.5 -9.75,5.25c-6.5,2.75 -7.25,14.25 2,15.25c9.25,1 11.75,-4 13.25,-6.75c1.5,-2.75 3.5,-11.75 12,-6.5"};}else{_96={type:"path",path:"M 10,-13 c3.1,0.16667 4.42564,2.09743 2.76923,3.69231c-2.61025,2.87179 -5.61025,5.6718 -6.14358,6.20513c-0.66667,0.93333 -0.46667,1.2 -0.53333,1.93333c-0.00001,0.86666 0.6,1.66667 1.13334,2c1.03077,0.38462 2.8,0.93333 3.38974,1.70769c0.47693,0.42564 0.87693,0.75897 1.41026,1.75897c0.13333,1.06667 -0.46667,2.86667 -1.8,3.8c-0.73333,0.73333 -3.86667,2.66666 -4.86667,3.13333c-0.93333,0.8 -7.4,3.2 -7.6,3.06667c-1.06667,0.46667 -4.73333,1.13334 -5.2,1.26667c-1.6,0.33334 -4.6,0.4 -6.25128,0.05128c-1.41539,-0.18462 -2.34872,-2.31796 -1.41539,-4.45129c0.93333,-1.73333 1.86667,-3.13333 2.64615,-3.85641c1.28718,-1.47692 2.57437,-2.68204 3.88718,-3.54359c0.88718,-1.13845 1.8,-1.33333 2.26666,-2.45641c0.33334,-0.74359 0.37949,-1.7641 0.06667,-2.87692c-0.66666,-1.46666 -1.66666,-1.86666 -2.98975,-2.2c-1.27692,-0.26666 -2.12307,-0.64102 -3.27692,-1.46666c-0.66667,-1.00001 -1.01538,-3.01539 0.73333,-4.06667c1.73333,-1.2 3.6,-1.93333 4.93333,-2.2c1.33333,-0.46667 4.84104,-1.09743 5.84103,-1.23076c1.60001,-0.46667 6.02564,-0.50257 7.29231,-0.56924z"};}break;default:return null;}return {defaultShape:_96,fill:_94.getFill(),stroke:_94.getStroke()};},_repaint:function(_98){if(!_98){this._surface=this._draw(this._surfaceNode,this.symbol,this.surfaceWidth,this.surfaceHeight,this.template);return;}if(_98.getStroke&&_98.setStroke){_98.setStroke(_98.getStroke());}if(_98.getFill&&_98.setFill){_98.setFill(_98.getFill());}if(_98.children&&_4.isArray(_98.children)){_4.forEach(_98.children,this._repaint,this);}},destroy:function(){if(this._surface){this._surface.destroy();delete this._surface;}this.inherited(arguments);}});}}};});