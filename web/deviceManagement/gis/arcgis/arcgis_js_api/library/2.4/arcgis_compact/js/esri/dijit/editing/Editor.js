/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */

if(!dojo._hasResource["esri.dijit.editing.Editor"]){dojo._hasResource["esri.dijit.editing.Editor"]=true;dojo.provide("esri.dijit.editing.Editor");dojo.require("dijit.ProgressBar");dojo.require("dijit._Widget");dojo.require("dijit._Templated");dojo.require("esri.toolbars.edit");dojo.require("esri.toolbars.draw");dojo.require("esri.layers.FeatureLayer");dojo.require("esri.dijit.editing.Util");dojo.require("esri.dijit.editing.toolbars.Drawing");dojo.require("esri.dijit.editing.TemplatePicker");dojo.require("esri.dijit.AttributeInspector");dojo.require("esri.dijit.editing.SelectionHelper");dojo.require("esri.undoManager");dojo.require("esri.dijit.editing.editOperation");(function(){var _1=[dojo.moduleUrl("esri.dijit.editing","css/editor.css")];var _2=document.getElementsByTagName("head").item(0),_3;for(var i=0,il=_1.length;i<il;i++){_3=document.createElement("link");_3.type="text/css";_3.rel="stylesheet";_3.href=_1[i].toString();_2.appendChild(_3);}}());dojo.declare("esri.dijit.editing.Editor",[dijit._Widget,dijit._Templated],{widgetsInTemplate:true,templateString:"<div class=\"esriEditor\">\r\n    <div class=\"esriTemplatePicker\" dojoAttachPoint=\"templatePickerDiv\"></div>\r\n    <div class=\"esriDrawingToolbar\" dojoAttachPoint=\"drawingToolbarDiv\"></div>\r\n    <div class=\"progressBar\" dojoAttachPoint=\"progressBar\" indeterminate=\"true\" dojoType=\"dijit.ProgressBar\" />\r\n</div>\r\n",constructor:function(_4,_5){_4=_4||{};if(!_4.settings){console.error("Editor: please provide 'settings' parameter in the constructor");}if(!_4.settings.layerInfos){console.error("Editor: please provide 'layerInfos' parameter in the constructor");}this._settings=_4.settings;this._eConnects=[];},postCreate:function(){this._setDefaultOptions();this._initLayers();this._connectEvents();this._createWidgets();this._reset();this._enableMapClickHandler();},destroy:function(){if(this.drawingToolbar){this.drawingToolbar.destroy();}if(this.attributeInspector){this.attributeInspector.destroy();}if(this.templatePicker){this.templatePicker.destroy();}if(this._selectionHelper){this._selectionHelper.destroy();}if(this._drawToolbar){this._drawToolbar.deactivate();}this._reset();this._disableMapClickHandler();dojo.forEach(this._eConnects,"dojo.disconnect(item);");dojo.disconnect(this._dtConnect);this._layer=this._currentGraphic=this._activeType=this._activeTemplate=this._drawingTool=this._drawToolbar=this._editToolbar=this.drawingToolbar=this.attributeInspector=this.templatePicker=this.undoManager=null;if(this._settings.map.infoWindow&&this._settings.map.infoWindow.clearFeatures){this._settings.map.infoWindow.clearFeatures();}this.inherited(arguments);},_setDefaultOptions:function(){this._drawToolbar=this._settings.drawToolbar||new esri.toolbars.Draw(this._settings.map);this._settings.drawToolbar=this._drawToolbar;this._editToolbar=this._settings.editToolbar||new esri.toolbars.Edit(this._settings.map);this._settings.editToolbar=this._editToolbar;this._settings.toolbarVisible=this._settings.toolbarVisible||false;this._settings.toolbarOptions=dojo.mixin({reshapeVisible:false,cutVisible:false,mergeVisible:false},this._settings.toolbarOptions);this._settings.createOptions=dojo.mixin({polylineDrawTools:[esri.dijit.editing.Editor.CREATE_TOOL_POLYLINE],polygonDrawTools:[esri.dijit.editing.Editor.CREATE_TOOL_POLYGON],editAttributesImmediately:true},this._settings.createOptions);this._settings.singleSelectionTolerance=this._settings.singleSelectionTolerance||3;this._settings.maxUndoRedoOperations=this._settings.maxUndoRedoOperations||10;this._settings.editor=this;this._usePopup=this._settings.usePopup=this._settings.map.infoWindow._setPagerCallbacks?true:false;var _6=esri.config.defaults;this._settings.geometryService=this._settings.geometryService||_6.geometryService;_6.geometryService=_6.geometryService||this._settings.geometryService;},_initLayers:function(){this._settings.layers=[];var _7=this._settings.layerInfos;dojo.forEach(_7,function(_8){if(_8.featureLayer&&_8.featureLayer.loaded){this._settings.layers.push(_8.featureLayer);}},this);},_reset:function(){this._editVertices=true;this._layer=null;this._currentGraphic=null;this._activeType=null;this._activeTemplate=null;this._drawingTool=null;this._attributeChanged=false;this._hideAttributeInspector();this._editToolbar.deactivate();},_createFeature:function(_9){this._editClickPoint=this._findCenterPoint(_9);if(!_9.rings){this._applyEdits([{layer:this._layer,adds:[this._createGraphic(_9)]}]);return;}this._simplify(_9,dojo.hitch(this,function(_a){if(this._drawingTool!==esri.layers.FeatureTemplate.TOOL_AUTO_COMPLETE_POLYGON){this._applyEdits([{layer:this._layer,adds:[this._createGraphic(_a)]}]);}else{this._autoComplete(_a,dojo.hitch(this,function(_b){if(_b&&_b.length){this._applyEdits([{layer:this._layer,adds:dojo.map(_b,dojo.hitch(this,function(_c){return this._createGraphic(_c);}))}]);}}));}}));},_updateCurrentFeature:function(_d){var _e=this._isModified();if(_e){this._updateFeature(_e,_d);}else{if(_d){_d(false);}}},_updateFeature:function(_f,_10){var _11=_f.geometry;if(!_11.rings){this._applyEdits([{layer:_f.getLayer(),updates:[_f]}],_10);}else{this._simplify(_11,dojo.hitch(this,function(_12){this._applyEdits([{layer:_f.getLayer(),updates:[dojo.mixin(_f,{geometry:_12})]}],_10);}));}},_deleteFeature:function(_13,_14){var _15=[];if(!_13){var _16=this._settings.layers;_15=dojo.map(dojo.filter(_16,function(_17){return _17.getSelectedFeatures().length>0;}),"return {layer:item, deletes: item.getSelectedFeatures()}");if((!_15||!_15.length)&&this._currentGraphic){_15.push({layer:this._layer,deletes:[this._currentGraphic]});}}else{_15.push({layer:_13.getLayer(),deletes:[_13]});}this._applyEdits(_15,(_14));},_stopEditing:function(_18,_19,_1a,_1b){esri.hide(this.progressBar.domNode);this._undoRedoAdd();var _1c;if(_18._isSelOnly===true){if(_19&&_19.length){this.templatePicker.clearSelection();var _1d=new esri.tasks.Query();_1d.objectIds=[_19[0].objectId];this._selectFeatures([_18],_1d,dojo.hitch(this,"_onEditFeature"));}}else{_1c=this._selectionHelper.findMapService(this._settings.map,_18);if(_1c){_1c.refresh();}if(_19&&_19.length){this.templatePicker.clearSelection();esri.dijit.editing.Util.LayerHelper.findFeatures(_19,_18,dojo.hitch(this,"_onEditFeature"));}}if(_1b&&_1b.length){this._clearSelection(true);if(this._undoRedo){_1c=this._selectionHelper.findMapService(_18,this._settings.map);if(_1c){_1c.refresh();}}}if(this._undoRedo&&_1a&&_1a.length){_1c=this._selectionHelper.findMapService(_18,this._settings.map);if(_1c){_1c.refresh();}this.attributeInspector.refresh();this._undoRedo=false;}if(this.drawingToolbar){this.drawingToolbar._updateUI();}this._undoRedo=false;},_undoRedoAdd:function(){this._settings._isApplyEditsCall=false;if(!this._settings.undoManager){return;}if(this._activeTool==="CUT"||this._activeTool==="UNION"){return;}var _1e=(this._edits&&this._edits.length)?this._edits[0]:null;if(!_1e){return;}var _1f=_1e.adds||[];var _20=_1e.updates||[];var _21=_1e.deletes||[];var _22={featureLayer:_1e.layer};if(_1f.length){this.undoManager.add(new esri.dijit.editing.Add(dojo.mixin(_22,{addedGraphics:_1f})));}else{if(_21.length){this.undoManager.add(new esri.dijit.editing.Delete(dojo.mixin(_22,{deletedGraphics:_21})));}else{if(_20.length){this.undoManager.add(new esri.dijit.editing.Update(dojo.mixin(_22,{preUpdatedGraphics:[this._preUpdates],postUpdatedGraphics:_20})));}}}this._edits=null;this._preUpdates=null;},_activateDrawToolbar:function(_23){this._layer=_23.featureLayer;this._activeType=_23.type;this._activeTemplate=_23.template;this._drawingTool=this._activeTemplate?this._activeTemplate.drawingTool:null;this._drawTool=this._toDrawTool(this._drawingTool,_23.featureLayer);dojo.disconnect(this._dtConnect);this._dtConnect=dojo.connect(this._drawToolbar,"onDrawEnd",this,"_createFeature");this._editToolbar.deactivate();this._disableMapClickHandler();if(!this.drawingToolbar){this._drawToolbar.activate(this._drawTool);}else{this.drawingToolbar.activateEditing(this._drawTool,this._layer);}},_activateEditToolbar:function(_24,_25){var _26=_24.getLayer();var _27=_26?_26.geometryType:null;var _28=esri.toolbars.Edit.MOVE;if(_27!=="esriGeometryPoint"&&this._isNotesFeature(_24)===true){_28=_28|esri.toolbars.Edit.ROTATE|esri.toolbars.Edit.SCALE;this._editVertices=false;}else{if(_27!=="esriGeometryPoint"&&this._editVertices===true){_28=_28|esri.toolbars.Edit.ROTATE|esri.toolbars.Edit.SCALE;this._editVertices=false;}else{_28=_28|esri.toolbars.Edit.EDIT_VERTICES;this._editVertices=true;}}this._attributeChanged=this._isModified();this._preUpdates=new esri.Graphic(dojo.clone(_24.toJson()));this._editToolbar.activate(_28,_24);if(!this._settings.map.infoWindow.isShowing){var _29=(_25&&_25.screenPoint)||this._findCenterPoint(_24);this._settings.map.infoWindow.show(_29,this._settings.map.getInfoWindowAnchor(_29));}},_createGraphic:function(_2a){var _2b=(this._activeType&&this._activeType.symbol)||this._layer.defaultSymbol;var _2c=new esri.Graphic(_2a,_2b);if(this._activeTemplate){_2c.attributes=dojo.mixin({},this._activeTemplate.prototype.attributes);}else{_2c.attributes=_2c.attributes||[];dojo.forEach(this._layer.fields,function(_2d){_2c.attributes[_2d.name]=null;},this);}return _2c;},_connectEvents:function(){var _2e=this._settings.layers;dojo.forEach(_2e,"this._connect(item, 'onEditsComplete', dojo.hitch(this, '_stopEditing', item))",this);dojo.forEach(_2e,"this._connect(item, 'onBeforeApplyEdits', dojo.hitch(this, function() { esri.show(this.progressBar.domNode); this._settings._isApplyEditsCall = true;  }))",this);this._connect(this._editToolbar,"onGraphicClick",dojo.hitch(this,"_activateEditToolbar"));this._connect(this._editToolbar,"onGraphicFirstMove",dojo.hitch(this,"_hideAttributeInspector"));this._connect(this._editToolbar,"onVertexFirstMove",dojo.hitch(this,"_hideAttributeInspector"));this._connect(this._editToolbar,"onScaleStart",dojo.hitch(this,"_hideAttributeInspector"));this._connect(this._editToolbar,"onRotateStart",dojo.hitch(this,"_hideAttributeInspector"));},_connect:function(_2f,evt,_30){this._eConnects.push(dojo.connect(_2f,evt,_30));},_createWidgets:function(){this._selectionHelper=new esri.dijit.editing.SelectionHelper(this._settings);this._createTemplatePicker();this._createAttributeInspector();this._createDrawingToolbar();this._createUndoRedoManager();},_createTemplatePicker:function(){if(!this._settings.templatePicker){this.templatePicker=new esri.dijit.editing.TemplatePicker({"class":"esriTemplatePicker",featureLayers:this._settings.layers,showTooltip:true,maxLabelLength:this._settings.typesCharacterLimit,columns:"auto",rows:"auto"},this.templatePickerDiv);this.templatePicker.startup();this._settings.templatePicker=this.templatePicker;}else{this.templatePicker=this._settings.templatePicker;esri.hide(this.templatePickerDiv);}this._connect(this.templatePicker,"onSelectionChange",dojo.hitch(this,"_onCreateFeature"));},_createAttributeInspector:function(){if(!this._settings.attributeInspector){this._customAttributeInspector=false;var map=this._settings.map;this.attributeInspector=new esri.dijit.AttributeInspector({layerInfos:this._settings.layerInfos,hideNavButtons:this._usePopup},dojo.create("div"));this.attributeInspector.startup();map.infoWindow.setContent(this.attributeInspector.domNode);map.infoWindow.setTitle(esri.bundle.widgets.attributeInspector.NLS_title);map.infoWindow.resize(350,375);dojo.query(".esriAttributeInspector .atiLayerName").style({display:"none"});}else{this._customAttributeInspector=true;this.attributeInspector=this._settings.attributeInspector;}this._connect(this.attributeInspector,"onDelete",dojo.hitch(this,"_deleteFeature"));this._connect(this.attributeInspector,"onNext",dojo.hitch(this,function(_31){this._updateCurrentFeature(dojo.hitch(this,function(){this._attributeChanged=false;this._onEditFeature(_31);}));}));if(this._usePopup){this._settings.map.infoWindow._setPagerCallbacks(this.attributeInspector,dojo.hitch(this.attributeInspector,"next"),dojo.hitch(this.attributeInspector,"previous"));}this._connect(this.attributeInspector,"onAttributeChange",dojo.hitch(this,function(_32,_33,_34){this._preUpdates=new esri.Graphic(dojo.clone(_32.toJson()));this._currentGraphic.attributes[_33]=_34;this._updateFeature(this._currentGraphic,null);this._attributeChanged=false;}));},_createDrawingToolbar:function(){if(this._settings.toolbarVisible===true){this.drawingToolbar=new esri.dijit.editing.toolbars.Drawing({"class":"esriDrawingToolbar",drawToolbar:this._drawToolbar,editToolbar:this._editToolbar,settings:this._settings,onDelete:dojo.hitch(this,"_deleteFeature"),onApplyEdits:dojo.hitch(this,"_applyEdits"),onShowAttributeInspector:dojo.hitch(this,"_onEditFeature")},this.drawingToolbarDiv);}},_createUndoRedoManager:function(){if(!this._settings.enableUndoRedo&&!this._settings.undoManager){return;}this._settings.enableUndoRedo=true;this.undoManager=this._settings.undoManager;if(!this.undoManager){this.undoManager=this._settings.undoManager=new esri.UndoManager({maxOperations:this._settings.maxUndoRedoOperations});}this._connect(document,"onkeypress",dojo.hitch(this,function(evt){if(evt.metaKey||evt.ctrlKey){if(evt.charOrCode==="z"){this._undo();}if(evt.charOrCode==="y"){this._redo();}}}));},_enableMapClickHandler:function(){this._mapClickHandler=dojo.connect(this._settings.map,"onClick",dojo.hitch(this,function(evt){if(this._drawToolbar._geometryType){return;}if(this._activeTool==="SELECT"){this._activeTool="";return;}this._updateCurrentFeature(dojo.hitch(this,function(){this._reset();this._updateSelection(evt);}));}));},_disableMapClickHandler:function(){dojo.disconnect(this._mapClickHandler);},_onCreateFeature:function(){var _35=this.templatePicker.getSelected();if(_35){this._updateCurrentFeature(dojo.hitch(this,function(){if(this._currentGraphic){this._clearSelection(false);}this._reset();this._activateDrawToolbar(_35);}));}else{this._reset();dojo.disconnect(this._dtConnect);this._drawToolbar.deactivate();this._enableMapClickHandler();if(this.drawingToolbar){this.drawingToolbar.deactivate();}}},_onEditFeature:function(_36,_37){_36=(dojo.isArray(_36)?_36[0]:_36)||null;if(!_36){return;}if(!this._customAttributeInspector){_37=_37||this._editClickPoint||this._findCenterPoint(_36);var _38=_36.getLayer();this._settings.map.infoWindow.setTitle(_38?_38.name:esri.bundle.widgets.attributeInspector.NLS_title);if(this.drawingToolbar||!this._settings.map.infoWindow.isShowing){this._settings.map.infoWindow.show(_37,this._settings.map.getInfoWindowAnchor(_37));}this._editClickPoint=null;}if(_36===this._currentGraphic){return;}this._editVertices=true;this._layer=_36.getLayer();this._currentGraphic=_36;if(_36.getDojoShape()){_36.getDojoShape().moveToFront();}this._activateEditToolbar(_36);},_applyEdits:function(_39,_3a){_39=_39||[];if(_39.length<=0){return;}this._edits=_39;var _3b=dojo.map(_39,function(_3c){return _3c.layer.applyEdits(_3c.adds,_3c.updates,_3c.deletes);});this._deferredsList=new dojo.DeferredList(_3b).addCallback(dojo.hitch(this,function(){esri.hide(this.progressBar.domNode);if(_3a){_3a();}}));},_undo:function(){if(this._settings.undoManager&&!this._settings._isApplyEditsCall){this._editToolbar.deactivate();this._undoRedo=true;this._settings.undoManager.undo();}},_redo:function(){if(this._settings.undoManager&&!this._settings._isApplyEditsCall){this._editToolbar.deactivate();this._undoRedo=true;this._settings.undoManager.redo();}},_simplify:function(_3d,_3e){if(esri.geometry.polygonSelfIntersecting(_3d)){this._settings.geometryService.simplify([_3d],function(_3f){var _40=(_3f&&_3f.length)?_3f[0]:_40;if(_3e){_3e(_40);}});}else{if(_3e){_3e(_3d);}}},_autoComplete:function(_41,_42){var _43=this._getLayers("esriGeometryPolygon");var _44=new esri.tasks.Query();_44.geometry=_41;_44.returnGeometry=true;this._selectFeatures(_43,_44,dojo.hitch(this,function(_45){if(!_45||_45.length<=0){if(_42){_42([_41]);}}else{this._settings.geometryService.autoComplete(esri.getGeometries(_45),this._toPolylines([_44.geometry]),function(_46){if(_42){_42(_46);}});}}));},_getLayers:function(_47){var _48=this._settings.layers;return dojo.filter(_48,function(_49){return _49.geometryType===_47;});},_selectFeatures:function(_4a,_4b,_4c,_4d){this._selectionHelper.selectFeatures(_4a,_4b,_4d||esri.layers.FeatureLayer.SELECTION_NEW,_4c);},_updateSelection:function(evt){var _4e=evt.mapPoint;var _4f=evt.graphic;this._selectionHelper.selectFeaturesByGeometry(this._settings.layers,_4e,esri.layers.FeatureLayer.SELECTION_NEW,dojo.hitch(this,function(_50){var _51=dojo.some(_50,dojo.hitch(this,function(_52){return _52==_4f;}));if(_4f&&!_51){var _53=_4f.getLayer();if(this._isValidLayer(_53)){var _54=new esri.tasks.Query();_54.objectIds=[_4f.attributes[_53.objectIdField]];this._selectionHelper.selectFeatures([_53],_54,esri.layers.FeatureLayer.SELECTION_ADD,dojo.hitch(this,function(_55){this._updatePopupButtons(_55);this._onEditFeature(_55,_4e);}));}else{this._clearSelection();}}else{if(_50&&_50.length){this._updatePopupButtons(_50);this._onEditFeature(_50,_4e);}else{this._clearSelection();}}}));},_updatePopupButtons:function(_56){if(!this._usePopup||!_56){return;}var _57=_56.length;var _58=[this._settings.map.infoWindow._prevFeatureButton,this._settings.map.infoWindow._nextFeatureButton];dojo.forEach(_58,dojo.hitch(this,function(_59){(_57>1)?dojo.removeClass(_59,"hidden"):dojo.addClass(_59,"hidden");}));},_clearSelection:function(_5a){this._selectionHelper.clearSelection(_5a||false);this._reset();},_findCenterPoint:function(_5b){var _5c=_5b.geometry||_5b;var _5d;switch(_5c.type){case "point":_5d=_5c;break;case "polyline":var _5e=_5c.paths[0].length;_5d=_5c.getPoint(0,Math.ceil(_5e/2));break;case "polygon":var _5f=_5c.rings.length-1;var _60=_5c.rings[_5f].length-1;_5d=_5c.getPoint(_5f,_60);break;}return this._settings.map.toScreen(_5d);},_hideAttributeInspector:function(){if(!this._customAttributeInspector){this._settings.map.infoWindow.hide();}},_toPolylines:function(_61){var _62=dojo.map(_61,function(_63){var _64=new esri.geometry.Polyline(_63.spatialReference);dojo.forEach(_63.rings,function(_65){_64.addPath(_65);});return _64;});return _62;},_isNotesFeature:function(_66){var _67=_66.getLayer();var _68=_67?_67.types||null:null;if(!_68){return false;}var _69=_66.attributes[_67.typeIdField];var _6a;dojo.some(_68,function(_6b){if(_6b.id===_69){_6a=_6b.templates;return true;}return false;});if(!_6a){return false;}var _6c=_6a[0]||null;if(!_6c){return false;}var _6d=this._isShapeTool(_6c.drawingTool)||null;return _6d?true:false;},_isValidLayer:function(_6e){var _6f=this._settings.layerInfos;for(var i=0;i<_6f.length;i++){var _70=_6f[i];if(_6e.id==_70.id){return true;}}return false;},_isShapeTool:function(_71){switch(_71){case esri.layers.FeatureTemplate.TOOL_ARROW:return esri.toolbars.Draw.ARROW;case esri.layers.FeatureTemplate.TOOL_LEFT_ARROW:return esri.toolbars.Draw.LEFT_ARROW;case esri.layers.FeatureTemplate.TOOL_RIGHT_ARROW:return esri.toolbars.Draw.RIGHT_ARROW;case esri.layers.FeatureTemplate.TOOL_UP_ARROW:return esri.toolbars.Draw.UP_ARROW;case esri.layers.FeatureTemplate.TOOL_DOWN_ARROW:return esri.toolbars.Draw.DOWN_ARROW;case esri.layers.FeatureTemplate.TOOL_CIRCLE:return esri.toolbars.Draw.CIRCLE;case esri.layers.FeatureTemplate.TOOL_ELLIPSE:return esri.toolbars.Draw.ELLIPSE;case esri.layers.FeatureTemplate.TOOL_TRIANGLE:return esri.toolbars.Draw.TRIANGLE;case esri.layers.FeatureTemplate.TOOL_RECTANGLE:return esri.toolbars.Draw.RECTANGLE;default:return null;}},_toDrawTool:function(_72,_73){var _74=_73.geometryType;switch(_72){case esri.layers.FeatureTemplate.TOOL_POINT:return esri.toolbars.Draw.POINT;case esri.layers.FeatureTemplate.TOOL_ARROW:return esri.toolbars.Draw.ARROW;case esri.layers.FeatureTemplate.TOOL_LEFT_ARROW:return esri.toolbars.Draw.LEFT_ARROW;case esri.layers.FeatureTemplate.TOOL_RIGHT_ARROW:return esri.toolbars.Draw.RIGHT_ARROW;case esri.layers.FeatureTemplate.TOOL_UP_ARROW:return esri.toolbars.Draw.UP_ARROW;case esri.layers.FeatureTemplate.TOOL_DOWN_ARROW:return esri.toolbars.Draw.DOWN_ARROW;case esri.layers.FeatureTemplate.TOOL_CIRCLE:return esri.toolbars.Draw.CIRCLE;case esri.layers.FeatureTemplate.TOOL_ELLIPSE:return esri.toolbars.Draw.ELLIPSE;case esri.layers.FeatureTemplate.TOOL_TRIANGLE:return esri.toolbars.Draw.TRIANGLE;case esri.layers.FeatureTemplate.TOOL_RECTANGLE:return esri.toolbars.Draw.RECTANGLE;case esri.layers.FeatureTemplate.TOOL_LINE:return esri.toolbars.Draw.POLYLINE;case esri.layers.FeatureTemplate.TOOL_POLYGON:return esri.toolbars.Draw.POLYGON;case esri.layers.FeatureTemplate.TOOL_FREEHAND:if(_74==="esriGeometryPolyline"){return esri.toolbars.Draw.FREEHAND_POLYLINE;}else{return esri.toolbars.Draw.FREEHAND_POLYGON;}break;default:var _75=esri.toolbars.Draw.POINT;if(_74==="esriGeometryPolyline"){_75=esri.toolbars.Draw.POLYLINE;if(this._settings.createOptions.polylineDrawTools[0]===esri.dijit.editing.Editor.CREATE_TOOL_FREEHAND_POLYLINE){_75=esri.toolbars.Draw.FREEHAND_POLYLINE;}}else{if(_74==="esriGeometryPolygon"){_75=esri.toolbars.Draw.POLYGON;if(this._settings.createOptions.polygonDrawTools[0]===esri.dijit.editing.Editor.CREATE_TOOL_FREEHAND_POLYGON){_75=esri.toolbars.Draw.FREEHAND_POLYGON;}}}return _75;}},_isModified:function(){var _76=this._editToolbar.getCurrentState();return ((_76.isModified||this._attributeChanged)&&_76.graphic)?_76.graphic:null;}});dojo.mixin(esri.dijit.editing.Editor,{CREATE_TOOL_POLYLINE:"polyline",CREATE_TOOL_FREEHAND_POLYLINE:"freehandpolyline",CREATE_TOOL_POLYGON:"polygon",CREATE_TOOL_FREEHAND_POLYGON:"freehandpolygon",CREATE_TOOL_AUTOCOMPLETE:"autocomplete",CREATE_TOOL_RECTANGLE:"rectangle",CREATE_TOOL_TRIANGLE:"triangle",CREATE_TOOL_CIRCLE:"circle",CREATE_TOOL_ELLIPSE:"ellipse",CREATE_TOOL_ARROW:"arrow",CREATE_TOOL_UP_ARROW:"uparrow",CREATE_TOOL_DOWN_ARROW:"downarrow",CREATE_TOOL_RIGHT_ARROW:"rightarrow",CREATE_TOOL_LEFT_ARROW:"leftarrow"});}