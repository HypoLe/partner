/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


window[esri._dojoScopeName||"dojo"]._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dijit._editor.plugins.ViewSource"],["require","dojo.window"],["require","dojo.i18n"],["require","dijit._editor._Plugin"],["require","dijit.form.Button"],["requireLocalization","dijit._editor","commands",null,"ROOT,ar,ca,cs,da,de,el,es,fi,fr,he,hu,it,ja,kk,ko,nb,nl,pl,pt,pt-pt,ro,ru,sk,sl,sv,th,tr,zh,zh-tw","ROOT,ar,ca,cs,da,de,el,es,fi,fr,he,hu,it,ja,kk,ko,nb,nl,pl,pt,pt-pt,ro,ru,sk,sl,sv,th,tr,zh,zh-tw"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dijit._editor.plugins.ViewSource"]){_4._hasResource["dijit._editor.plugins.ViewSource"]=true;_4.provide("dijit._editor.plugins.ViewSource");_4.require("dojo.window");_4.require("dojo.i18n");_4.require("dijit._editor._Plugin");_4.require("dijit.form.Button");_4.declare("dijit._editor.plugins.ViewSource",_5._editor._Plugin,{stripScripts:true,stripComments:true,stripIFrames:true,readOnly:false,_fsPlugin:null,toggle:function(){if(_4.isWebKit){this._vsFocused=true;}this.button.set("checked",!this.button.get("checked"));},_initButton:function(){var _7=_4.i18n.getLocalization("dijit._editor","commands"),_8=this.editor;this.button=new _5.form.ToggleButton({label:_7["viewSource"],dir:_8.dir,lang:_8.lang,showLabel:false,iconClass:this.iconClassPrefix+" "+this.iconClassPrefix+"ViewSource",tabIndex:"-1",onChange:_4.hitch(this,"_showSource")});if(_4.isIE==7){this._ieFixNode=_4.create("div",{style:{opacity:"0",zIndex:"-1000",position:"absolute",top:"-1000px"}},_4.body());}this.button.set("readOnly",false);},setEditor:function(_9){this.editor=_9;this._initButton();this.editor.addKeyHandler(_4.keys.F12,true,true,_4.hitch(this,function(e){this.button.focus();this.toggle();_4.stopEvent(e);setTimeout(_4.hitch(this,function(){this.editor.focus();}),100);}));},_showSource:function(_a){var ed=this.editor;var _b=ed._plugins;var _c;this._sourceShown=_a;var _d=this;try{if(!this.sourceArea){this._createSourceView();}if(_a){ed._sourceQueryCommandEnabled=ed.queryCommandEnabled;ed.queryCommandEnabled=function(_e){var _f=_e.toLowerCase();if(_f==="viewsource"){return true;}else{return false;}};this.editor.onDisplayChanged();_c=ed.get("value");_c=this._filter(_c);ed.set("value",_c);this._pluginList=[];_4.forEach(_b,function(p){if(!(p instanceof _5._editor.plugins.ViewSource)){p.set("disabled",true);}});if(this._fsPlugin){this._fsPlugin._getAltViewNode=function(){return _d.sourceArea;};}this.sourceArea.value=_c;var is=_4._getMarginSize(ed.iframe.parentNode);_4.marginBox(this.sourceArea,{w:is.w,h:is.h});_4.style(ed.iframe,"display","none");_4.style(this.sourceArea,{display:"block"});var _10=function(){var vp=_4.window.getBox();if("_prevW" in this&&"_prevH" in this){if(vp.w===this._prevW&&vp.h===this._prevH){return;}else{this._prevW=vp.w;this._prevH=vp.h;}}else{this._prevW=vp.w;this._prevH=vp.h;}if(this._resizer){clearTimeout(this._resizer);delete this._resizer;}this._resizer=setTimeout(_4.hitch(this,function(){delete this._resizer;this._resize();}),10);};this._resizeHandle=_4.connect(window,"onresize",this,_10);setTimeout(_4.hitch(this,this._resize),100);this.editor.onNormalizedDisplayChanged();this.editor.__oldGetValue=this.editor.getValue;this.editor.getValue=_4.hitch(this,function(){var txt=this.sourceArea.value;txt=this._filter(txt);return txt;});}else{if(!ed._sourceQueryCommandEnabled){return;}_4.disconnect(this._resizeHandle);delete this._resizeHandle;if(this.editor.__oldGetValue){this.editor.getValue=this.editor.__oldGetValue;delete this.editor.__oldGetValue;}ed.queryCommandEnabled=ed._sourceQueryCommandEnabled;if(!this._readOnly){_c=this.sourceArea.value;_c=this._filter(_c);ed.beginEditing();ed.set("value",_c);ed.endEditing();}_4.forEach(_b,function(p){p.set("disabled",false);});_4.style(this.sourceArea,"display","none");_4.style(ed.iframe,"display","block");delete ed._sourceQueryCommandEnabled;this.editor.onDisplayChanged();}setTimeout(_4.hitch(this,function(){var _11=ed.domNode.parentNode;if(_11){var _12=_5.getEnclosingWidget(_11);if(_12&&_12.resize){_12.resize();}}ed.resize();}),300);}catch(e){console.log(e);}},updateState:function(){this.button.set("disabled",this.get("disabled"));},_resize:function(){var ed=this.editor;var tbH=ed.getHeaderHeight();var fH=ed.getFooterHeight();var eb=_4.position(ed.domNode);var _13=_4._getPadBorderExtents(ed.iframe.parentNode);var _14=_4._getMarginExtents(ed.iframe.parentNode);var _15=_4._getPadBorderExtents(ed.domNode);var _16=_4._getMarginExtents(ed.domNode);var edb={w:eb.w-(_15.w+_16.w),h:eb.h-(tbH+_15.h+_16.h+fH)};if(this._fsPlugin&&this._fsPlugin.isFullscreen){var vp=_4.window.getBox();edb.w=(vp.w-_15.w);edb.h=(vp.h-(tbH+_15.h+fH));}if(_4.isIE){edb.h-=2;}if(this._ieFixNode){var _17=-this._ieFixNode.offsetTop/1000;edb.w=Math.floor((edb.w+0.9)/_17);edb.h=Math.floor((edb.h+0.9)/_17);}_4.marginBox(this.sourceArea,{w:edb.w-(_13.w+_14.w),h:edb.h-(_13.h+_14.h)});_4.marginBox(ed.iframe.parentNode,{h:edb.h});},_createSourceView:function(){var ed=this.editor;var _18=ed._plugins;this.sourceArea=_4.create("textarea");if(this.readOnly){_4.attr(this.sourceArea,"readOnly",true);this._readOnly=true;}_4.style(this.sourceArea,{padding:"0px",margin:"0px",borderWidth:"0px",borderStyle:"none"});_4.place(this.sourceArea,ed.iframe,"before");if(_4.isIE&&ed.iframe.parentNode.lastChild!==ed.iframe){_4.style(ed.iframe.parentNode.lastChild,{width:"0px",height:"0px",padding:"0px",margin:"0px",borderWidth:"0px",borderStyle:"none"});}ed._viewsource_oldFocus=ed.focus;var _19=this;ed.focus=function(){if(_19._sourceShown){_19.setSourceAreaCaret();}else{try{if(this._vsFocused){delete this._vsFocused;_5.focus(ed.editNode);}else{ed._viewsource_oldFocus();}}catch(e){console.log(e);}}};var i,p;for(i=0;i<_18.length;i++){p=_18[i];if(p&&(p.declaredClass==="dijit._editor.plugins.FullScreen"||p.declaredClass===(_5._scopeName+"._editor.plugins.FullScreen"))){this._fsPlugin=p;break;}}if(this._fsPlugin){this._fsPlugin._viewsource_getAltViewNode=this._fsPlugin._getAltViewNode;this._fsPlugin._getAltViewNode=function(){return _19._sourceShown?_19.sourceArea:this._viewsource_getAltViewNode();};}this.connect(this.sourceArea,"onkeydown",_4.hitch(this,function(e){if(this._sourceShown&&e.keyCode==_4.keys.F12&&e.ctrlKey&&e.shiftKey){this.button.focus();this.button.set("checked",false);setTimeout(_4.hitch(this,function(){ed.focus();}),100);_4.stopEvent(e);}}));},_stripScripts:function(_1a){if(_1a){_1a=_1a.replace(/<\s*script[^>]*>((.|\s)*?)<\\?\/\s*script\s*>/ig,"");_1a=_1a.replace(/<\s*script\b([^<>]|\s)*>?/ig,"");_1a=_1a.replace(/<[^>]*=(\s|)*[("|')]javascript:[^$1][(\s|.)]*[$1][^>]*>/ig,"");}return _1a;},_stripComments:function(_1b){if(_1b){_1b=_1b.replace(/<!--(.|\s){1,}?-->/g,"");}return _1b;},_stripIFrames:function(_1c){if(_1c){_1c=_1c.replace(/<\s*iframe[^>]*>((.|\s)*?)<\\?\/\s*iframe\s*>/ig,"");}return _1c;},_filter:function(_1d){if(_1d){if(this.stripScripts){_1d=this._stripScripts(_1d);}if(this.stripComments){_1d=this._stripComments(_1d);}if(this.stripIFrames){_1d=this._stripIFrames(_1d);}}return _1d;},setSourceAreaCaret:function(){var win=_4.global;var _1e=this.sourceArea;_5.focus(_1e);if(this._sourceShown&&!this.readOnly){if(_4.isIE){if(this.sourceArea.createTextRange){var _1f=_1e.createTextRange();_1f.collapse(true);_1f.moveStart("character",-99999);_1f.moveStart("character",0);_1f.moveEnd("character",0);_1f.select();}}else{if(win.getSelection){if(_1e.setSelectionRange){_1e.setSelectionRange(0,0);}}}}},destroy:function(){if(this._ieFixNode){_4.body().removeChild(this._ieFixNode);}if(this._resizer){clearTimeout(this._resizer);delete this._resizer;}if(this._resizeHandle){_4.disconnect(this._resizeHandle);delete this._resizeHandle;}this.inherited(arguments);}});_4.subscribe(_5._scopeName+".Editor.getPlugin",null,function(o){if(o.plugin){return;}var _20=o.args.name.toLowerCase();if(_20==="viewsource"){o.plugin=new _5._editor.plugins.ViewSource({readOnly:("readOnly" in o.args)?o.args.readOnly:false,stripComments:("stripComments" in o.args)?o.args.stripComments:true,stripScripts:("stripScripts" in o.args)?o.args.stripScripts:true,stripIFrames:("stripIFrames" in o.args)?o.args.stripIFrames:true});}});}}};});